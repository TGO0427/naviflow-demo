<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NaviFlow Supply Chain Intelligence - Weather-Driven Shipment Tracking</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .page { display: none; }
        .page.active { display: block; }
    </style>
</head>
<body class="bg-gray-100">
    <div class="min-h-screen flex">
        <!-- Sidebar -->
        <aside class="w-64 bg-white border-r border-gray-200">
            <div class="p-4 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h1 class="text-xl font-bold text-gray-900">üõ°Ô∏è NaviFlow E-Commerce Shield</h1>
                    <button onclick="showUserMenu()" class="text-gray-500 hover:text-gray-700">
                        üë§
                    </button>
                </div>
                <p class="text-xs text-gray-500 mt-1" id="userInfo">Loading...</p>
            </div>
            
            <nav class="mt-4">
                <a href="#" onclick="showPage('aviation-weather'); return false;" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">
                    üì¶ Order Tracking
                </a>
                <a href="#" onclick="showPage('route-analysis'); return false;" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">
                    üìà Customer Notifications
                </a>
                <a href="#" onclick="showPage('flight-tracking'); return false;" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">
                    üìß Auto Alerts
                </a>
                <a href="#" onclick="showPage('alert-history'); return false;" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">
                    üìä Alert History
                </a>
                <a href="#" onclick="showPage('analytics-dashboard'); return false;" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">
                    üìà ROI Analytics
                </a>
                <a href="#" onclick="showPage('sea-freight'); return false;" class="block px-4 py-2 text-gray-700 hover:bg-gray-100">
                    üö¢ Sea Freight Intelligence
                </a>
            </nav>
            
            <div class="absolute bottom-4 left-4 right-4">
                <button onclick="showAppHelp()" class="w-full text-left px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg text-sm">
                    üìñ Help & Guide
                </button>
                <button onclick="logout()" class="w-full text-left px-4 py-2 text-red-600 hover:bg-red-50 rounded-lg text-sm mt-2">
                    üö™ Logout
                </button>
            </div>
        </aside>

        <!-- User Menu Dropdown -->
        <div id="userMenu" class="hidden fixed top-4 right-4 bg-white rounded-lg shadow-lg border border-gray-200 p-4 z-50">
            <div class="flex items-center mb-3">
                <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-semibold mr-3">
                    <span id="userInitial">U</span>
                </div>
                <div>
                    <p class="font-medium text-gray-800" id="userEmailDisplay">User</p>
                    <p class="text-xs text-gray-500" id="userStatusDisplay">Status</p>
                </div>
            </div>
            <hr class="my-3">
            <button onclick="showAppHelp()" class="w-full text-left px-3 py-2 text-gray-700 hover:bg-gray-100 rounded text-sm">
                üìñ Help & Guide
            </button>
            <button onclick="logout()" class="w-full text-left px-3 py-2 text-red-600 hover:bg-red-50 rounded text-sm">
                üö™ Logout
            </button>
        </div>

        <!-- Help Modal -->
        <div id="appHelpModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
            <div class="bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-y-auto">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center justify-between">
                        <h2 class="text-2xl font-bold text-gray-800">üìñ Aviation Weather Intelligence Guide</h2>
                        <button onclick="closeAppHelp()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                    </div>
                </div>
                
                <div class="p-6">
                    <!-- Quick Navigation -->
                    <div class="flex flex-wrap gap-2 mb-6">
                        <button onclick="showHelpSection('weather')" class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm hover:bg-blue-200">üå§Ô∏è Weather</button>
                        <button onclick="showHelpSection('routes')" class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm hover:bg-green-200">üõ©Ô∏è Routes</button>
                        <button onclick="showHelpSection('tracking')" class="px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm hover:bg-red-200">üõ´ Tracking</button>
                        <button onclick="showHelpSection('notifications')" class="px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm hover:bg-yellow-200">üì± Notifications</button>
                        <button onclick="showHelpSection('analytics')" class="px-3 py-1 bg-purple-100 text-purple-800 rounded-full text-sm hover:bg-purple-200">üìä Analytics</button>
                        <button onclick="showHelpSection('airports')" class="px-3 py-1 bg-gray-100 text-gray-800 rounded-full text-sm hover:bg-gray-200">üåç Airports</button>
                    </div>

                    <div id="helpContent">
                        <!-- Default help content will be inserted here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="flex-1 p-8">
            <!-- Aviation Weather Page -->
            <div id="aviation-weather" class="page active">
                <h2 class="text-2xl font-bold mb-6">üì¶ Active Shipment Tracking</h2>
                
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-4">Search & Track Client Shipments</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Shipment Reference / AWB Number</label>
                            <input type="text" id="shipmentRef" placeholder="e.g., NV123456789, 020-87654321" class="w-full border border-gray-300 rounded-lg px-3 py-2" />
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Customer Search</label>
                            <div class="relative">
                                <input type="text" id="customerSearch" placeholder="Search customers or import from Shopify/WooCommerce/Amazon..." class="w-full border border-gray-300 rounded-lg px-3 py-2 pr-12" />
                                <button onclick="showCustomerImport()" class="absolute right-2 top-2 text-blue-600 hover:text-blue-800" title="Import customers">
                                    üì•
                                </button>
                            </div>
                            <div id="customerSuggestions" class="hidden absolute z-10 w-full bg-white border border-gray-300 rounded-lg mt-1 shadow-lg">
                                <!-- Auto-complete suggestions will appear here -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Origin</label>
                            <select id="originLocation" class="w-full border border-gray-300 rounded-lg px-3 py-2">
                                <!-- Asia Pacific -->
                                <optgroup label="üåè Asia Pacific">
                                    <option value="HKG">HKG - Hong Kong International</option>
                                    <option value="SIN">SIN - Singapore Changi</option>
                                    <option value="ICN">ICN - Seoul Incheon</option>
                                    <option value="NRT">NRT - Tokyo Narita</option>
                                    <option value="PVG">PVG - Shanghai Pudong</option>
                                    <option value="BOM">BOM - Mumbai</option>
                                    <option value="SYD">SYD - Sydney Kingsford Smith</option>
                                </optgroup>
                                <!-- Europe -->
                                <optgroup label="üá™üá∫ Europe">
                                    <option value="FRA">FRA - Frankfurt Airport</option>
                                    <option value="CDG">CDG - Paris Charles de Gaulle</option>
                                    <option value="AMS">AMS - Amsterdam Schiphol</option>
                                    <option value="LHR">LHR - London Heathrow</option>
                                    <option value="IST">IST - Istanbul Airport</option>
                                    <option value="LGG">LGG - Li√®ge Airport</option>
                                </optgroup>
                                <!-- North America -->
                                <optgroup label="üá∫üá∏ North America">
                                    <option value="ANC">ANC - Anchorage International</option>
                                    <option value="MIA">MIA - Miami International</option>
                                    <option value="LAX">LAX - Los Angeles International</option>
                                    <option value="ORD">ORD - Chicago O'Hare</option>
                                    <option value="JFK">JFK - New York JFK</option>
                                    <option value="YYZ">YYZ - Toronto Pearson</option>
                                </optgroup>
                                <!-- Middle East & Africa -->
                                <optgroup label="üåç Middle East & Africa">
                                    <option value="DXB">DXB - Dubai International</option>
                                    <option value="DOH">DOH - Doha Hamad International</option>
                                    <option value="CAI">CAI - Cairo International</option>
                                    <option value="JNB">JNB - Johannesburg O.R. Tambo</option>
                                    <option value="CPT">CPT - Cape Town International</option>
                                </optgroup>
                                <!-- South America -->
                                <optgroup label="üåé South America">
                                    <option value="GRU">GRU - S√£o Paulo Guarulhos</option>
                                    <option value="BOG">BOG - Bogot√° El Dorado</option>
                                </optgroup>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Destination Airport</label>
                            <select id="destinationAirport" class="w-full border border-gray-300 rounded-lg px-3 py-2">
                                <!-- Asia Pacific -->
                                <optgroup label="üåè Asia Pacific">
                                    <option value="HKG">HKG - Hong Kong International</option>
                                    <option value="SIN">SIN - Singapore Changi</option>
                                    <option value="ICN">ICN - Seoul Incheon</option>
                                    <option value="NRT">NRT - Tokyo Narita</option>
                                    <option value="PVG">PVG - Shanghai Pudong</option>
                                    <option value="BOM">BOM - Mumbai</option>
                                    <option value="SYD">SYD - Sydney Kingsford Smith</option>
                                </optgroup>
                                <!-- Europe -->
                                <optgroup label="üá™üá∫ Europe">
                                    <option value="FRA">FRA - Frankfurt Airport</option>
                                    <option value="CDG" selected>CDG - Paris Charles de Gaulle</option>
                                    <option value="AMS">AMS - Amsterdam Schiphol</option>
                                    <option value="LHR">LHR - London Heathrow</option>
                                    <option value="IST">IST - Istanbul Airport</option>
                                    <option value="LGG">LGG - Li√®ge Airport</option>
                                </optgroup>
                                <!-- North America -->
                                <optgroup label="üá∫üá∏ North America">
                                    <option value="ANC">ANC - Anchorage International</option>
                                    <option value="MIA">MIA - Miami International</option>
                                    <option value="LAX">LAX - Los Angeles International</option>
                                    <option value="ORD">ORD - Chicago O'Hare</option>
                                    <option value="JFK">JFK - New York JFK</option>
                                    <option value="YYZ">YYZ - Toronto Pearson</option>
                                </optgroup>
                                <!-- Middle East & Africa -->
                                <optgroup label="üåç Middle East & Africa">
                                    <option value="DXB">DXB - Dubai International</option>
                                    <option value="DOH">DOH - Doha Hamad International</option>
                                    <option value="CAI">CAI - Cairo International</option>
                                    <option value="JNB">JNB - Johannesburg O.R. Tambo</option>
                                    <option value="CPT">CPT - Cape Town International</option>
                                </optgroup>
                                <!-- South America -->
                                <optgroup label="üåé South America">
                                    <option value="GRU">GRU - S√£o Paulo Guarulhos</option>
                                    <option value="BOG">BOG - Bogot√° El Dorado</option>
                                </optgroup>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Destination</label>
                            <select id="destinationLocation" class="w-full border border-gray-300 rounded-lg px-3 py-2">
                                <option value="">Any Destination</option>
                                <option value="LAX">LAX - Los Angeles</option>
                                <option value="FRA">FRA - Frankfurt</option>
                                <option value="NRT">NRT - Tokyo</option>
                                <option value="CDG">CDG - Paris</option>
                                <option value="AMS">AMS - Amsterdam</option>
                                <option value="HKG">HKG - Hong Kong</option>
                                <option value="SIN">SIN - Singapore</option>
                                <option value="DXB">DXB - Dubai</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Shipment Status</label>
                            <select id="shipmentStatus" class="w-full border border-gray-300 rounded-lg px-3 py-2">
                                <option value="">All Status</option>
                                <option value="intransit">In Transit</option>
                                <option value="delayed">Weather Delayed</option>
                                <option value="delivered">Delivered</option>
                                <option value="pending">Pending Pickup</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="flex space-x-4">
                        <button onclick="searchShipments()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                            üîç Search Shipments
                        </button>
                        <button onclick="loadSampleShipments()" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">
                            üì¶ Load Sample Orders
                        </button>
                        <button onclick="importCustomers()" class="bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700">
                            üì• Import Customers
                        </button>
                    </div>
                </div>

                <!-- Shipment Results -->
                <div id="shipmentResults" class="bg-white rounded-lg shadow p-6" style="display: none;">
                    <h3 class="text-lg font-semibold mb-4">üì¶ Customer Order Status</h3>
                    <div id="shipmentContent">
                        <!-- Sample shipment data will be displayed here -->
                        <div class="space-y-4">
                            <div class="border rounded-lg p-4 bg-gradient-to-r from-blue-50 to-blue-100">
                                <div class="flex justify-between items-start mb-3">
                                    <div>
                                        <h4 class="font-semibold text-blue-900">iPhone 15 Pro Cases (Premium Bundle)</h4>
                                        <p class="text-sm text-blue-700">Order: #IP789456123 | Customer: Sarah Johnson | Value: $89.99</p>
                                    </div>
                                    <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">In Transit</span>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 text-sm">
                                    <div>
                                        <p class="text-gray-600">Route</p>
                                        <p class="font-semibold">CHI ‚Üí MEM ‚Üí Customer</p>
                                    </div>
                                    <div>
                                        <p class="text-gray-600">Delivery ETA</p>
                                        <p class="font-semibold text-green-600">On Schedule (Tomorrow 2-6pm)</p>
                                    </div>
                                    <div>
                                        <p class="text-gray-600">Weather Status</p>
                                        <p class="font-semibold text-blue-600">Clear conditions, no delays</p>
                                    </div>
                                    <div>
                                        <p class="text-gray-600">Customer Status</p>
                                        <p class="font-semibold text-green-600">‚úì Auto-notified</p>
                                    </div>
                                </div>
                                <div class="mt-3 p-2 bg-blue-200 rounded text-sm">
                                    <p class="font-medium text-blue-800">üìß Customer Update: "Hi Sarah! Your iPhone cases are on track for tomorrow delivery 2-6pm. No weather delays expected!"</p>
                                </div>
                            </div>
                            
                            <div class="border rounded-lg p-4 bg-gradient-to-r from-yellow-50 to-yellow-100">
                                <div class="flex justify-between items-start mb-3">
                                    <div>
                                        <h4 class="font-semibold text-yellow-900">Gaming Headset Orders (Bulk Shipment)</h4>
                                        <p class="text-sm text-yellow-700">Orders: 47 customers | Product: SteelSeries Arctis 7P | Avg Value: $149.99</p>
                                    </div>
                                    <span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-sm font-medium">Weather Delay</span>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 text-sm">
                                    <div>
                                        <p class="text-gray-600">Route</p>
                                        <p class="font-semibold">LAX ‚Üí LOU ‚Üí Customers</p>
                                    </div>
                                    <div>
                                        <p class="text-gray-600">Customer Notifications</p>
                                        <p class="font-semibold text-green-600">47 customers auto-notified</p>
                                    </div>
                                    <div>
                                        <p class="text-gray-600">Weather Delay Impact</p>
                                        <p class="font-semibold text-red-600">2-day delay - storms in Louisville</p>
                                    </div>
                                    <div>
                                        <p class="text-gray-600">Seller Protection</p>
                                        <p class="font-semibold text-green-600">‚úì Amazon metrics protected</p>
                                    </div>
                                </div>
                                <div class="mt-3 p-2 bg-yellow-200 rounded text-sm">
                                    <p class="font-medium text-yellow-800">üõ°Ô∏è Review Protection: Louisville storms delaying 47 gaming headset orders by 2 days. All customers auto-notified with $10 credits. Amazon performance metrics protected.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Route Analysis Page -->
            <div id="route-analysis" class="page">
                <h2 class="text-2xl font-bold mb-6">üìà Client Communication Dashboard</h2>
                
                <!-- Route Planning Form -->
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-4">üìß Automated Client Updates</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Origin Airport</label>
                            <select id="routeOriginAirport" class="w-full border border-gray-300 rounded-lg px-3 py-2">
                                <!-- Asia Pacific -->
                                <optgroup label="üåè Asia Pacific">
                                    <option value="HKG" selected>HKG - Hong Kong International</option>
                                    <option value="SIN">SIN - Singapore Changi</option>
                                    <option value="ICN">ICN - Seoul Incheon</option>
                                    <option value="NRT">NRT - Tokyo Narita</option>
                                    <option value="PVG">PVG - Shanghai Pudong</option>
                                    <option value="BOM">BOM - Mumbai</option>
                                    <option value="SYD">SYD - Sydney Kingsford Smith</option>
                                </optgroup>
                                <!-- Europe -->
                                <optgroup label="üá™üá∫ Europe">
                                    <option value="FRA">FRA - Frankfurt Airport</option>
                                    <option value="CDG">CDG - Paris Charles de Gaulle</option>
                                    <option value="AMS">AMS - Amsterdam Schiphol</option>
                                    <option value="LHR">LHR - London Heathrow</option>
                                    <option value="IST">IST - Istanbul Airport</option>
                                    <option value="LGG">LGG - Li√®ge Airport</option>
                                </optgroup>
                                <!-- North America -->
                                <optgroup label="üá∫üá∏ North America">
                                    <option value="ANC">ANC - Anchorage International</option>
                                    <option value="MIA">MIA - Miami International</option>
                                    <option value="LAX">LAX - Los Angeles International</option>
                                    <option value="ORD">ORD - Chicago O'Hare</option>
                                    <option value="JFK">JFK - New York JFK</option>
                                    <option value="YYZ">YYZ - Toronto Pearson</option>
                                </optgroup>
                                <!-- Middle East & Africa -->
                                <optgroup label="üåç Middle East & Africa">
                                    <option value="DXB">DXB - Dubai International</option>
                                    <option value="DOH">DOH - Doha Hamad International</option>
                                    <option value="CAI">CAI - Cairo International</option>
                                    <option value="JNB">JNB - Johannesburg O.R. Tambo</option>
                                    <option value="CPT">CPT - Cape Town International</option>
                                </optgroup>
                                <!-- South America -->
                                <optgroup label="üåé South America">
                                    <option value="GRU">GRU - S√£o Paulo Guarulhos</option>
                                    <option value="BOG">BOG - Bogot√° El Dorado</option>
                                </optgroup>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Destination Airport</label>
                            <select id="routeDestinationAirport" class="w-full border border-gray-300 rounded-lg px-3 py-2">
                                <!-- Asia Pacific -->
                                <optgroup label="üåè Asia Pacific">
                                    <option value="HKG">HKG - Hong Kong International</option>
                                    <option value="SIN">SIN - Singapore Changi</option>
                                    <option value="ICN">ICN - Seoul Incheon</option>
                                    <option value="NRT">NRT - Tokyo Narita</option>
                                    <option value="PVG">PVG - Shanghai Pudong</option>
                                    <option value="BOM">BOM - Mumbai</option>
                                    <option value="SYD">SYD - Sydney Kingsford Smith</option>
                                </optgroup>
                                <!-- Europe -->
                                <optgroup label="üá™üá∫ Europe">
                                    <option value="FRA">FRA - Frankfurt Airport</option>
                                    <option value="CDG">CDG - Paris Charles de Gaulle</option>
                                    <option value="AMS">AMS - Amsterdam Schiphol</option>
                                    <option value="LHR">LHR - London Heathrow</option>
                                    <option value="IST">IST - Istanbul Airport</option>
                                    <option value="LGG">LGG - Li√®ge Airport</option>
                                </optgroup>
                                <!-- North America -->
                                <optgroup label="üá∫üá∏ North America">
                                    <option value="ANC">ANC - Anchorage International</option>
                                    <option value="MIA">MIA - Miami International</option>
                                    <option value="LAX" selected>LAX - Los Angeles International</option>
                                    <option value="ORD">ORD - Chicago O'Hare</option>
                                    <option value="JFK">JFK - New York JFK</option>
                                    <option value="YYZ">YYZ - Toronto Pearson</option>
                                </optgroup>
                                <!-- Middle East & Africa -->
                                <optgroup label="üåç Middle East & Africa">
                                    <option value="DXB">DXB - Dubai International</option>
                                    <option value="DOH">DOH - Doha Hamad International</option>
                                    <option value="CAI">CAI - Cairo International</option>
                                    <option value="JNB">JNB - Johannesburg O.R. Tambo</option>
                                    <option value="CPT">CPT - Cape Town International</option>
                                </optgroup>
                                <!-- South America -->
                                <optgroup label="üåé South America">
                                    <option value="GRU">GRU - S√£o Paulo Guarulhos</option>
                                    <option value="BOG">BOG - Bogot√° El Dorado</option>
                                </optgroup>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Aircraft Type</label>
                            <select id="aircraftType" class="w-full border border-gray-300 rounded-lg px-3 py-2">
                                <option value="cargo_747">Boeing 747F Cargo</option>
                                <option value="cargo_777">Boeing 777F Cargo</option>
                                <option value="cargo_a330">Airbus A330F Cargo</option>
                                <option value="cargo_md11">McDonnell Douglas MD-11F</option>
                                <option value="passenger_777">Boeing 777 (Passenger+Cargo)</option>
                                <option value="passenger_a350">Airbus A350 (Passenger+Cargo)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Departure Date/Time</label>
                            <input type="datetime-local" id="departureTime" class="w-full border border-gray-300 rounded-lg px-3 py-2" />
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Cargo Weight (kg)</label>
                            <input type="number" id="cargoWeight" placeholder="15000" class="w-full border border-gray-300 rounded-lg px-3 py-2" />
                        </div>
                    </div>
                    
                    <button onclick="analyzeFlightRoute()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                        üîç Analyze Cargo Route
                    </button>
                </div>

                <!-- Route Analysis Results -->
                <div id="routeAnalysisResults" class="hidden space-y-6">
                    <!-- Flight Path Overview -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">‚úàÔ∏è Flight Path Analysis</h3>
                        <div id="flightPathContent"></div>
                    </div>

                    <!-- Weather Conditions Along Route -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">üå§Ô∏è Weather Conditions</h3>
                        <div id="weatherConditionsContent"></div>
                    </div>

                    <!-- Risk Assessment -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">‚ö†Ô∏è Risk Assessment</h3>
                        <div id="riskAssessmentContent"></div>
                    </div>

                    <!-- Alternative Routes -->
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4">üó∫Ô∏è Alternative Routes</h3>
                        <div id="alternativeRoutesContent"></div>
                    </div>
                </div>

                <!-- Cargo ROI Metrics -->  
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-4">üí∞ High-Value Cargo Protection ROI</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- Schedule Reliability Metrics -->
                        <div class="bg-green-50 rounded-lg p-4">
                            <h4 class="font-medium text-green-800 mb-3">üìã Insurance Claims Prevention</h4>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm font-medium text-green-700 mb-1">Avg. Shipment Value ($)</label>
                                    <input type="number" id="shipmentValue" value="2400000" min="0" class="w-full border border-green-300 rounded-lg px-3 py-2 text-sm" />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-green-700 mb-1">Insurance Claim Risk (%)</label>
                                    <input type="number" id="insuranceRisk" value="0.5" step="0.1" min="0" max="100" class="w-full border border-green-300 rounded-lg px-3 py-2 text-sm" />
                                </div>
                                <div id="scheduleMetrics" class="text-sm text-green-800 bg-green-100 rounded p-2 mt-2">
                                    Weather documentation prevents 78% of insurance claims
                                </div>
                            </div>
                        </div>
                        
                        <!-- Fuel Cost Optimization -->
                        <div class="bg-blue-50 rounded-lg p-4">
                            <h4 class="font-medium text-blue-800 mb-3">üîó Cascade Effect Prevention</h4>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm font-medium text-blue-700 mb-1">Production Line Downtime Cost ($/hour)</label>
                                    <input type="number" id="downtimeCost" value="150000" min="0" class="w-full border border-blue-300 rounded-lg px-3 py-2 text-sm" />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-blue-700 mb-1">Cascade Delays Prevented (%)</label>
                                    <input type="number" id="cascadePrevention" value="85" min="0" max="100" class="w-full border border-blue-300 rounded-lg px-3 py-2 text-sm" />
                                </div>
                                <div id="fuelMetrics" class="text-sm text-blue-800 bg-blue-100 rounded p-2 mt-2">
                                    Early alerts prevent $2.4M production line shutdowns
                                </div>
                            </div>
                        </div>
                        
                        <!-- Hub Efficiency -->
                        <div class="bg-purple-50 rounded-lg p-4">
                            <h4 class="font-medium text-purple-800 mb-3">üìä Executive Visibility Value</h4>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm font-medium text-purple-700 mb-1">C-Suite Client Value ($/month)</label>
                                    <input type="number" id="executiveValue" value="500000" min="0" class="w-full border border-purple-300 rounded-lg px-3 py-2 text-sm" />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-purple-700 mb-1">Executive Satisfaction Gain (%)</label>
                                    <input type="number" id="executiveSatisfaction" value="35" min="0" max="100" class="w-full border border-purple-300 rounded-lg px-3 py-2 text-sm" />
                                </div>
                                <div id="hubMetrics" class="text-sm text-purple-800 bg-purple-100 rounded p-2 mt-2">
                                    Detailed explanations satisfy C-suite expectations
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6 bg-gray-50 rounded-lg p-4">
                        <h4 class="font-medium text-gray-800 mb-3">üìà High-Value Cargo Protection ROI</h4>
                        <div id="roiSummary" class="grid grid-cols-1 md:grid-cols-4 gap-4 text-sm">
                            <div class="bg-white rounded p-3 border">
                                <p class="text-gray-600">Insurance Claims Prevented</p>
                                <p class="text-2xl font-bold text-green-600">$1.87M</p>
                            </div>
                            <div class="bg-white rounded p-3 border">
                                <p class="text-gray-600">Cascade Failures Avoided</p>
                                <p class="text-2xl font-bold text-blue-600">$2.4M</p>
                            </div>
                            <div class="bg-white rounded p-3 border">
                                <p class="text-gray-600">Executive Satisfaction</p>
                                <p class="text-2xl font-bold text-purple-600">+35%</p>
                            </div>
                            <div class="bg-white rounded p-3 border">
                                <p class="text-gray-600">Documentation ROI</p>
                                <p class="text-2xl font-bold text-orange-600">2,850%</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Executive Communication Templates -->
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-4">üìß Executive Communication Templates</h3>
                    
                    <div class="space-y-4">
                        <!-- E-Commerce Customer Alert Template -->
                        <div class="border rounded-lg p-4 bg-gradient-to-r from-red-50 to-red-100">
                            <h4 class="font-semibold text-red-800 mb-2">üö® Customer Delay Notification</h4>
                            <div class="text-sm text-red-700 bg-white rounded p-3 font-mono">
                                <p><strong>TO:</strong> sarah.m.johnson@gmail.com</p>
                                <p><strong>SUBJECT:</strong> Instant Pot Order Update - Weather Delay (2-Day Delivery Protected)</p>
                                <br>
                                <p>Hi Sarah! Your Instant Pot Duo 7-in-1 (Order #IP123456789) is experiencing a weather delay.</p>
                                <br>
                                <p><strong>What happened:</strong> Ice storms in Memphis affecting air cargo hub</p>
                                <p><strong>Your order:</strong> Safe and secure in climate-controlled facility</p>
                                <p><strong>Original delivery:</strong> Tomorrow 2-6pm</p>
                                <p><strong>NEW delivery window:</strong> Thursday 10am-2pm</p>
                                <br>
                                <p><strong>Good news:</strong> Amazon Prime protection covers weather delays</p>
                                <p><strong>We've added:</strong> $5 credit to your account for the inconvenience</p>
                                <br>
                                <p>Track live: [yourstore.com/track/IP123456789]</p>
                                <p>Questions? Reply to this email or call 1-555-SUPPORT</p>
                                <br>
                                <p>Thanks for your patience!</p>
                                <p>- The HomeCook Pro Team</p>
                            </div>
                        </div>
                        
                        <!-- Amazon Seller Protection Template -->
                        <div class="border rounded-lg p-4 bg-gradient-to-r from-blue-50 to-blue-100">
                            <h4 class="font-semibold text-blue-800 mb-2">üõ°Ô∏è Amazon Performance Protection</h4>
                            <div class="text-sm text-blue-700 bg-white rounded p-3 font-mono">
                                <p><strong>Auto-Generated Marketplace Documentation</strong></p>
                                <p><strong>ORDER:</strong> Michael_B_Chicago - iPhone 15 Case Set</p>
                                <br>
                                <p>Customer notification sent: "Hi Michael! Your phone case order is delayed by weather in Louisville. New delivery: Friday instead of Thursday. $3 credit added to your account. Track here: [link]"</p>
                                <br>
                                <p><strong>Amazon Seller Central Backup:</strong></p>
                                <p>‚Ä¢ Weather delay documented with NOAA data</p>
                                <p>‚Ä¢ Customer proactively notified (prevents A-to-Z claims)</p>
                                <p>‚Ä¢ Performance metrics protected from late delivery</p>
                                <p>‚Ä¢ 5-star review protection activated</p>
                                <br>
                                <p><strong>eBay Seller Hub Backup:</strong></p>
                                <p>‚Ä¢ Defect rate protection applied</p>
                                <p>‚Ä¢ Top Rated Seller status maintained</p>
                                <p>‚Ä¢ Weather documentation submitted automatically</p>
                                <br>
                                <p>Customer satisfaction: PROTECTED | Seller metrics: SAFE</p>
                            </div>
                        </div>
                        
                        <!-- Success Story Template -->
                        <div class="border rounded-lg p-4 bg-gradient-to-r from-green-50 to-green-100">
                            <h4 class="font-semibold text-green-800 mb-2">‚úÖ Weather Intelligence Success</h4>
                            <div class="text-sm text-green-700 bg-white rounded p-3 font-mono">
                                <p><strong>TO:</strong> spacex.operations@spacex.com</p>
                                <p><strong>SUBJECT:</strong> Mission-Critical Components: Early Arrival via Weather Optimization</p>
                                <br>
                                <p>Your mission-critical components (AWB: SX445566778) will arrive 45 minutes EARLY due to optimal weather routing.</p>
                                <br>
                                <p><strong>Weather Intelligence:</strong> Jet stream positioning providing 85kt tailwinds</p>
                                <p><strong>Route Optimization:</strong> Direct routing via polar route approved</p>
                                <p><strong>New ETA:</strong> Thursday 14:15 UTC (45min ahead of schedule)</p>
                                <br>
                                <p><strong>Value Added:</strong></p>
                                <p>‚Ä¢ Launch window timing preserved</p>
                                <p>‚Ä¢ $15K fuel savings passed to client</p>
                                <p>‚Ä¢ Assembly line preparation time increased</p>
                                <br>
                                <p>Your mission timeline remains optimal. Weather intelligence delivering competitive advantage.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Multi-Channel Alert Delivery -->
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-4">üöÄ Executive Alert Delivery System</h3>
                    
                    <!-- Alert Channel Configuration -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <!-- Primary Channels -->
                        <div class="border rounded-lg p-4">
                            <h4 class="font-semibold text-gray-800 mb-4">üìß Primary Alert Channels</h4>
                            <div class="space-y-4">
                                <div class="flex items-center space-x-3">
                                    <input type="checkbox" id="emailAlerts" checked class="rounded border-gray-300 text-blue-600" />
                                    <label class="flex-1">
                                        <span class="font-medium">Executive Email</span>
                                        <input type="email" placeholder="ceo@client-company.com" class="w-full mt-1 border border-gray-300 rounded px-2 py-1 text-sm" />
                                    </label>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <input type="checkbox" id="smsAlerts" checked class="rounded border-gray-300 text-blue-600" />
                                    <label class="flex-1">
                                        <span class="font-medium">Executive SMS</span>
                                        <input type="tel" placeholder="+1-555-CEO-PHONE" class="w-full mt-1 border border-gray-300 rounded px-2 py-1 text-sm" />
                                    </label>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <input type="checkbox" id="teamsAlerts" class="rounded border-gray-300 text-blue-600" />
                                    <label class="flex-1">
                                        <span class="font-medium">Microsoft Teams</span>
                                        <input type="text" placeholder="Supply Chain Channel" class="w-full mt-1 border border-gray-300 rounded px-2 py-1 text-sm" />
                                    </label>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <input type="checkbox" id="slackAlerts" class="rounded border-gray-300 text-blue-600" />
                                    <label class="flex-1">
                                        <span class="font-medium">Slack Integration</span>
                                        <input type="text" placeholder="#supply-chain-alerts" class="w-full mt-1 border border-gray-300 rounded px-2 py-1 text-sm" />
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Escalation Rules -->
                        <div class="border rounded-lg p-4">
                            <h4 class="font-semibold text-gray-800 mb-4">‚ö° Escalation Workflows</h4>
                            <div class="space-y-4">
                                <div class="bg-red-50 rounded-lg p-3">
                                    <h5 class="font-medium text-red-800 mb-2">High-Value Cargo ($1M+)</h5>
                                    <div class="text-sm text-red-700 space-y-1">
                                        <p>‚Ä¢ Immediate: Email + SMS to executives</p>
                                        <p>‚Ä¢ +15min: Teams notification to ops team</p>
                                        <p>‚Ä¢ +30min: WhatsApp to logistics manager</p>
                                        <p>‚Ä¢ +60min: Phone call if no acknowledgment</p>
                                    </div>
                                </div>
                                <div class="bg-yellow-50 rounded-lg p-3">
                                    <h5 class="font-medium text-yellow-800 mb-2">Temperature-Critical</h5>
                                    <div class="text-sm text-yellow-700 space-y-1">
                                        <p>‚Ä¢ Immediate: All channels simultaneously</p>
                                        <p>‚Ä¢ +10min: Regulatory team notification</p>
                                        <p>‚Ä¢ +20min: Insurance documentation start</p>
                                        <p>‚Ä¢ Real-time: Temperature dashboard updates</p>
                                    </div>
                                </div>
                                <div class="bg-blue-50 rounded-lg p-3">
                                    <h5 class="font-medium text-blue-800 mb-2">Time-Critical JIT</h5>
                                    <div class="text-sm text-blue-700 space-y-1">
                                        <p>‚Ä¢ Immediate: Production team alerts</p>
                                        <p>‚Ä¢ +5min: Alternative routing options</p>
                                        <p>‚Ä¢ +15min: C-suite notification</p>
                                        <p>‚Ä¢ Real-time: Cascade impact calculations</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Alert Triggers Configuration -->
                    <div class="border rounded-lg p-4 mb-4">
                        <h4 class="font-semibold text-gray-800 mb-4">üéØ Alert Trigger Configuration</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Weather Delay Threshold</label>
                                <select class="w-full border border-gray-300 rounded-lg px-3 py-2">
                                    <option>Any delay (immediate)</option>
                                    <option>15+ minutes</option>
                                    <option>30+ minutes</option>
                                    <option>1+ hour</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Temperature Deviation</label>
                                <select class="w-full border border-gray-300 rounded-lg px-3 py-2">
                                    <option>Any deviation (immediate)</option>
                                    <option>¬±5¬∞C from spec</option>
                                    <option>¬±10¬∞C from spec</option>
                                    <option>Outside safe range</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Cascade Risk Level</label>
                                <select class="w-full border border-gray-300 rounded-lg px-3 py-2">
                                    <option>Low risk and above</option>
                                    <option>Medium risk and above</option>
                                    <option>High risk only</option>
                                    <option>Critical risk only</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Alert Testing & Management -->
                    <div class="flex flex-wrap gap-4">
                        <button onclick="testExecutiveAlert()" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700">
                            üö® Test High-Value Alert
                        </button>
                        <button onclick="testColdChainAlert()" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                            üå°Ô∏è Test Cold Chain Alert
                        </button>
                        <button onclick="testCascadeAlert()" class="bg-yellow-600 text-white px-6 py-2 rounded-lg hover:bg-yellow-700">
                            üîó Test Cascade Alert
                        </button>
                        <button onclick="sendRealAlert()" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700" id="sendRealAlertBtn">
                            üöÄ Send REAL Alert
                        </button>
                        <button onclick="viewAlertLog()" class="bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700">
                            üìÑ View Alert Log
                        </button>
                    </div>
                    
                    <!-- Live Alert Status -->
                    <div class="mt-6 grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div class="bg-green-50 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-green-600">127</div>
                            <div class="text-sm text-green-700">Alerts Sent Today</div>
                        </div>
                        <div class="bg-blue-50 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-blue-600">94%</div>
                            <div class="text-sm text-blue-700">Delivery Success Rate</div>
                        </div>
                        <div class="bg-purple-50 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-purple-600">2.3s</div>
                            <div class="text-sm text-purple-700">Avg. Delivery Time</div>
                        </div>
                        <div class="bg-orange-50 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold text-orange-600">89%</div>
                            <div class="text-sm text-orange-700">Client Acknowledgment</div>
                        </div>
                    </div>
                    
                    
                    <!-- Alert Delivery Technical Implementation -->
                    <div class="mt-6 bg-gray-50 rounded-lg p-6">
                        <h4 class="font-semibold text-gray-800 mb-4">üîß Alert Delivery Implementation</h4>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- API Integrations -->
                            <div>
                                <h5 class="font-medium text-gray-700 mb-3">API Integrations</h5>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between p-2 bg-white rounded border">
                                        <span>SendGrid (Email)</span>
                                        <span class="text-green-600">‚úì Connected</span>
                                    </div>
                                    <div class="flex justify-between p-2 bg-white rounded border">
                                        <span>Twilio (SMS)</span>
                                        <span class="text-green-600">‚úì Connected</span>
                                    </div>
                                    <div class="flex justify-between p-2 bg-white rounded border">
                                        <span>Microsoft Graph (Teams)</span>
                                        <span class="text-yellow-600">~ Config Required</span>
                                    </div>
                                    <div class="flex justify-between p-2 bg-white rounded border">
                                        <span>Slack Webhook</span>
                                        <span class="text-green-600">‚úì Connected</span>
                                    </div>
                                    <div class="flex justify-between p-2 bg-white rounded border">
                                        <span>WhatsApp Business API</span>
                                        <span class="text-green-600">‚úì Connected</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Alert Flow -->
                            <div>
                                <h5 class="font-medium text-gray-700 mb-3">Alert Processing Flow</h5>
                                <div class="space-y-2 text-sm">
                                    <div class="p-2 bg-white rounded border">
                                        <div class="font-medium">1. Weather Trigger</div>
                                        <div class="text-gray-600">Open-Meteo API detects condition</div>
                                    </div>
                                    <div class="p-2 bg-white rounded border">
                                        <div class="font-medium">2. Impact Analysis</div>
                                        <div class="text-gray-600">Calculate delay, temperature, cascade</div>
                                    </div>
                                    <div class="p-2 bg-white rounded border">
                                        <div class="font-medium">3. Template Generation</div>
                                        <div class="text-gray-600">Personalize for client/cargo type</div>
                                    </div>
                                    <div class="p-2 bg-white rounded border">
                                        <div class="font-medium">4. Multi-Channel Send</div>
                                        <div class="text-gray-600">Email, SMS, Teams, Slack</div>
                                    </div>
                                    <div class="p-2 bg-white rounded border">
                                        <div class="font-medium">5. Delivery Tracking</div>
                                        <div class="text-gray-600">Open rates, acknowledgments</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Analytics Dashboard -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="text-lg font-semibold mb-4">üìä Performance Analytics</h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <!-- Flight Performance Metrics -->
                        <div class="bg-blue-50 rounded-lg p-4">
                            <h4 class="font-medium text-blue-800 mb-3">‚úàÔ∏è Flight Performance</h4>
                            <div class="space-y-2">
                                <div class="flex justify-between">
                                    <span class="text-sm text-blue-600">On-Time Performance:</span>
                                    <span class="font-semibold text-blue-800" id="onTimePerf">94.2%</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-blue-600">Average Delay:</span>
                                    <span class="font-semibold text-blue-800" id="avgDelay">8.5 min</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-blue-600">Weather Diversions:</span>
                                    <span class="font-semibold text-blue-800" id="weatherDiversions">2.1%</span>
                                </div>
                            </div>
                        </div>

                        <!-- Cargo Performance -->
                        <div class="bg-green-50 rounded-lg p-4">
                            <h4 class="font-medium text-green-800 mb-3">üì¶ Cargo Performance</h4>
                            <div class="space-y-2">
                                <div class="flex justify-between">
                                    <span class="text-sm text-green-600">Load Factor:</span>
                                    <span class="font-semibold text-green-800" id="loadFactor">87.3%</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-green-600">Cargo Delivered:</span>
                                    <span class="font-semibold text-green-800" id="cargoDelivered">1,247 tons</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-green-600">Damage Rate:</span>
                                    <span class="font-semibold text-green-800" id="damageRate">0.12%</span>
                                </div>
                            </div>
                        </div>

                        <!-- Weather Impact -->
                        <div class="bg-yellow-50 rounded-lg p-4">
                            <h4 class="font-medium text-yellow-800 mb-3">üå§Ô∏è Weather Impact</h4>
                            <div class="space-y-2">
                                <div class="flex justify-between">
                                    <span class="text-sm text-yellow-600">Weather Delays:</span>
                                    <span class="font-semibold text-yellow-800" id="weatherDelays">12.7%</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-yellow-600">Cost Impact:</span>
                                    <span class="font-semibold text-yellow-800" id="costImpact">$45,200</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-yellow-600">Routes Optimized:</span>
                                    <span class="font-semibold text-yellow-800" id="routesOptimized">156</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Placeholder -->
                    <div class="bg-gray-50 rounded-lg p-6 text-center">
                        <h4 class="font-medium text-gray-700 mb-2">üìà Performance Trends</h4>
                        <p class="text-sm text-gray-600">Interactive charts showing flight performance, weather impact, and cost analysis over time</p>
                        <button onclick="generateAnalyticsCharts()" class="mt-4 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">
                            üìä Generate Analytics Report
                        </button>
                    </div>
                </div>
            </div>

            <!-- Flight Tracking Page -->
            <div id="flight-tracking" class="page">
                <h2 class="text-2xl font-bold mb-6">üìß Client Alert Management</h2>
                
                <!-- Hub Operations Overview -->
                <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6 mb-6">
                    <!-- Operational Metrics -->
                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4 text-blue-800">üìß Alert Performance</h3>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-blue-700">Alerts Sent Today</span>
                                <span class="text-2xl font-bold text-blue-900">127</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-blue-700">Proactive Notifications</span>
                                <span class="text-2xl font-bold text-blue-900">89%</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-blue-700">Client Inquiries Reduced</span>
                                <span class="text-2xl font-bold text-blue-900">73%</span>
                            </div>
                            <div class="bg-blue-200 rounded-lg p-2 text-center">
                                <span class="text-sm font-medium text-blue-800">Alert System: Active</span>
                            </div>
                        </div>
                    </div>

                    <!-- Weather Impact -->
                    <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4 text-green-800">üå¶Ô∏è Weather Impact</h3>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-green-700">Weather-Related Delays</span>
                                <span class="text-2xl font-bold text-green-900">3</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-green-700">Fuel Savings (Today)</span>
                                <span class="text-2xl font-bold text-green-900">$12.4K</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-green-700">Risk Level</span>
                                <span class="text-lg font-bold text-green-900">LOW</span>
                            </div>
                            <div class="bg-green-200 rounded-lg p-2 text-center">
                                <span class="text-sm font-medium text-green-800">Weather Intelligence: Active</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Cost Savings -->
                    <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4 text-purple-800">üí∞ Cost Optimization</h3>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-purple-700">Monthly Savings</span>
                                <span class="text-2xl font-bold text-purple-900">$47.2K</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-purple-700">Delay Penalties Avoided</span>
                                <span class="text-2xl font-bold text-purple-900">$18.7K</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-purple-700">ROI</span>
                                <span class="text-2xl font-bold text-purple-900">340%</span>
                            </div>
                            <div class="bg-purple-200 rounded-lg p-2 text-center">
                                <span class="text-sm font-medium text-purple-800">Target: $60K/month</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- System Integration -->
                    <div class="bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-4 text-orange-800">üîó System Integration</h3>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-orange-700">CMS Connected</span>
                                <span class="text-lg font-bold text-green-600">‚úì</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-orange-700">WMS Sync</span>
                                <span class="text-lg font-bold text-green-600">‚úì</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-sm text-orange-700">TMS Integration</span>
                                <span class="text-lg font-bold text-yellow-600">~</span>
                            </div>
                            <div class="bg-orange-200 rounded-lg p-2 text-center">
                                <span class="text-sm font-medium text-orange-800">API Status: Healthy</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Active Cargo Operations -->
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold">üöö Active Cargo Operations</h3>
                        <div class="flex space-x-2">
                            <button onclick="refreshFlights()" class="bg-blue-100 text-blue-800 px-3 py-1 rounded-lg text-sm hover:bg-blue-200">
                                üîÑ Refresh
                            </button>
                            <button onclick="loadSampleFlights()" class="bg-green-100 text-green-800 px-3 py-1 rounded-lg text-sm hover:bg-green-200">
                                üìä Load Sample Data
                            </button>
                        </div>
                    </div>
                    
                    <div id="activeFlightsList" class="space-y-4">
                        <div class="text-center text-gray-500 py-8">
                            <p>No active flights found</p>
                            <p class="text-sm">Create a new flight or load sample data to get started</p>
                        </div>
                    </div>
                </div>

                <!-- Flight Details Modal -->
                <div id="flightDetailsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
                    <div class="bg-white rounded-2xl shadow-2xl max-w-6xl w-full max-h-[90vh] overflow-y-auto">
                        <div class="p-6 border-b border-gray-200">
                            <div class="flex items-center justify-between">
                                <h2 class="text-2xl font-bold text-gray-800" id="modalFlightTitle">Flight Details</h2>
                                <button onclick="closeFlightDetails()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                            </div>
                        </div>
                        
                        <div class="p-6">
                            <div id="flightDetailsContent">
                                <!-- Flight details will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Weather Alerts Panel -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h3 class="text-lg font-semibold mb-4">‚ö†Ô∏è Weather Alerts & Notifications</h3>
                    
                    <div id="weatherAlerts" class="space-y-3">
                        <div class="text-gray-500 text-center py-4">
                            No active weather alerts
                        </div>
                    </div>
                </div>
            </div>

            <!-- Alert History Page -->
            <div id="alert-history" class="page">
                <h2 class="text-2xl font-bold mb-6">üìä Alert History & Analytics</h2>
                
                <!-- Alert Summary Dashboard -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-2 text-blue-800">Total Alerts Sent</h3>
                        <div class="text-3xl font-bold text-blue-900" id="totalAlerts">0</div>
                        <p class="text-sm text-blue-600 mt-1">All time</p>
                    </div>
                    
                    <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-2 text-green-800">Success Rate</h3>
                        <div class="text-3xl font-bold text-green-900" id="successRate">0%</div>
                        <p class="text-sm text-green-600 mt-1">Delivery success</p>
                    </div>
                    
                    <div class="bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-2 text-yellow-800">Avg Response Time</h3>
                        <div class="text-3xl font-bold text-yellow-900" id="avgResponseTime">0ms</div>
                        <p class="text-sm text-yellow-600 mt-1">Delivery speed</p>
                    </div>
                    
                    <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-2 text-purple-800">Customer Saves</h3>
                        <div class="text-3xl font-bold text-purple-900" id="customerSaves">0</div>
                        <p class="text-sm text-purple-600 mt-1">Proactive notifications</p>
                    </div>
                </div>
                
                <!-- Filter Controls -->
                <div class="bg-white rounded-lg shadow p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-4">üìÖ Filter Alert History</h3>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Date Range</label>
                            <select id="dateFilter" class="w-full border border-gray-300 rounded-lg px-3 py-2">
                                <option value="today">Today</option>
                                <option value="week">Last 7 days</option>
                                <option value="month" selected>Last 30 days</option>
                                <option value="all">All time</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Alert Type</label>
                            <select id="typeFilter" class="w-full border border-gray-300 rounded-lg px-3 py-2">
                                <option value="all" selected>All alerts</option>
                                <option value="weather">Weather delays</option>
                                <option value="delivery">Delivery updates</option>
                                <option value="shipping">Shipping issues</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Customer</label>
                            <input type="text" id="customerFilter" placeholder="Search customer..."
                                   class="w-full border border-gray-300 rounded-lg px-3 py-2">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Actions</label>
                            <div class="flex space-x-2">
                                <button onclick="refreshAlertHistory()" 
                                        class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                    üîÑ Refresh
                                </button>
                                <button onclick="exportAlertHistory()" 
                                        class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                                    üìä Export
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Alert History Table -->
                <div class="bg-white rounded-lg shadow overflow-hidden">
                    <div class="p-6 border-b border-gray-200">
                        <h3 class="text-lg font-semibold">üìã Recent Alert Activity</h3>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Timestamp
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Customer
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Alert Type
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Channels
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Status
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Response Time
                                    </th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                        Actions
                                    </th>
                                </tr>
                            </thead>
                            <tbody id="alertHistoryTable" class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td colspan="7" class="px-6 py-8 text-center text-gray-500">
                                        No alert history found. Send some alerts to see them tracked here.
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <div class="mt-6 bg-gray-50 rounded-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-gray-800">‚ö° Quick Actions</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <button onclick="sendTestAlert()" 
                                class="bg-blue-600 text-white p-4 rounded-lg hover:bg-blue-700 text-left">
                            <div class="text-lg font-semibold">üß™ Send Test Alert</div>
                            <div class="text-sm opacity-90">Test your alert system</div>
                        </button>
                        <button onclick="viewAlertTemplates()" 
                                class="bg-purple-600 text-white p-4 rounded-lg hover:bg-purple-700 text-left">
                            <div class="text-lg font-semibold">üìù View Templates</div>
                            <div class="text-sm opacity-90">Manage alert templates</div>
                        </button>
                        <button onclick="alertAnalytics()" 
                                class="bg-green-600 text-white p-4 rounded-lg hover:bg-green-700 text-left">
                            <div class="text-lg font-semibold">üìà Analytics</div>
                            <div class="text-sm opacity-90">Detailed performance metrics</div>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Analytics Dashboard Page -->
            <div id="analytics-dashboard" class="page">
                <h2 class="text-2xl font-bold mb-6">üìà ROI Analytics & Business Impact</h2>
                
                <!-- Key Performance Indicators -->
                <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6 mb-8">
                    <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-2 text-green-800">üí∞ Revenue Protected</h3>
                        <div class="text-3xl font-bold text-green-900" id="revenueProtected">$0</div>
                        <p class="text-sm text-green-600 mt-1">From prevented cancellations</p>
                        <div class="mt-2 text-xs text-green-700">
                            üìà <span id="revenueGrowth">+0%</span> vs last month
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-2 text-blue-800">‚≠ê Reviews Protected</h3>
                        <div class="text-3xl font-bold text-blue-900" id="reviewsProtected">0</div>
                        <p class="text-sm text-blue-600 mt-1">Bad reviews prevented</p>
                        <div class="mt-2 text-xs text-blue-700">
                            üõ°Ô∏è <span id="ratingMaintained">5.0</span> average rating maintained
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-2 text-purple-800">üòä Customer Satisfaction</h3>
                        <div class="text-3xl font-bold text-purple-900" id="satisfactionScore">0%</div>
                        <p class="text-sm text-purple-600 mt-1">Positive response rate</p>
                        <div class="mt-2 text-xs text-purple-700">
                            üí¨ <span id="customerThankYou">0</span> thank you messages
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-orange-50 to-orange-100 rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-2 text-orange-800">üìû Support Tickets Saved</h3>
                        <div class="text-3xl font-bold text-orange-900" id="ticketsSaved">0</div>
                        <p class="text-sm text-orange-600 mt-1">Proactive notifications</p>
                        <div class="mt-2 text-xs text-orange-700">
                            ‚è±Ô∏è <span id="timeSaved">0h</span> support time saved
                        </div>
                    </div>
                </div>
                
                <!-- ROI Calculator -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-xl font-semibold mb-4 text-gray-800">üí∞ ROI Calculator</h3>
                        <div class="space-y-4">
                            <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                                <h4 class="font-semibold text-green-800 mb-3">üíµ Monthly Value Generated</h4>
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div>
                                        <span class="text-green-700">Prevented Cancellations:</span>
                                        <div class="font-bold text-green-900" id="monthlyRevenue">$8,450</div>
                                    </div>
                                    <div>
                                        <span class="text-green-700">Support Time Saved:</span>
                                        <div class="font-bold text-green-900" id="supportSavings">$2,160</div>
                                    </div>
                                    <div>
                                        <span class="text-green-700">Rating Protection:</span>
                                        <div class="font-bold text-green-900" id="ratingSavings">$3,200</div>
                                    </div>
                                    <div>
                                        <span class="text-green-700">Repeat Customers:</span>
                                        <div class="font-bold text-green-900" id="repeatRevenue">$1,890</div>
                                    </div>
                                </div>
                                <hr class="my-3 border-green-200">
                                <div class="flex justify-between items-center">
                                    <span class="font-semibold text-green-800">Total Monthly Value:</span>
                                    <span class="text-2xl font-bold text-green-900" id="totalMonthlyValue">$15,700</span>
                                </div>
                            </div>
                            
                            <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                                <h4 class="font-semibold text-gray-800 mb-3">üìä Cost vs Value</h4>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-gray-700">Monthly Subscription:</span>
                                        <span class="font-medium text-gray-900">$79</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-700">Setup Time Investment:</span>
                                        <span class="font-medium text-gray-900">$120</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-700">Total Monthly Cost:</span>
                                        <span class="font-medium text-gray-900">$199</span>
                                    </div>
                                </div>
                                <hr class="my-3 border-gray-200">
                                <div class="flex justify-between items-center">
                                    <span class="font-semibold text-gray-800">Net Monthly Profit:</span>
                                    <span class="text-xl font-bold text-green-600" id="netProfit">$15,501</span>
                                </div>
                                <div class="text-center mt-2">
                                    <span class="text-2xl font-bold text-green-600" id="roiPercentage">7,890%</span>
                                    <span class="text-sm text-gray-600">ROI</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-xl font-semibold mb-4 text-gray-800">‚≠ê Marketplace Protection</h3>
                        <div class="space-y-4">
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                <h4 class="font-semibold text-blue-800 mb-3">üõ°Ô∏è Amazon Seller Metrics</h4>
                                <div class="grid grid-cols-2 gap-3 text-sm">
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-blue-900">4.9</div>
                                        <div class="text-blue-700">Current Rating</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-green-600">+0.3</div>
                                        <div class="text-blue-700">Rating Improvement</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-blue-900">98%</div>
                                        <div class="text-blue-700">On-Time Rate</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-2xl font-bold text-green-600">+5%</div>
                                        <div class="text-blue-700">Performance Boost</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                                <h4 class="font-semibold text-yellow-800 mb-3">üìã Dispute Protection</h4>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-yellow-700">Weather Disputes Filed:</span>
                                        <span class="font-bold text-yellow-900">12</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-yellow-700">Disputes Won:</span>
                                        <span class="font-bold text-green-600">12 (100%)</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-yellow-700">Documentation Generated:</span>
                                        <span class="font-bold text-yellow-900">47</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-yellow-700">Avg Resolution Time:</span>
                                        <span class="font-bold text-yellow-900">2.3 days</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                                <h4 class="font-semibold text-green-800 mb-2">‚úÖ Success Stories</h4>
                                <div class="text-sm text-green-700 space-y-1">
                                    <p>‚Ä¢ "Thank you for the heads up! Really appreciate the proactive communication." - Sarah M.</p>
                                    <p>‚Ä¢ "Professional service, will definitely order again." - Michael B.</p>
                                    <p>‚Ä¢ "Weather delay notice was very helpful, thanks!" - David L.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Customer Satisfaction Trends -->
                <div class="bg-white rounded-lg shadow p-6 mb-8">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800">üìä Customer Satisfaction Trends</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="text-center">
                            <div class="text-4xl font-bold text-green-600 mb-2">94%</div>
                            <div class="text-gray-700 mb-1">Positive Response Rate</div>
                            <div class="text-sm text-gray-500">Customers appreciate proactive communication</div>
                        </div>
                        <div class="text-center">
                            <div class="text-4xl font-bold text-blue-600 mb-2">67%</div>
                            <div class="text-gray-700 mb-1">Repeat Purchase Rate</div>
                            <div class="text-sm text-gray-500">Higher than industry average (45%)</div>
                        </div>
                        <div class="text-center">
                            <div class="text-4xl font-bold text-purple-600 mb-2">2.3x</div>
                            <div class="text-gray-700 mb-1">Customer Lifetime Value</div>
                            <div class="text-sm text-gray-500">Compared to reactive-only sellers</div>
                        </div>
                    </div>
                </div>
                
                <!-- A/B Testing Results -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-xl font-semibold mb-4 text-gray-800">üß™ A/B Testing Results</h3>
                        <div class="space-y-4">
                            <div class="border rounded-lg p-4">
                                <h4 class="font-semibold text-gray-800 mb-2">Template Performance</h4>
                                <div class="space-y-3">
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-700">Professional (Template A)</span>
                                        <div class="flex items-center">
                                            <div class="w-32 bg-gray-200 rounded-full h-2 mr-2">
                                                <div class="bg-green-600 h-2 rounded-full" style="width: 89%"></div>
                                            </div>
                                            <span class="text-sm font-medium">89%</span>
                                        </div>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-700">Casual (Template B)</span>
                                        <div class="flex items-center">
                                            <div class="w-32 bg-gray-200 rounded-full h-2 mr-2">
                                                <div class="bg-blue-600 h-2 rounded-full" style="width: 76%"></div>
                                            </div>
                                            <span class="text-sm font-medium">76%</span>
                                        </div>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-700">Urgent (Template C)</span>
                                        <div class="flex items-center">
                                            <div class="w-32 bg-gray-200 rounded-full h-2 mr-2">
                                                <div class="bg-yellow-600 h-2 rounded-full" style="width: 82%"></div>
                                            </div>
                                            <span class="text-sm font-medium">82%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="border rounded-lg p-4">
                                <h4 class="font-semibold text-gray-800 mb-2">Customer Segment Performance</h4>
                                <div class="text-sm text-gray-600 space-y-2">
                                    <div class="flex justify-between">
                                        <span>High-Value Customers ($200+):</span>
                                        <span class="font-medium text-green-600">96% satisfaction</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Regular Customers ($50-199):</span>
                                        <span class="font-medium text-blue-600">91% satisfaction</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Budget Customers (<$50):</span>
                                        <span class="font-medium text-yellow-600">87% satisfaction</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-xl font-semibold mb-4 text-gray-800">üìà Business Growth Impact</h3>
                        <div class="space-y-4">
                            <div class="bg-gradient-to-r from-green-50 to-blue-50 border rounded-lg p-4">
                                <h4 class="font-semibold text-gray-800 mb-3">Month-over-Month Growth</h4>
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div>
                                        <div class="text-2xl font-bold text-green-600">+23%</div>
                                        <div class="text-gray-700">Revenue Growth</div>
                                    </div>
                                    <div>
                                        <div class="text-2xl font-bold text-blue-600">+31%</div>
                                        <div class="text-gray-700">Customer Retention</div>
                                    </div>
                                    <div>
                                        <div class="text-2xl font-bold text-purple-600">+18%</div>
                                        <div class="text-gray-700">Order Frequency</div>
                                    </div>
                                    <div>
                                        <div class="text-2xl font-bold text-orange-600">+41%</div>
                                        <div class="text-gray-700">Positive Reviews</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="border rounded-lg p-4">
                                <h4 class="font-semibold text-gray-800 mb-2">Competitive Advantage</h4>
                                <div class="text-sm text-gray-600 space-y-2">
                                    <div class="flex items-center">
                                        <div class="w-2 h-2 bg-green-500 rounded-full mr-2"></div>
                                        <span>87% of competitors still reactive-only</span>
                                    </div>
                                    <div class="flex items-center">
                                        <div class="w-2 h-2 bg-blue-500 rounded-full mr-2"></div>
                                        <span>Amazon Buy Box win rate: +15%</span>
                                    </div>
                                    <div class="flex items-center">
                                        <div class="w-2 h-2 bg-purple-500 rounded-full mr-2"></div>
                                        <span>Customer lifetime value: +180%</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Action Items -->
                <div class="bg-gray-50 rounded-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-gray-800">üéØ Recommended Actions</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <button onclick="optimizeNotifications()" 
                                class="bg-blue-600 text-white p-4 rounded-lg hover:bg-blue-700 text-left">
                            <div class="text-lg font-semibold">üîß Optimize Templates</div>
                            <div class="text-sm opacity-90">Switch high-value customers to Professional template</div>
                        </button>
                        <button onclick="expandPlatforms()" 
                                class="bg-green-600 text-white p-4 rounded-lg hover:bg-green-700 text-left">
                            <div class="text-lg font-semibold">üåê Expand Platforms</div>
                            <div class="text-sm opacity-90">Connect Amazon Seller Central for bigger impact</div>
                        </button>
                        <button onclick="generateReport()" 
                                class="bg-purple-600 text-white p-4 rounded-lg hover:bg-purple-700 text-left">
                            <div class="text-lg font-semibold">üìä Export Report</div>
                            <div class="text-sm opacity-90">Download detailed ROI analysis for stakeholders</div>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Sea Freight Intelligence Page -->
            <div id="sea-freight" class="page">
                <h2 class="text-2xl font-bold mb-6">üö¢ Sea Freight Weather Intelligence</h2>
                
                <!-- Quick Stats -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-2 text-blue-800">üö¢ Active Containers</h3>
                        <div class="text-3xl font-bold text-blue-900">127</div>
                        <p class="text-sm text-blue-600 mt-1">Containers being tracked</p>
                        <div class="mt-2 text-xs text-blue-700">
                            ‚ö° 23 arriving this week
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-green-50 to-green-100 rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-2 text-green-800">‚≠ê On-Time Rate</h3>
                        <div class="text-3xl font-bold text-green-900">94%</div>
                        <p class="text-sm text-green-600 mt-1">With weather intelligence</p>
                        <div class="mt-2 text-xs text-green-700">
                            üìà +18% vs industry avg
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-2 text-yellow-800">üå™Ô∏è Weather Alerts</h3>
                        <div class="text-3xl font-bold text-yellow-900">3</div>
                        <p class="text-sm text-yellow-600 mt-1">Active weather events</p>
                        <div class="mt-2 text-xs text-yellow-700">
                            üåä Typhoon in South China Sea
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg shadow p-6">
                        <h3 class="text-lg font-semibold mb-2 text-purple-800">üí∞ Inventory Value</h3>
                        <div class="text-3xl font-bold text-purple-900">$2.4M</div>
                        <p class="text-sm text-purple-600 mt-1">In transit protection</p>
                        <div class="mt-2 text-xs text-purple-700">
                            üõ°Ô∏è Weather monitoring active
                        </div>
                    </div>
                </div>
                
                <!-- Container Tracking -->
                <div class="bg-white rounded-lg shadow p-6 mb-8">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-semibold text-gray-800">üìã Container Tracking Dashboard</h3>
                        <div class="flex space-x-2">
                            <button onclick="addContainer()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                ‚ûï Add Container
                            </button>
                            <button onclick="refreshContainers()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                                üîÑ Refresh All
                            </button>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Container</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Route</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Departure</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ETA</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Weather Status</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Inventory Value</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="containerTable" class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm font-medium text-gray-900">TEMU4567890</div>
                                        <div class="text-sm text-gray-500">40ft Container</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm text-gray-900">Shenzhen ‚Üí Long Beach</div>
                                        <div class="text-sm text-gray-500">Trans-Pacific Route</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                        Oct 15, 2024
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm text-gray-900">Nov 18, 2024</div>
                                        <div class="text-sm text-gray-500">+3 days (weather)</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                                            üå™Ô∏è Typhoon Risk
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                        $450,000
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <button onclick="viewContainer('TEMU4567890')" class="text-blue-600 hover:text-blue-900">
                                            View Details
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm font-medium text-gray-900">COSCO123456</div>
                                        <div class="text-sm text-gray-500">20ft Container</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm text-gray-900">Hamburg ‚Üí New York</div>
                                        <div class="text-sm text-gray-500">Trans-Atlantic Route</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                        Oct 20, 2024
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm text-gray-900">Nov 8, 2024</div>
                                        <div class="text-sm text-gray-500">On schedule</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                            ‚úÖ Clear Weather
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                        $180,000
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <button onclick="viewContainer('COSCO123456')" class="text-blue-600 hover:text-blue-900">
                                            View Details
                                        </button>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm font-medium text-gray-900">MAEU789012</div>
                                        <div class="text-sm text-gray-500">LCL Shipment</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm text-gray-900">Ningbo ‚Üí Rotterdam</div>
                                        <div class="text-sm text-gray-500">Asia-Europe Route</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                        Oct 25, 2024
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm text-gray-900">Dec 1, 2024</div>
                                        <div class="text-sm text-gray-500">Via Suez Canal</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                            ‚ö° Monitoring
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                        $75,000
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <button onclick="viewContainer('MAEU789012')" class="text-blue-600 hover:text-blue-900">
                                            View Details
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Major Ports Weather Status -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-xl font-semibold mb-4 text-gray-800">üåä Major Ports Weather Status</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between p-4 border rounded-lg">
                                <div class="flex items-center">
                                    <div class="w-3 h-3 bg-green-500 rounded-full mr-3"></div>
                                    <div>
                                        <div class="font-medium">Long Beach, CA</div>
                                        <div class="text-sm text-gray-600">No delays ‚Ä¢ Clear weather</div>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-sm text-gray-900">23 containers</div>
                                    <div class="text-xs text-gray-500">Arriving this week</div>
                                </div>
                            </div>
                            
                            <div class="flex items-center justify-between p-4 border rounded-lg bg-yellow-50">
                                <div class="flex items-center">
                                    <div class="w-3 h-3 bg-yellow-500 rounded-full mr-3"></div>
                                    <div>
                                        <div class="font-medium">Hong Kong</div>
                                        <div class="text-sm text-gray-600">Typhoon approaching ‚Ä¢ 2-day delays</div>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-sm text-gray-900">45 containers</div>
                                    <div class="text-xs text-gray-500">Delayed departures</div>
                                </div>
                            </div>
                            
                            <div class="flex items-center justify-between p-4 border rounded-lg">
                                <div class="flex items-center">
                                    <div class="w-3 h-3 bg-green-500 rounded-full mr-3"></div>
                                    <div>
                                        <div class="font-medium">Rotterdam</div>
                                        <div class="text-sm text-gray-600">Normal operations ‚Ä¢ Good weather</div>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-sm text-gray-900">18 containers</div>
                                    <div class="text-xs text-gray-500">On schedule</div>
                                </div>
                            </div>
                            
                            <div class="flex items-center justify-between p-4 border rounded-lg bg-red-50">
                                <div class="flex items-center">
                                    <div class="w-3 h-3 bg-red-500 rounded-full mr-3"></div>
                                    <div>
                                        <div class="font-medium">Suez Canal</div>
                                        <div class="text-sm text-gray-600">High winds ‚Ä¢ Traffic delays</div>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-sm text-gray-900">12 containers</div>
                                    <div class="text-xs text-gray-500">+24h delay</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-lg shadow p-6">
                        <h3 class="text-xl font-semibold mb-4 text-gray-800">üìÖ Inventory Planning Assistant</h3>
                        <div class="space-y-4">
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                <h4 class="font-semibold text-blue-800 mb-2">üéÑ Holiday Season Alert</h4>
                                <p class="text-sm text-blue-700 mb-3">
                                    Q4 inventory should ship by <strong>September 15</strong> to ensure arrival before Black Friday.
                                </p>
                                <div class="text-xs text-blue-600 space-y-1">
                                    <p>‚Ä¢ Trans-Pacific: 35-45 days + weather buffer</p>
                                    <p>‚Ä¢ Port congestion peaks in November</p>
                                    <p>‚Ä¢ Typhoon season: Aug-Nov delays common</p>
                                </div>
                            </div>
                            
                            <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                                <h4 class="font-semibold text-green-800 mb-2">üí° Smart Shipping Recommendation</h4>
                                <p class="text-sm text-green-700 mb-3">
                                    Ship your February inventory <strong>2 weeks early</strong> due to Chinese New Year port closures.
                                </p>
                                <button onclick="createShippingPlan()" class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700">
                                    Create Shipping Plan
                                </button>
                            </div>
                            
                            <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                                <h4 class="font-semibold text-purple-800 mb-2">üîÆ AI Prediction</h4>
                                <p class="text-sm text-purple-700">
                                    <strong>87% chance</strong> of delays on Asia-US routes next month due to La Ni√±a weather patterns.
                                </p>
                                <div class="text-xs text-purple-600 mt-2">
                                    Consider air freight for time-critical inventory
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Route Intelligence -->
                <div class="bg-white rounded-lg shadow p-6 mb-8">
                    <h3 class="text-xl font-semibold mb-4 text-gray-800">üó∫Ô∏è Route Weather Intelligence</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="border rounded-lg p-4">
                            <h4 class="font-semibold text-gray-800 mb-3">üåä Trans-Pacific</h4>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Average Transit:</span>
                                    <span class="font-medium">28 days</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Weather Risk:</span>
                                    <span class="font-medium text-yellow-600">Medium</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Active Routes:</span>
                                    <span class="font-medium">47</span>
                                </div>
                                <div class="text-xs text-gray-500 mt-2">
                                    Typhoon season: June-November
                                </div>
                            </div>
                        </div>
                        
                        <div class="border rounded-lg p-4">
                            <h4 class="font-semibold text-gray-800 mb-3">üåÄ Trans-Atlantic</h4>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Average Transit:</span>
                                    <span class="font-medium">18 days</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Weather Risk:</span>
                                    <span class="font-medium text-green-600">Low</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Active Routes:</span>
                                    <span class="font-medium">23</span>
                                </div>
                                <div class="text-xs text-gray-500 mt-2">
                                    Winter storms: Dec-March
                                </div>
                            </div>
                        </div>
                        
                        <div class="border rounded-lg p-4">
                            <h4 class="font-semibold text-gray-800 mb-3">üöÇ Asia-Europe</h4>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Average Transit:</span>
                                    <span class="font-medium">42 days</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Weather Risk:</span>
                                    <span class="font-medium text-blue-600">Monitoring</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Active Routes:</span>
                                    <span class="font-medium">31</span>
                                </div>
                                <div class="text-xs text-gray-500 mt-2">
                                    Suez Canal weather dependent
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Integration & APIs -->
                <div class="bg-gray-50 rounded-lg p-6">
                    <h3 class="text-lg font-semibold mb-4 text-gray-800">üîó Freight Forwarder Integrations</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="bg-white border rounded-lg p-4 hover:shadow-md transition-shadow">
                            <div class="flex items-center mb-3">
                                <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                                    üì¶
                                </div>
                                <div>
                                    <h4 class="font-medium">Flexport Integration</h4>
                                    <p class="text-sm text-gray-600">Digital freight forwarder</p>
                                </div>
                            </div>
                            <button onclick="connectFreightForwarder('flexport')" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">
                                Connect Flexport
                            </button>
                        </div>
                        
                        <div class="bg-white border rounded-lg p-4 hover:shadow-md transition-shadow">
                            <div class="flex items-center mb-3">
                                <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-3">
                                    üåê
                                </div>
                                <div>
                                    <h4 class="font-medium">Freightos Network</h4>
                                    <p class="text-sm text-gray-600">Freight marketplace</p>
                                </div>
                            </div>
                            <button onclick="connectFreightForwarder('freightos')" class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700">
                                Connect Freightos
                            </button>
                        </div>
                        
                        <div class="bg-white border rounded-lg p-4 hover:shadow-md transition-shadow">
                            <div class="flex items-center mb-3">
                                <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center mr-3">
                                    üìä
                                </div>
                                <div>
                                    <h4 class="font-medium">Project44 API</h4>
                                    <p class="text-sm text-gray-600">Visibility platform</p>
                                </div>
                            </div>
                            <button onclick="connectFreightForwarder('project44')" class="w-full bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700">
                                Connect Project44
                            </button>
                        </div>
                    </div>
                    
                    <div class="mt-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                        <h4 class="font-medium text-yellow-800 mb-2">üí° Pro Tip</h4>
                        <p class="text-sm text-yellow-700">
                            Connect your freight forwarder to automatically track all containers and get proactive weather alerts for your entire supply chain. Pricing: $5-10 per container per month.
                        </p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Load Aviation Weather Service -->
    <script>
        // Stub for missing dependencies to prevent errors
        window.AviationWeatherService = {
            getRouteWeather: function(origin, destination) {
                return Promise.resolve({
                    origin: {
                        airport: origin,
                        airportName: 'Demo Airport',
                        current: {
                            temperature: 22,
                            windSpeed: 15,
                            windDirection: 180,
                            visibility: 10,
                            cloudCover: 20,
                            humidity: 65
                        },
                        flightImpact: {
                            impactLevel: 'low',
                            cargoHandling: 'Normal conditions'
                        }
                    },
                    destination: {
                        airport: destination,
                        airportName: 'Demo Destination',
                        current: {
                            temperature: 18,
                            windSpeed: 12,
                            windDirection: 220,
                            visibility: 15,
                            cloudCover: 30,
                            humidity: 70
                        },
                        flightImpact: {
                            impactLevel: 'low',
                            cargoHandling: 'Normal conditions'
                        }
                    },
                    analysis: {
                        overallRisk: 'low',
                        departureConditions: 'Good',
                        arrivalConditions: 'Good',
                        recommendations: ['Weather conditions are favorable for flight operations']
                    },
                    timestamp: new Date().toISOString(),
                    isLive: false
                });
            }
        };
        
        window.AlertDeliveryAPI = function() {
            return {
                initialized: true,
                sendExecutiveAlert: function(data) {
                    return Promise.resolve({ success: true, demo: true });
                }
            };
        };
    </script>

    <script>
        // Page navigation
        function showPage(pageId) {
            console.log('Switching to page:', pageId);
            
            try {
                // Hide all pages
                document.querySelectorAll('.page').forEach(page => {
                    page.classList.remove('active');
                    console.log('Hiding page:', page.id);
                });
                
                // Show selected page
                const targetPage = document.getElementById(pageId);
                if (targetPage) {
                    targetPage.classList.add('active');
                    console.log('Showing page:', pageId);
                } else {
                    console.error('Page not found:', pageId);
                }
                
                // Update navigation active state
                document.querySelectorAll('nav a').forEach(link => {
                    link.classList.remove('bg-blue-100', 'text-blue-700');
                    link.classList.add('text-gray-700');
                });
                
                // Highlight active navigation item
                const activeLink = document.querySelector(`nav a[onclick*="showPage('${pageId}')"]`);
                if (activeLink) {
                    activeLink.classList.remove('text-gray-700');
                    activeLink.classList.add('bg-blue-100', 'text-blue-700');
                }
            } catch (error) {
                console.error('Error in showPage:', error);
            }
        }
        
        // Make showPage globally available
        window.showPage = showPage;

        // Aviation weather function
        async function getAviationWeather() {
            const origin = document.getElementById('originAirport').value;
            const destination = document.getElementById('destinationAirport').value;
            const resultsDiv = document.getElementById('weatherResults');
            const contentDiv = document.getElementById('weatherContent');

            // Show loading
            resultsDiv.style.display = 'block';
            contentDiv.innerHTML = '<p class="text-blue-600">Loading aviation weather data...</p>';

            try {
                // Check if aviation weather service is available
                if (!window.AviationWeatherService) {
                    throw new Error('Aviation Weather Service not available');
                }

                // Get route weather analysis
                const routeWeather = await window.AviationWeatherService.getRouteWeather(origin, destination);

                // Display aviation weather results
                contentDiv.innerHTML = `
                    <div class="space-y-6">
                        <div class="border-l-4 border-green-500 pl-4">
                            <h4 class="font-semibold text-green-800">‚úÖ Aviation Weather Service Active</h4>
                            <p class="text-green-700">Using live aviation weather data from Open-Meteo API</p>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Origin Airport -->
                            <div class="bg-blue-50 rounded-lg p-4">
                                <h4 class="font-semibold text-blue-800 mb-3">üõ´ ${routeWeather.origin.airport} - ${routeWeather.origin.airportName}</h4>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span>Temperature:</span>
                                        <span class="font-semibold">${routeWeather.origin.current.temperature}¬∞C</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Wind Speed:</span>
                                        <span class="font-semibold">${routeWeather.origin.current.windSpeed} km/h</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Wind Direction:</span>
                                        <span class="font-semibold">${routeWeather.origin.current.windDirection}¬∞</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Visibility:</span>
                                        <span class="font-semibold">${routeWeather.origin.current.visibility} km</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Cloud Cover:</span>
                                        <span class="font-semibold">${routeWeather.origin.current.cloudCover}%</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Humidity:</span>
                                        <span class="font-semibold">${routeWeather.origin.current.humidity}%</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Destination Airport -->
                            <div class="bg-green-50 rounded-lg p-4">
                                <h4 class="font-semibold text-green-800 mb-3">üõ¨ ${routeWeather.destination.airport} - ${routeWeather.destination.airportName}</h4>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span>Temperature:</span>
                                        <span class="font-semibold">${routeWeather.destination.current.temperature}¬∞C</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Wind Speed:</span>
                                        <span class="font-semibold">${routeWeather.destination.current.windSpeed} km/h</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Wind Direction:</span>
                                        <span class="font-semibold">${routeWeather.destination.current.windDirection}¬∞</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Visibility:</span>
                                        <span class="font-semibold">${routeWeather.destination.current.visibility} km</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Cloud Cover:</span>
                                        <span class="font-semibold">${routeWeather.destination.current.cloudCover}%</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Humidity:</span>
                                        <span class="font-semibold">${routeWeather.destination.current.humidity}%</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Route Analysis -->
                        <div class="bg-white border rounded-lg p-4">
                            <h4 class="font-semibold text-gray-800 mb-3">üõ©Ô∏è Flight Route Analysis</h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <span class="text-sm text-gray-600">Overall Risk</span>
                                    <p class="font-semibold text-lg ${getRiskColor(routeWeather.analysis.overallRisk)}">${routeWeather.analysis.overallRisk.toUpperCase()}</p>
                                </div>
                                <div>
                                    <span class="text-sm text-gray-600">Departure Conditions</span>
                                    <p class="font-semibold">${routeWeather.analysis.departureConditions}</p>
                                </div>
                                <div>
                                    <span class="text-sm text-gray-600">Arrival Conditions</span>
                                    <p class="font-semibold">${routeWeather.analysis.arrivalConditions}</p>
                                </div>
                            </div>
                            
                            <div class="mt-4">
                                <span class="text-sm text-gray-600">Recommendations</span>
                                <ul class="mt-1 text-sm text-gray-700">
                                    ${routeWeather.analysis.recommendations.map(rec => `<li>‚Ä¢ ${rec}</li>`).join('')}
                                </ul>
                            </div>
                        </div>

                        <!-- Flight Impact -->
                        <div class="bg-purple-50 rounded-lg p-4">
                            <h4 class="font-semibold text-purple-800 mb-3">‚úàÔ∏è Flight Impact Assessment</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                <div>
                                    <span class="text-purple-600">Departure Impact:</span>
                                    <p class="font-semibold">${routeWeather.origin.flightImpact.impactLevel.toUpperCase()}</p>
                                    <p class="text-xs text-purple-700">${routeWeather.origin.flightImpact.cargoHandling}</p>
                                </div>
                                <div>
                                    <span class="text-purple-600">Arrival Impact:</span>
                                    <p class="font-semibold">${routeWeather.destination.flightImpact.impactLevel.toUpperCase()}</p>
                                    <p class="text-xs text-purple-700">${routeWeather.destination.flightImpact.cargoHandling}</p>
                                </div>
                            </div>
                        </div>

                        <div class="text-xs text-gray-500 border-t pt-4">
                            <p>Data Source: ${routeWeather.origin.dataSource} | Last Updated: ${new Date(routeWeather.timestamp).toLocaleString()}</p>
                            <p>Live Data: ${routeWeather.isLive ? '‚úÖ Yes' : '‚ö†Ô∏è Using fallback data'}</p>
                        </div>
                    </div>
                `;

                console.log('‚úÖ Aviation weather data displayed:', routeWeather);

            } catch (error) {
                console.error('‚ùå Aviation weather error:', error);
                contentDiv.innerHTML = `
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <h4 class="font-semibold text-red-800">‚ùå Aviation Weather Error</h4>
                        <p class="text-red-700">${error.message}</p>
                        <div class="mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded">
                            <p class="text-yellow-800 text-sm"><strong>Note:</strong> If you're seeing this error, the aviation weather service might not be loaded properly. Try refreshing the page or check the console for more details.</p>
                        </div>
                    </div>
                `;
            }
        }

        function getRiskColor(risk) {
            switch (risk.toLowerCase()) {
                case 'low': return 'text-green-600';
                case 'moderate': return 'text-yellow-600';
                case 'high': return 'text-red-600';
                default: return 'text-gray-600';
            }
        }

        // Route Analysis Functions
        async function analyzeFlightRoute() {
            const origin = document.getElementById('routeOriginAirport').value;
            const destination = document.getElementById('routeDestinationAirport').value;
            const aircraftType = document.getElementById('aircraftType').value;
            const departureTime = document.getElementById('departureTime').value;
            const cargoWeight = document.getElementById('cargoWeight').value;

            // Show loading state
            const resultsDiv = document.getElementById('routeAnalysisResults');
            resultsDiv.classList.remove('hidden');
            
            document.getElementById('flightPathContent').innerHTML = '<p class="text-blue-600">Analyzing flight path...</p>';
            document.getElementById('weatherConditionsContent').innerHTML = '<p class="text-blue-600">Checking weather conditions...</p>';
            document.getElementById('riskAssessmentContent').innerHTML = '<p class="text-blue-600">Assessing risks...</p>';
            document.getElementById('alternativeRoutesContent').innerHTML = '<p class="text-blue-600">Finding alternatives...</p>';

            try {
                // Get route weather analysis
                const routeWeather = await window.AviationWeatherService.getRouteWeather(origin, destination);
                
                // Display flight path analysis
                displayFlightPathAnalysis(origin, destination, aircraftType, cargoWeight, routeWeather);
                
                // Display weather conditions
                displayWeatherConditions(routeWeather);
                
                // Display risk assessment
                displayRiskAssessment(routeWeather, aircraftType, cargoWeight);
                
                // Display alternative routes
                displayAlternativeRoutes(origin, destination, routeWeather);
                
            } catch (error) {
                console.error('Route analysis error:', error);
                document.getElementById('flightPathContent').innerHTML = `<p class="text-red-600">Error: ${error.message}</p>`;
            }
        }

        function displayFlightPathAnalysis(origin, destination, aircraftType, cargoWeight, routeWeather) {
            const aircraftSpecs = getAircraftSpecs(aircraftType);
            const distance = calculateDistance(origin, destination);
            const flightTime = calculateFlightTime(distance, aircraftSpecs.cruiseSpeed);
            
            document.getElementById('flightPathContent').innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Route:</span>
                            <span class="font-semibold">${origin} ‚Üí ${destination}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Distance:</span>
                            <span class="font-semibold">${distance.toLocaleString()} km</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Flight Time:</span>
                            <span class="font-semibold">${flightTime}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Aircraft:</span>
                            <span class="font-semibold">${aircraftSpecs.name}</span>
                        </div>
                    </div>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Max Payload:</span>
                            <span class="font-semibold">${aircraftSpecs.maxPayload.toLocaleString()} kg</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Cargo Load:</span>
                            <span class="font-semibold">${cargoWeight || 'Not specified'} kg</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Fuel Consumption:</span>
                            <span class="font-semibold">${calculateFuelConsumption(distance, aircraftSpecs)} L</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Load Efficiency:</span>
                            <span class="font-semibold">${cargoWeight ? ((cargoWeight / aircraftSpecs.maxPayload) * 100).toFixed(1) + '%' : 'N/A'}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        function displayWeatherConditions(routeWeather) {
            document.getElementById('weatherConditionsContent').innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-blue-50 rounded-lg p-4">
                        <h4 class="font-medium text-blue-800 mb-3">üõ´ Departure (${routeWeather.origin.airport})</h4>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span>Temperature:</span>
                                <span class="font-semibold">${routeWeather.origin.current.temperature}¬∞C</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Wind:</span>
                                <span class="font-semibold">${routeWeather.origin.current.windSpeed} km/h</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Visibility:</span>
                                <span class="font-semibold">${routeWeather.origin.current.visibility} km</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Cloud Cover:</span>
                                <span class="font-semibold">${routeWeather.origin.current.cloudCover}%</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-green-50 rounded-lg p-4">
                        <h4 class="font-medium text-green-800 mb-3">üõ¨ Arrival (${routeWeather.destination.airport})</h4>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span>Temperature:</span>
                                <span class="font-semibold">${routeWeather.destination.current.temperature}¬∞C</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Wind:</span>
                                <span class="font-semibold">${routeWeather.destination.current.windSpeed} km/h</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Visibility:</span>
                                <span class="font-semibold">${routeWeather.destination.current.visibility} km</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Cloud Cover:</span>
                                <span class="font-semibold">${routeWeather.destination.current.cloudCover}%</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-4 p-4 bg-gray-50 rounded-lg">
                    <h4 class="font-medium text-gray-800 mb-2">üå§Ô∏è En Route Conditions</h4>
                    <p class="text-sm text-gray-700">Weather conditions along the flight path are ${routeWeather.analysis.overallRisk.toLowerCase()} risk. ${routeWeather.analysis.recommendations[0] || 'Monitor conditions throughout flight.'}</p>
                </div>
            `;
        }

        function displayRiskAssessment(routeWeather, aircraftType, cargoWeight) {
            const riskLevel = routeWeather.analysis.overallRisk.toLowerCase();
            const riskColor = riskLevel === 'low' ? 'green' : riskLevel === 'moderate' ? 'yellow' : 'red';
            
            document.getElementById('riskAssessmentContent').innerHTML = `
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <span class="font-medium">Overall Risk Level:</span>
                        <span class="px-3 py-1 rounded-full text-sm font-medium bg-${riskColor}-100 text-${riskColor}-800">${routeWeather.analysis.overallRisk.toUpperCase()}</span>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <span class="text-sm text-gray-600">Departure Impact:</span>
                            <p class="font-semibold">${routeWeather.origin.flightImpact.impactLevel.toUpperCase()}</p>
                            <p class="text-xs text-gray-600">${routeWeather.origin.flightImpact.cargoHandling}</p>
                        </div>
                        <div>
                            <span class="text-sm text-gray-600">Arrival Impact:</span>
                            <p class="font-semibold">${routeWeather.destination.flightImpact.impactLevel.toUpperCase()}</p>
                            <p class="text-xs text-gray-600">${routeWeather.destination.flightImpact.cargoHandling}</p>
                        </div>
                    </div>
                    
                    <div class="bg-blue-50 rounded-lg p-4">
                        <h4 class="font-medium text-blue-800 mb-2">Recommendations:</h4>
                        <ul class="text-sm text-blue-700 space-y-1">
                            ${routeWeather.analysis.recommendations.map(rec => `<li>‚Ä¢ ${rec}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            `;
        }

        function displayAlternativeRoutes(origin, destination, routeWeather) {
            const alternatives = generateAlternativeRoutes(origin, destination);
            
            document.getElementById('alternativeRoutesContent').innerHTML = `
                <div class="space-y-4">
                    ${alternatives.map(alt => `
                        <div class="border rounded-lg p-4">
                            <div class="flex items-center justify-between mb-2">
                                <h4 class="font-medium">${alt.name}</h4>
                                <span class="text-sm px-2 py-1 rounded bg-${alt.riskColor}-100 text-${alt.riskColor}-800">${alt.risk}</span>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                                <div>
                                    <span class="text-gray-600">Distance:</span>
                                    <span class="font-semibold ml-2">${alt.distance} km</span>
                                </div>
                                <div>
                                    <span class="text-gray-600">Flight Time:</span>
                                    <span class="font-semibold ml-2">${alt.flightTime}</span>
                                </div>
                                <div>
                                    <span class="text-gray-600">Fuel Cost:</span>
                                    <span class="font-semibold ml-2">$${alt.fuelCost}</span>
                                </div>
                            </div>
                            <p class="text-xs text-gray-600 mt-2">${alt.description}</p>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // WhatsApp Notification Functions
        async function setupWhatsAppNotifications() {
            const phoneNumber = document.getElementById('whatsappNumber').value;
            const notificationType = document.getElementById('notificationType').value;
            const statusDiv = document.getElementById('whatsappStatus');

            if (!phoneNumber) {
                statusDiv.innerHTML = '<p class="text-red-600">Please enter a phone number</p>';
                return;
            }

            statusDiv.innerHTML = '<p class="text-blue-600">Setting up WhatsApp notifications...</p>';

            try {
                // Simulate WhatsApp setup
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                statusDiv.innerHTML = `
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                        <h4 class="font-semibold text-green-800">‚úÖ WhatsApp Notifications Enabled</h4>
                        <p class="text-green-700 text-sm">Phone: ${phoneNumber}</p>
                        <p class="text-green-700 text-sm">Type: ${notificationType.replace('_', ' ')}</p>
                        <p class="text-green-700 text-sm">Status: Active and monitoring</p>
                    </div>
                `;
                
                // Store notification settings
                localStorage.setItem('whatsappSettings', JSON.stringify({
                    phoneNumber,
                    notificationType,
                    enabled: true,
                    setupDate: new Date().toISOString()
                }));
                
            } catch (error) {
                statusDiv.innerHTML = `<p class="text-red-600">Error: ${error.message}</p>`;
            }
        }

        async function testWhatsAppNotification() {
            const statusDiv = document.getElementById('whatsappStatus');
            
            statusDiv.innerHTML = '<p class="text-blue-600">Sending test notification...</p>';

            try {
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                statusDiv.innerHTML = `
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <h4 class="font-semibold text-blue-800">üì± Test Notification Sent</h4>
                        <p class="text-blue-700 text-sm">Sample message: "‚úàÔ∏è Flight HKG‚ÜíLAX: Weather conditions GOOD. On-time departure expected. Cargo handling: Normal conditions."</p>
                        <p class="text-blue-700 text-sm">Delivery Status: Simulated (WhatsApp API not connected)</p>
                    </div>
                `;
            } catch (error) {
                statusDiv.innerHTML = `<p class="text-red-600">Test failed: ${error.message}</p>`;
            }
        }

        // Flight Tracking Functions
        let activeFlights = [];
        let flightIdCounter = 1;

        function searchFlight() {
            const flightNumber = document.getElementById('searchFlightNumber').value;
            const searchDate = document.getElementById('searchDate').value;
            const airline = document.getElementById('searchAirline').value;

            if (!flightNumber) {
                alert('Please enter a flight number');
                return;
            }

            // Simulate flight search
            const foundFlight = activeFlights.find(f => 
                f.flightNumber.toLowerCase().includes(flightNumber.toLowerCase())
            );

            if (foundFlight) {
                showFlightDetails(foundFlight);
            } else {
                alert(`Flight ${flightNumber} not found. Try creating a new flight or loading sample data.`);
            }
        }

        function createFlight() {
            const flightNumber = document.getElementById('newFlightNumber').value;
            const aircraftType = document.getElementById('newAircraftType').value;
            const origin = document.getElementById('newOrigin').value;
            const destination = document.getElementById('newDestination').value;
            const departureTime = document.getElementById('newDepartureTime').value;
            const cargoWeight = document.getElementById('newCargoWeight').value;

            if (!flightNumber || !departureTime) {
                alert('Please fill in flight number and departure time');
                return;
            }

            const newFlight = {
                id: flightIdCounter++,
                flightNumber: flightNumber.toUpperCase(),
                aircraftType,
                origin,
                destination,
                departureTime: new Date(departureTime),
                cargoWeight: parseInt(cargoWeight) || 0,
                status: Math.random() > 0.3 ? 'In Flight' : 'Pre-Departure',
                progress: Math.random() * 100,
                altitude: Math.random() > 0.5 ? Math.floor(Math.random() * 15000 + 30000) : 0,
                speed: Math.random() > 0.5 ? Math.floor(Math.random() * 200 + 800) : 0,
                estimatedArrival: new Date(Date.now() + Math.random() * 12 * 60 * 60 * 1000),
                createdAt: new Date()
            };

            activeFlights.push(newFlight);
            updateActiveFlightsList();
            
            // Clear form
            document.getElementById('newFlightNumber').value = '';
            document.getElementById('newCargoWeight').value = '';
            
            alert(`Flight ${newFlight.flightNumber} created successfully!`);
        }

        function loadSampleFlights() {
            const sampleFlights = [
                {
                    id: flightIdCounter++,
                    flightNumber: 'NV127',
                    aircraftType: 'B747F',
                    origin: 'HKG',
                    destination: 'LAX',
                    departureTime: new Date(Date.now() - 3 * 60 * 60 * 1000),
                    cargoWeight: 95000,
                    status: 'In Flight',
                    progress: 67,
                    altitude: 39000,
                    speed: 905,
                    estimatedArrival: new Date(Date.now() + 6 * 60 * 60 * 1000),
                    createdAt: new Date()
                },
                {
                    id: flightIdCounter++,
                    flightNumber: 'NV203',
                    aircraftType: 'B777F',
                    origin: 'SIN',
                    destination: 'FRA',
                    departureTime: new Date(Date.now() + 2 * 60 * 60 * 1000),
                    cargoWeight: 87000,
                    status: 'Pre-Departure',
                    progress: 0,
                    altitude: 0,
                    speed: 0,
                    estimatedArrival: new Date(Date.now() + 15 * 60 * 60 * 1000),
                    createdAt: new Date()
                },
                {
                    id: flightIdCounter++,
                    flightNumber: 'CX888',
                    aircraftType: 'B747F',
                    origin: 'DXB',
                    destination: 'NRT',
                    departureTime: new Date(Date.now() - 1 * 60 * 60 * 1000),
                    cargoWeight: 102000,
                    status: 'In Flight',
                    progress: 23,
                    altitude: 41000,
                    speed: 890,
                    estimatedArrival: new Date(Date.now() + 8 * 60 * 60 * 1000),
                    createdAt: new Date()
                },
                {
                    id: flightIdCounter++,
                    flightNumber: 'LH441',
                    aircraftType: 'A330F',
                    origin: 'CDG',
                    destination: 'MIA',
                    departureTime: new Date(Date.now() - 5 * 60 * 60 * 1000),
                    cargoWeight: 65000,
                    status: 'In Flight',
                    progress: 78,
                    altitude: 37000,
                    speed: 870,
                    estimatedArrival: new Date(Date.now() + 3 * 60 * 60 * 1000),
                    createdAt: new Date()
                }
            ];

            activeFlights = [...activeFlights, ...sampleFlights];
            updateActiveFlightsList();
            generateWeatherAlerts();
            alert('Sample flight data loaded successfully!');
        }

        function updateActiveFlightsList() {
            const listContainer = document.getElementById('activeFlightsList');
            
            if (activeFlights.length === 0) {
                listContainer.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <p>No active flights found</p>
                        <p class="text-sm">Create a new flight or load sample data to get started</p>
                    </div>
                `;
                return;
            }

            listContainer.innerHTML = activeFlights.map(flight => {
                const statusColor = flight.status === 'In Flight' ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800';
                const progressColor = flight.progress > 75 ? 'bg-green-500' : flight.progress > 25 ? 'bg-yellow-500' : 'bg-blue-500';
                
                return `
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center space-x-4">
                                <div>
                                    <h4 class="font-semibold text-lg">${flight.flightNumber}</h4>
                                    <p class="text-sm text-gray-600">${flight.aircraftType}</p>
                                </div>
                                <div class="text-2xl">‚úàÔ∏è</div>
                                <div>
                                    <p class="font-medium">${flight.origin} ‚Üí ${flight.destination}</p>
                                    <p class="text-sm text-gray-600">${flight.cargoWeight.toLocaleString()} kg cargo</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <span class="px-3 py-1 rounded-full text-xs font-medium ${statusColor}">${flight.status}</span>
                                <p class="text-sm text-gray-600 mt-1">ETA: ${flight.estimatedArrival.toLocaleTimeString()}</p>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <div class="flex justify-between text-sm text-gray-600 mb-1">
                                <span>Flight Progress</span>
                                <span>${Math.round(flight.progress)}%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="${progressColor} h-2 rounded-full transition-all duration-300" style="width: ${flight.progress}%"></div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 text-sm">
                            <div>
                                <span class="text-gray-600">Altitude:</span>
                                <span class="font-medium ml-1">${flight.altitude ? flight.altitude.toLocaleString() + ' ft' : 'On Ground'}</span>
                            </div>
                            <div>
                                <span class="text-gray-600">Speed:</span>
                                <span class="font-medium ml-1">${flight.speed ? flight.speed + ' km/h' : 'Stationary'}</span>
                            </div>
                            <div>
                                <span class="text-gray-600">Departure:</span>
                                <span class="font-medium ml-1">${flight.departureTime.toLocaleTimeString()}</span>
                            </div>
                            <div class="text-right">
                                <button onclick="showFlightDetails(${JSON.stringify(flight).replace(/"/g, '&quot;')})" 
                                        class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700">
                                    üìä View Details
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        async function showFlightDetails(flight) {
            document.getElementById('modalFlightTitle').textContent = `Flight ${flight.flightNumber} - ${flight.origin} ‚Üí ${flight.destination}`;
            document.getElementById('flightDetailsModal').classList.remove('hidden');
            document.getElementById('flightDetailsModal').classList.add('flex');
            
            const contentDiv = document.getElementById('flightDetailsContent');
            contentDiv.innerHTML = '<div class="text-center py-8">Loading flight details and weather data...</div>';
            
            try {
                // Get weather data for origin and destination
                const originWeather = await window.AviationWeatherService.getAirportWeather(flight.origin);
                const destinationWeather = await window.AviationWeatherService.getAirportWeather(flight.destination);
                const routeWeather = await window.AviationWeatherService.getRouteWeather(flight.origin, flight.destination);
                
                contentDiv.innerHTML = `
                    <div class="space-y-6">
                        <!-- Flight Overview -->
                        <div class="bg-blue-50 rounded-lg p-6">
                            <h3 class="text-xl font-semibold text-blue-800 mb-4">‚úàÔ∏è Flight Overview</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                <div>
                                    <span class="text-sm text-blue-600">Flight Number:</span>
                                    <p class="font-semibold text-blue-800">${flight.flightNumber}</p>
                                </div>
                                <div>
                                    <span class="text-sm text-blue-600">Aircraft:</span>
                                    <p class="font-semibold text-blue-800">${flight.aircraftType}</p>
                                </div>
                                <div>
                                    <span class="text-sm text-blue-600">Status:</span>
                                    <p class="font-semibold text-blue-800">${flight.status}</p>
                                </div>
                                <div>
                                    <span class="text-sm text-blue-600">Progress:</span>
                                    <p class="font-semibold text-blue-800">${Math.round(flight.progress)}%</p>
                                </div>
                                <div>
                                    <span class="text-sm text-blue-600">Cargo Weight:</span>
                                    <p class="font-semibold text-blue-800">${flight.cargoWeight.toLocaleString()} kg</p>
                                </div>
                                <div>
                                    <span class="text-sm text-blue-600">Current Altitude:</span>
                                    <p class="font-semibold text-blue-800">${flight.altitude ? flight.altitude.toLocaleString() + ' ft' : 'On Ground'}</p>
                                </div>
                                <div>
                                    <span class="text-sm text-blue-600">Current Speed:</span>
                                    <p class="font-semibold text-blue-800">${flight.speed ? flight.speed + ' km/h' : 'Stationary'}</p>
                                </div>
                                <div>
                                    <span class="text-sm text-blue-600">ETA:</span>
                                    <p class="font-semibold text-blue-800">${flight.estimatedArrival.toLocaleTimeString()}</p>
                                </div>
                            </div>
                        </div>

                        <!-- Real-Time Weather Intelligence -->
                        <div class="bg-white border rounded-lg p-6">
                            <h3 class="text-xl font-semibold text-gray-800 mb-4">üå§Ô∏è Real-Time Weather Intelligence</h3>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                <!-- Origin Weather -->
                                <div class="bg-blue-50 rounded-lg p-4">
                                    <h4 class="font-medium text-blue-800 mb-3">üõ´ Origin: ${originWeather.airport} (${originWeather.airportName})</h4>
                                    <div class="space-y-2 text-sm">
                                        <div class="flex justify-between">
                                            <span>Temperature:</span>
                                            <span class="font-semibold">${originWeather.current.temperature}¬∞C</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Wind Speed:</span>
                                            <span class="font-semibold">${originWeather.current.windSpeed} km/h</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Wind Direction:</span>
                                            <span class="font-semibold">${originWeather.current.windDirection}¬∞</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Visibility:</span>
                                            <span class="font-semibold">${originWeather.current.visibility} km</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Cloud Cover:</span>
                                            <span class="font-semibold">${originWeather.current.cloudCover}%</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Conditions:</span>
                                            <span class="font-semibold ${getSeverityColor(originWeather.conditions.severity)}">${originWeather.conditions.severity.toUpperCase()}</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Destination Weather -->
                                <div class="bg-green-50 rounded-lg p-4">
                                    <h4 class="font-medium text-green-800 mb-3">üõ¨ Destination: ${destinationWeather.airport} (${destinationWeather.airportName})</h4>
                                    <div class="space-y-2 text-sm">
                                        <div class="flex justify-between">
                                            <span>Temperature:</span>
                                            <span class="font-semibold">${destinationWeather.current.temperature}¬∞C</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Wind Speed:</span>
                                            <span class="font-semibold">${destinationWeather.current.windSpeed} km/h</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Wind Direction:</span>
                                            <span class="font-semibold">${destinationWeather.current.windDirection}¬∞</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Visibility:</span>
                                            <span class="font-semibold">${destinationWeather.current.visibility} km</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Cloud Cover:</span>
                                            <span class="font-semibold">${destinationWeather.current.cloudCover}%</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Conditions:</span>
                                            <span class="font-semibold ${getSeverityColor(destinationWeather.conditions.severity)}">${destinationWeather.conditions.severity.toUpperCase()}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Route Analysis -->
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h4 class="font-medium text-gray-800 mb-3">üó∫Ô∏è Route Weather Analysis</h4>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                    <div>
                                        <span class="text-sm text-gray-600">Overall Risk:</span>
                                        <p class="font-semibold ${getRiskColor(routeWeather.analysis.overallRisk)}">${routeWeather.analysis.overallRisk.toUpperCase()}</p>
                                    </div>
                                    <div>
                                        <span class="text-sm text-gray-600">Departure Conditions:</span>
                                        <p class="font-semibold text-gray-800">${routeWeather.analysis.departureConditions}</p>
                                    </div>
                                    <div>
                                        <span class="text-sm text-gray-600">Arrival Conditions:</span>
                                        <p class="font-semibold text-gray-800">${routeWeather.analysis.arrivalConditions}</p>
                                    </div>
                                </div>
                                <div>
                                    <span class="text-sm text-gray-600">Recommendations:</span>
                                    <ul class="mt-1 text-sm text-gray-700">
                                        ${routeWeather.analysis.recommendations.map(rec => `<li>‚Ä¢ ${rec}</li>`).join('')}
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Flight Timeline -->
                        <div class="bg-white border rounded-lg p-6">
                            <h3 class="text-xl font-semibold text-gray-800 mb-4">‚è±Ô∏è Flight Timeline</h3>
                            <div class="space-y-4">
                                <div class="flex items-center space-x-4">
                                    <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center text-white text-sm">1</div>
                                    <div class="flex-1">
                                        <p class="font-medium">Departure from ${flight.origin}</p>
                                        <p class="text-sm text-gray-600">${flight.departureTime.toLocaleString()}</p>
                                        <p class="text-xs text-green-600">‚úÖ Completed</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-4">
                                    <div class="w-8 h-8 ${flight.status === 'In Flight' ? 'bg-yellow-500' : 'bg-gray-300'} rounded-full flex items-center justify-center text-white text-sm">2</div>
                                    <div class="flex-1">
                                        <p class="font-medium">En Route</p>
                                        <p class="text-sm text-gray-600">Flight progress: ${Math.round(flight.progress)}%</p>
                                        <p class="text-xs ${flight.status === 'In Flight' ? 'text-yellow-600' : 'text-gray-500'}">${flight.status === 'In Flight' ? 'üü° In Progress' : '‚≠ï Pending'}</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-4">
                                    <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center text-white text-sm">3</div>
                                    <div class="flex-1">
                                        <p class="font-medium">Arrival at ${flight.destination}</p>
                                        <p class="text-sm text-gray-600">ETA: ${flight.estimatedArrival.toLocaleString()}</p>
                                        <p class="text-xs text-gray-500">‚≠ï Pending</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Actions -->
                        <div class="flex space-x-4">
                            <button onclick="refreshFlightWeather('${flight.flightNumber}')" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                                üîÑ Refresh Weather
                            </button>
                            <button onclick="sendWeatherAlert('${flight.flightNumber}')" class="bg-yellow-600 text-white px-6 py-2 rounded-lg hover:bg-yellow-700">
                                ‚ö†Ô∏è Send Weather Alert
                            </button>
                            <button onclick="generateFlightReport('${flight.flightNumber}')" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700">
                                üìä Generate Report
                            </button>
                        </div>
                    </div>
                `;
                
            } catch (error) {
                contentDiv.innerHTML = `
                    <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                        <h3 class="font-semibold text-red-800">‚ùå Error Loading Flight Details</h3>
                        <p class="text-red-700">${error.message}</p>
                    </div>
                `;
            }
        }

        function closeFlightDetails() {
            document.getElementById('flightDetailsModal').classList.add('hidden');
            document.getElementById('flightDetailsModal').classList.remove('flex');
        }

        function refreshFlights() {
            // Simulate real-time updates
            activeFlights.forEach(flight => {
                if (flight.status === 'In Flight') {
                    flight.progress = Math.min(100, flight.progress + Math.random() * 5);
                    flight.altitude = Math.max(0, flight.altitude + (Math.random() - 0.5) * 2000);
                    flight.speed = Math.max(0, flight.speed + (Math.random() - 0.5) * 50);
                }
            });
            updateActiveFlightsList();
            generateWeatherAlerts();
        }

        function generateWeatherAlerts() {
            const alertsContainer = document.getElementById('weatherAlerts');
            const alerts = [];

            activeFlights.forEach(flight => {
                if (flight.status === 'In Flight' && Math.random() > 0.7) {
                    const alertTypes = [
                        { type: 'wind', message: `Strong winds detected on route ${flight.origin}‚Üí${flight.destination}`, severity: 'warning' },
                        { type: 'visibility', message: `Reduced visibility at ${flight.destination}`, severity: 'caution' },
                        { type: 'turbulence', message: `Moderate turbulence reported for ${flight.flightNumber}`, severity: 'info' }
                    ];
                    const alert = alertTypes[Math.floor(Math.random() * alertTypes.length)];
                    alerts.push({
                        ...alert,
                        flightNumber: flight.flightNumber,
                        time: new Date().toLocaleTimeString()
                    });
                }
            });

            if (alerts.length === 0) {
                alertsContainer.innerHTML = `
                    <div class="text-gray-500 text-center py-4">
                        No active weather alerts
                    </div>
                `;
            } else {
                alertsContainer.innerHTML = alerts.map(alert => {
                    const colorClass = alert.severity === 'warning' ? 'bg-red-50 border-red-200 text-red-800' :
                                     alert.severity === 'caution' ? 'bg-yellow-50 border-yellow-200 text-yellow-800' :
                                     'bg-blue-50 border-blue-200 text-blue-800';
                    
                    return `
                        <div class="${colorClass} border rounded-lg p-3">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-medium">${alert.flightNumber}: ${alert.message}</p>
                                    <p class="text-xs opacity-75">${alert.time}</p>
                                </div>
                                <button class="text-xs opacity-75 hover:opacity-100">√ó</button>
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        function refreshFlightWeather(flightNumber) {
            alert(`Weather data refreshed for flight ${flightNumber}`);
        }

        function sendWeatherAlert(flightNumber) {
            alert(`Weather alert sent to flight crew of ${flightNumber}`);
        }

        function generateFlightReport(flightNumber) {
            alert(`Generating comprehensive report for flight ${flightNumber}`);
        }

        // Analytics Functions
        function generateAnalyticsCharts() {
            // Simulate data update
            const metrics = {
                onTimePerf: (92 + Math.random() * 6).toFixed(1) + '%',
                avgDelay: (6 + Math.random() * 8).toFixed(1) + ' min',
                weatherDiversions: (1.5 + Math.random() * 2).toFixed(1) + '%',
                loadFactor: (85 + Math.random() * 10).toFixed(1) + '%',
                cargoDelivered: (1200 + Math.random() * 100).toFixed(0) + ' tons',
                damageRate: (0.08 + Math.random() * 0.1).toFixed(2) + '%',
                weatherDelays: (10 + Math.random() * 8).toFixed(1) + '%',
                costImpact: '$' + (40000 + Math.random() * 20000).toFixed(0),
                routesOptimized: (150 + Math.random() * 20).toFixed(0)
            };

            // Update metrics
            Object.keys(metrics).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    element.textContent = metrics[key];
                    element.style.animation = 'pulse 0.5s ease-in-out';
                }
            });

            // Show success message
            alert('üìä Analytics updated with latest performance data!');
        }

        // Helper Functions
        function getAircraftSpecs(aircraftType) {
            const specs = {
                'cargo_747': { name: 'Boeing 747F', maxPayload: 140000, cruiseSpeed: 900 },
                'cargo_777': { name: 'Boeing 777F', maxPayload: 103000, cruiseSpeed: 905 },
                'cargo_a330': { name: 'Airbus A330F', maxPayload: 70000, cruiseSpeed: 870 },
                'cargo_md11': { name: 'MD-11F', maxPayload: 90000, cruiseSpeed: 850 },
                'passenger_777': { name: 'Boeing 777', maxPayload: 25000, cruiseSpeed: 905 },
                'passenger_a350': { name: 'Airbus A350', maxPayload: 30000, cruiseSpeed: 900 }
            };
            return specs[aircraftType] || specs['cargo_747'];
        }

        function calculateDistance(origin, destination) {
            // Comprehensive distance calculation for major cargo routes
            const distances = {
                // Asia Pacific Routes
                'HKG-LAX': 11640, 'HKG-FRA': 9070, 'HKG-LHR': 9650, 'HKG-ANC': 5950,
                'SIN-LAX': 17300, 'SIN-FRA': 10320, 'SIN-LHR': 10890, 'SIN-AMS': 10340,
                'NRT-LAX': 8750, 'NRT-ANC': 3490, 'NRT-FRA': 9560, 'NRT-JFK': 10850,
                'ICN-LAX': 9610, 'ICN-FRA': 8880, 'ICN-ANC': 3410,
                'PVG-LAX': 11100, 'PVG-FRA': 8300, 'PVG-AMS': 8100,
                'BOM-FRA': 6130, 'BOM-LHR': 6930, 'BOM-DXB': 1930,
                'SYD-LAX': 12050, 'SYD-SIN': 6300, 'SYD-HKG': 7400,
                
                // Europe Routes  
                'FRA-LAX': 9320, 'FRA-JFK': 6180, 'FRA-MIA': 7800, 'FRA-ANC': 7200,
                'CDG-LAX': 9100, 'CDG-JFK': 5840, 'CDG-MIA': 7350, 'CDG-DXB': 5250,
                'AMS-LAX': 8950, 'AMS-JFK': 5870, 'AMS-ANC': 6970,
                'LHR-LAX': 8750, 'LHR-JFK': 5550, 'LHR-DXB': 5500, 'LHR-HKG': 9650,
                'IST-FRA': 1590, 'IST-LHR': 2500, 'IST-DXB': 2000, 'IST-CAI': 770,
                'LGG-ANC': 6850, 'LGG-MIA': 7100,
                
                // North America Routes
                'LAX-JFK': 3970, 'LAX-ORD': 2800, 'LAX-ANC': 3370, 'LAX-MIA': 3760,
                'JFK-FRA': 6180, 'JFK-LHR': 5550, 'JFK-AMS': 5870, 'JFK-MIA': 1760,
                'ORD-FRA': 7100, 'ORD-AMS': 6640, 'ORD-LHR': 6350,
                'ANC-FRA': 7200, 'ANC-NRT': 3490, 'ANC-ICN': 3410, 'ANC-PVG': 4700,
                'MIA-FRA': 7800, 'MIA-CDG': 7350, 'MIA-LHR': 7100, 'MIA-BOG': 1130,
                'YYZ-LHR': 5720, 'YYZ-FRA': 6370, 'YYZ-AMS': 6200,
                
                // Middle East & Africa Routes
                'DXB-FRA': 5250, 'DXB-LHR': 5500, 'DXB-LAX': 13400, 'DXB-JFK': 11000,
                'DOH-FRA': 4850, 'DOH-LHR': 5250, 'DOH-LAX': 13200,
                'CAI-FRA': 2900, 'CAI-LHR': 3500, 'CAI-IST': 770,
                'JNB-FRA': 8500, 'JNB-LHR': 8900, 'JNB-DXB': 5900,
                'CPT-FRA': 9600, 'CPT-LHR': 9700, 'CPT-JNB': 1270,
                
                // South America Routes
                'GRU-FRA': 9850, 'GRU-CDG': 9200, 'GRU-MIA': 4300, 'GRU-JFK': 7700,
                'BOG-MIA': 1130, 'BOG-FRA': 8600, 'BOG-JFK': 4000
            };
            
            const key1 = `${origin}-${destination}`;
            const key2 = `${destination}-${origin}`;
            
            return distances[key1] || distances[key2] || this.calculateGreatCircleDistance(origin, destination);
        }
        
        function calculateGreatCircleDistance(origin, destination) {
            // Fallback: estimate distance based on coordinates if not in lookup table
            // This is a simplified calculation - in practice you'd use proper great circle distance
            const coords = {
                'HKG': [22.3080, 113.9185], 'SIN': [1.3644, 103.9915], 'ICN': [37.4602, 126.4407],
                'NRT': [35.7647, 140.3864], 'PVG': [31.1443, 121.8083], 'BOM': [19.0896, 72.8656],
                'SYD': [-33.9399, 151.1753], 'FRA': [50.0379, 8.5622], 'CDG': [49.0097, 2.5479],
                'AMS': [52.3105, 4.7683], 'LHR': [51.4700, -0.4543], 'IST': [41.2753, 28.7519],
                'LGG': [50.6374, 5.4432], 'ANC': [61.1744, -149.9961], 'MIA': [25.7959, -80.2870],
                'LAX': [33.9434, -118.4081], 'ORD': [41.9742, -87.9073], 'JFK': [40.6413, -73.7781],
                'YYZ': [43.6777, -79.6248], 'DXB': [25.2532, 55.3657], 'DOH': [25.2609, 51.6138],
                'CAI': [30.1219, 31.4056], 'JNB': [-26.1367, 28.2411], 'CPT': [-33.9687, 18.6017],
                'GRU': [-23.4356, -46.4731], 'BOG': [4.7016, -74.1469]
            };
            
            const originCoords = coords[origin];
            const destCoords = coords[destination];
            
            if (!originCoords || !destCoords) return 8500; // Default estimate
            
            // Simple distance calculation (not accurate but gives reasonable estimates)
            const latDiff = Math.abs(originCoords[0] - destCoords[0]);
            const lonDiff = Math.abs(originCoords[1] - destCoords[1]);
            const roughDistance = Math.sqrt(latDiff * latDiff + lonDiff * lonDiff) * 111; // Rough km conversion
            
            return Math.round(roughDistance);
        }

        function calculateFlightTime(distance, cruiseSpeed) {
            const hours = distance / cruiseSpeed;
            const h = Math.floor(hours);
            const m = Math.floor((hours - h) * 60);
            return `${h}h ${m}m`;
        }

        function calculateFuelConsumption(distance, aircraftSpecs) {
            const consumption = distance * (aircraftSpecs.maxPayload / 100000) * 2.5;
            return Math.round(consumption * 1000);
        }

        function generateAlternativeRoutes(origin, destination) {
            return [
                {
                    name: 'Direct Route (Recommended)',
                    distance: calculateDistance(origin, destination),
                    flightTime: '11h 30m',
                    fuelCost: '45,200',
                    risk: 'LOW',
                    riskColor: 'green',
                    description: 'Optimal direct route with favorable weather conditions'
                },
                {
                    name: 'Northern Route (Weather Avoidance)',
                    distance: calculateDistance(origin, destination) + 850,
                    flightTime: '12h 15m',
                    fuelCost: '48,100',
                    risk: 'LOW',
                    riskColor: 'green',
                    description: 'Avoid storm systems, slight fuel increase but safer conditions'
                },
                {
                    name: 'Southern Route (Fuel Efficient)',
                    distance: calculateDistance(origin, destination) + 420,
                    flightTime: '11h 45m',
                    fuelCost: '44,800',
                    risk: 'MODERATE',
                    riskColor: 'yellow',
                    description: 'More efficient winds but potential turbulence in some segments'
                }
            ];
        }

        // Authentication and User Management
        function checkAuthentication() {
            const userLoggedIn = localStorage.getItem('userLoggedIn');
            if (!userLoggedIn) {
                // Auto-login as demo user if not authenticated
                localStorage.setItem('userLoggedIn', 'demo');
                localStorage.setItem('userEmail', 'demo@nerva.com');
                localStorage.setItem('loginTime', new Date().toISOString());
            }
            
            // Update user info display
            const userEmail = localStorage.getItem('userEmail') || 'Unknown User';
            const loginTime = localStorage.getItem('loginTime');
            const userType = userLoggedIn === 'demo' ? 'Demo User' : userLoggedIn === 'guest' ? 'Guest User' : 'Authenticated User';
            
            document.getElementById('userInfo').textContent = `${userType} ‚Ä¢ ${userEmail}`;
            document.getElementById('userEmailDisplay').textContent = userEmail;
            document.getElementById('userStatusDisplay').textContent = userType;
            document.getElementById('userInitial').textContent = userEmail.charAt(0).toUpperCase();
            
            return true;
        }

        function showUserMenu() {
            const menu = document.getElementById('userMenu');
            menu.classList.toggle('hidden');
        }

        function logout() {
            localStorage.removeItem('userLoggedIn');
            localStorage.removeItem('userEmail');
            localStorage.removeItem('loginTime');
            window.location.href = 'index.html';
        }

        // Help System
        function showAppHelp() {
            document.getElementById('appHelpModal').classList.remove('hidden');
            document.getElementById('appHelpModal').classList.add('flex');
            showHelpSection('weather'); // Default to weather section
        }

        function closeAppHelp() {
            document.getElementById('appHelpModal').classList.add('hidden');
            document.getElementById('appHelpModal').classList.remove('flex');
        }

        function showHelpSection(section) {
            const helpContent = document.getElementById('helpContent');
            
            const helpSections = {
                weather: `
                    <div class="space-y-6">
                        <div class="bg-blue-50 rounded-lg p-6">
                            <h3 class="text-xl font-semibold text-blue-800 mb-4">üå§Ô∏è Aviation Weather Intelligence</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h4 class="font-medium text-blue-700 mb-3">How to Use</h4>
                                    <ol class="list-decimal list-inside space-y-2 text-sm text-blue-600">
                                        <li>Select origin and destination airports from dropdowns</li>
                                        <li>Click "Get Aviation Weather" to fetch real-time data</li>
                                        <li>Review weather conditions for both airports</li>
                                        <li>Check flight impact assessment and recommendations</li>
                                    </ol>
                                </div>
                                <div>
                                    <h4 class="font-medium text-blue-700 mb-3">Weather Metrics</h4>
                                    <ul class="space-y-2 text-sm text-blue-600">
                                        <li><strong>Temperature:</strong> Current air temperature in Celsius</li>
                                        <li><strong>Wind Speed:</strong> Surface wind speed in km/h</li>
                                        <li><strong>Visibility:</strong> Horizontal visibility in kilometers</li>
                                        <li><strong>Cloud Cover:</strong> Percentage of sky covered by clouds</li>
                                        <li><strong>Humidity:</strong> Relative humidity percentage</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="mt-4 p-4 bg-blue-100 rounded-lg">
                                <h4 class="font-medium text-blue-800 mb-2">Understanding Risk Levels</h4>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                                    <div>
                                        <span class="inline-block w-3 h-3 bg-green-500 rounded-full mr-2"></span>
                                        <strong>LOW:</strong> Excellent flying conditions, minimal delays expected
                                    </div>
                                    <div>
                                        <span class="inline-block w-3 h-3 bg-yellow-500 rounded-full mr-2"></span>
                                        <strong>MODERATE:</strong> Some weather impact, monitor conditions
                                    </div>
                                    <div>
                                        <span class="inline-block w-3 h-3 bg-red-500 rounded-full mr-2"></span>
                                        <strong>HIGH:</strong> Significant weather impact, delays likely
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `,
                routes: `
                    <div class="space-y-6">
                        <div class="bg-green-50 rounded-lg p-6">
                            <h3 class="text-xl font-semibold text-green-800 mb-4">üõ©Ô∏è Flight Route Analysis</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h4 class="font-medium text-green-700 mb-3">Route Planning Steps</h4>
                                    <ol class="list-decimal list-inside space-y-2 text-sm text-green-600">
                                        <li>Select origin and destination airports</li>
                                        <li>Choose aircraft type (cargo or passenger)</li>
                                        <li>Set departure date and time</li>
                                        <li>Enter cargo weight (optional)</li>
                                        <li>Click "Analyze Flight Route" for comprehensive analysis</li>
                                    </ol>
                                </div>
                                <div>
                                    <h4 class="font-medium text-green-700 mb-3">Aircraft Types Available</h4>
                                    <ul class="space-y-2 text-sm text-green-600">
                                        <li><strong>Boeing 747F:</strong> 140,000 kg max payload</li>
                                        <li><strong>Boeing 777F:</strong> 103,000 kg max payload</li>
                                        <li><strong>Airbus A330F:</strong> 70,000 kg max payload</li>
                                        <li><strong>MD-11F:</strong> 90,000 kg max payload</li>
                                        <li><strong>Passenger Aircraft:</strong> 25,000-30,000 kg cargo capacity</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="mt-4 p-4 bg-green-100 rounded-lg">
                                <h4 class="font-medium text-green-800 mb-2">Route Analysis Features</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-green-700">
                                    <div>
                                        <ul class="space-y-1">
                                            <li>‚Ä¢ Flight path distance and time calculations</li>
                                            <li>‚Ä¢ Weather conditions along the route</li>
                                            <li>‚Ä¢ Risk assessment for departure and arrival</li>
                                        </ul>
                                    </div>
                                    <div>
                                        <ul class="space-y-1">
                                            <li>‚Ä¢ Alternative route suggestions</li>
                                            <li>‚Ä¢ Fuel consumption estimates</li>
                                            <li>‚Ä¢ Load efficiency calculations</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `,
                notifications: `
                    <div class="space-y-6">
                        <div class="bg-yellow-50 rounded-lg p-6">
                            <h3 class="text-xl font-semibold text-yellow-800 mb-4">üì± Smart Notifications Setup</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h4 class="font-medium text-yellow-700 mb-3">Setup Instructions</h4>
                                    <ol class="list-decimal list-inside space-y-2 text-sm text-yellow-600">
                                        <li>Enter your phone number with country code (e.g., +27123456789)</li>
                                        <li>Select notification type from dropdown</li>
                                        <li>Click "Setup WhatsApp Alerts" to enable</li>
                                        <li>Use "Test Notification" to verify setup</li>
                                        <li>Settings are saved automatically</li>
                                    </ol>
                                </div>
                                <div>
                                    <h4 class="font-medium text-yellow-700 mb-3">Notification Types</h4>
                                    <ul class="space-y-2 text-sm text-yellow-600">
                                        <li><strong>Weather Alerts:</strong> Severe weather warnings, visibility changes</li>
                                        <li><strong>Flight Updates:</strong> Delays, diversions, status changes</li>
                                        <li><strong>Cargo Status:</strong> Loading updates, handling conditions</li>
                                        <li><strong>All Notifications:</strong> Complete monitoring package</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="mt-4 p-4 bg-yellow-100 rounded-lg">
                                <h4 class="font-medium text-yellow-800 mb-2">Sample Notification</h4>
                                <div class="bg-white p-3 rounded border text-sm text-gray-700">
                                    "‚úàÔ∏è Flight HKG‚ÜíLAX: Weather conditions MODERATE. Wind speed 25 km/h, visibility 12 km. Monitor crosswind limits. On-time departure expected. Cargo handling: Normal conditions."
                                </div>
                            </div>
                        </div>
                    </div>
                `,
                analytics: `
                    <div class="space-y-6">
                        <div class="bg-purple-50 rounded-lg p-6">
                            <h3 class="text-xl font-semibold text-purple-800 mb-4">üìä Performance Analytics Dashboard</h3>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div>
                                    <h4 class="font-medium text-purple-700 mb-3">Flight Performance</h4>
                                    <ul class="space-y-2 text-sm text-purple-600">
                                        <li><strong>On-Time Performance:</strong> Percentage of flights departing/arriving on schedule</li>
                                        <li><strong>Average Delay:</strong> Mean delay time across all flights</li>
                                        <li><strong>Weather Diversions:</strong> Flights diverted due to weather</li>
                                    </ul>
                                </div>
                                <div>
                                    <h4 class="font-medium text-purple-700 mb-3">Cargo Performance</h4>
                                    <ul class="space-y-2 text-sm text-purple-600">
                                        <li><strong>Load Factor:</strong> Percentage of aircraft capacity utilized</li>
                                        <li><strong>Cargo Delivered:</strong> Total tonnage successfully transported</li>
                                        <li><strong>Damage Rate:</strong> Percentage of cargo damaged during transport</li>
                                    </ul>
                                </div>
                                <div>
                                    <h4 class="font-medium text-purple-700 mb-3">Weather Impact</h4>
                                    <ul class="space-y-2 text-sm text-purple-600">
                                        <li><strong>Weather Delays:</strong> Percentage of delays caused by weather</li>
                                        <li><strong>Cost Impact:</strong> Financial impact of weather-related issues</li>
                                        <li><strong>Routes Optimized:</strong> Number of routes improved using weather data</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="mt-4 p-4 bg-purple-100 rounded-lg">
                                <h4 class="font-medium text-purple-800 mb-2">Using Analytics</h4>
                                <p class="text-sm text-purple-700">Click "Generate Analytics Report" to refresh data with latest performance metrics. Data is updated in real-time and shows simulated operational statistics.</p>
                            </div>
                        </div>
                    </div>
                `,
                airports: `
                    <div class="space-y-6">
                        <div class="bg-gray-50 rounded-lg p-6">
                            <h3 class="text-xl font-semibold text-gray-800 mb-4">üåç Supported Airport Network</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                <div class="bg-white rounded-lg p-4 border">
                                    <h4 class="font-medium text-gray-700 mb-3">üåè Asia Pacific (7 airports)</h4>
                                    <ul class="space-y-1 text-sm text-gray-600">
                                        <li><strong>HKG</strong> - Hong Kong International</li>
                                        <li><strong>SIN</strong> - Singapore Changi</li>
                                        <li><strong>ICN</strong> - Seoul Incheon</li>
                                        <li><strong>NRT</strong> - Tokyo Narita</li>
                                        <li><strong>PVG</strong> - Shanghai Pudong</li>
                                        <li><strong>BOM</strong> - Mumbai</li>
                                        <li><strong>SYD</strong> - Sydney Kingsford Smith</li>
                                    </ul>
                                </div>
                                <div class="bg-white rounded-lg p-4 border">
                                    <h4 class="font-medium text-gray-700 mb-3">üá™üá∫ Europe (6 airports)</h4>
                                    <ul class="space-y-1 text-sm text-gray-600">
                                        <li><strong>FRA</strong> - Frankfurt Airport</li>
                                        <li><strong>CDG</strong> - Paris Charles de Gaulle</li>
                                        <li><strong>AMS</strong> - Amsterdam Schiphol</li>
                                        <li><strong>LHR</strong> - London Heathrow</li>
                                        <li><strong>IST</strong> - Istanbul Airport</li>
                                        <li><strong>LGG</strong> - Li√®ge Airport</li>
                                    </ul>
                                </div>
                                <div class="bg-white rounded-lg p-4 border">
                                    <h4 class="font-medium text-gray-700 mb-3">üá∫üá∏ North America (6 airports)</h4>
                                    <ul class="space-y-1 text-sm text-gray-600">
                                        <li><strong>ANC</strong> - Anchorage International</li>
                                        <li><strong>MIA</strong> - Miami International</li>
                                        <li><strong>LAX</strong> - Los Angeles International</li>
                                        <li><strong>ORD</strong> - Chicago O'Hare</li>
                                        <li><strong>JFK</strong> - New York JFK</li>
                                        <li><strong>YYZ</strong> - Toronto Pearson</li>
                                    </ul>
                                </div>
                                <div class="bg-white rounded-lg p-4 border">
                                    <h4 class="font-medium text-gray-700 mb-3">üåç Middle East & Africa (5 airports)</h4>
                                    <ul class="space-y-1 text-sm text-gray-600">
                                        <li><strong>DXB</strong> - Dubai International</li>
                                        <li><strong>DOH</strong> - Doha Hamad International</li>
                                        <li><strong>CAI</strong> - Cairo International</li>
                                        <li><strong>JNB</strong> - Johannesburg O.R. Tambo</li>
                                        <li><strong>CPT</strong> - Cape Town International</li>
                                    </ul>
                                </div>
                                <div class="bg-white rounded-lg p-4 border">
                                    <h4 class="font-medium text-gray-700 mb-3">üåé South America (2 airports)</h4>
                                    <ul class="space-y-1 text-sm text-gray-600">
                                        <li><strong>GRU</strong> - S√£o Paulo Guarulhos</li>
                                        <li><strong>BOG</strong> - Bogot√° El Dorado</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="mt-4 p-4 bg-blue-100 rounded-lg">
                                <h4 class="font-medium text-blue-800 mb-2">Coverage Statistics</h4>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-blue-700">
                                    <div><strong>Total Airports:</strong> 26 major cargo hubs</div>
                                    <div><strong>Regions Covered:</strong> 5 continents</div>
                                    <div><strong>Route Combinations:</strong> 650+ possible routes</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `,
                tracking: `
                    <div class="space-y-6">
                        <div class="bg-red-50 rounded-lg p-6">
                            <h3 class="text-xl font-semibold text-red-800 mb-4">üõ´ Live Flight Tracking & Weather Intelligence</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h4 class="font-medium text-red-700 mb-3">Getting Started</h4>
                                    <ol class="list-decimal list-inside space-y-2 text-sm text-red-600">
                                        <li>Click "Load Sample Data" to see active flights</li>
                                        <li>Create new flights using the flight creation form</li>
                                        <li>Search existing flights by flight number</li>
                                        <li>Click "View Details" to see comprehensive flight information</li>
                                        <li>Monitor real-time weather intelligence for each flight</li>
                                    </ol>
                                </div>
                                <div>
                                    <h4 class="font-medium text-red-700 mb-3">Flight Information</h4>
                                    <ul class="space-y-2 text-sm text-red-600">
                                        <li><strong>Flight Status:</strong> In Flight, Pre-Departure, Landed</li>
                                        <li><strong>Progress Tracking:</strong> Real-time percentage completion</li>
                                        <li><strong>Current Metrics:</strong> Altitude, speed, ETA</li>
                                        <li><strong>Weather Integration:</strong> Origin and destination conditions</li>
                                        <li><strong>Risk Assessment:</strong> Route weather analysis</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="mt-4 p-4 bg-red-100 rounded-lg">
                                <h4 class="font-medium text-red-800 mb-2">Sample Flights Available</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-red-700">
                                    <div>
                                        <ul class="space-y-1">
                                            <li><strong>NV127:</strong> HKG ‚Üí LAX (In Flight, 67% complete)</li>
                                            <li><strong>NV203:</strong> SIN ‚Üí FRA (Pre-Departure)</li>
                                        </ul>
                                    </div>
                                    <div>
                                        <ul class="space-y-1">
                                            <li><strong>CX888:</strong> DXB ‚Üí NRT (In Flight, 23% complete)</li>
                                            <li><strong>LH441:</strong> CDG ‚Üí MIA (In Flight, 78% complete)</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-4 p-4 bg-white border border-red-200 rounded-lg">
                                <h4 class="font-medium text-red-800 mb-2">Weather Intelligence Features</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-red-700">
                                    <div>
                                        <h5 class="font-medium mb-1">Real-Time Data</h5>
                                        <ul class="text-xs space-y-1">
                                            <li>‚Ä¢ Live weather at origin and destination</li>
                                            <li>‚Ä¢ Route weather analysis and risk assessment</li>
                                            <li>‚Ä¢ Flight timeline with weather impact</li>
                                        </ul>
                                    </div>
                                    <div>
                                        <h5 class="font-medium mb-1">Monitoring & Alerts</h5>
                                        <ul class="text-xs space-y-1">
                                            <li>‚Ä¢ Automatic weather alerts generation</li>
                                            <li>‚Ä¢ Real-time flight status updates</li>
                                            <li>‚Ä¢ Weather-based recommendations</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            };

            helpContent.innerHTML = helpSections[section] || helpSections.weather;
        }

        // Close help modal on background click
        document.getElementById('appHelpModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeAppHelp();
            }
        });

        // Close user menu when clicking outside
        document.addEventListener('click', function(e) {
            const userMenu = document.getElementById('userMenu');
            const userButton = e.target.closest('[onclick="showUserMenu()"]');
            
            // Check if userMenu exists before calling contains
            if (!userButton && userMenu && !userMenu.contains(e.target)) {
                userMenu.classList.add('hidden');
            }
        });

        // Initialize
        window.addEventListener('load', function() {
            console.log('‚úàÔ∏è Clean Aviation Weather App loaded');
            
            // Check authentication first
            if (!checkAuthentication()) {
                return;
            }
            
            if (window.AviationWeatherService) {
                console.log('‚úÖ Aviation Weather Service detected:', window.AviationWeatherService.getStatus());
            } else {
                console.error('‚ùå Aviation Weather Service not found');
            }

            // Set default departure time to current time + 2 hours
            const departureInput = document.getElementById('departureTime');
            if (departureInput) {
                const now = new Date();
                now.setHours(now.getHours() + 2);
                departureInput.value = now.toISOString().slice(0, 16);
            }

            // Set default departure time for new flights
            const newDepartureInput = document.getElementById('newDepartureTime');
            if (newDepartureInput) {
                const now = new Date();
                now.setHours(now.getHours() + 4);
                newDepartureInput.value = now.toISOString().slice(0, 16);
            }

            // Set default search date to today
            const searchDateInput = document.getElementById('searchDate');
            if (searchDateInput) {
                const today = new Date();
                searchDateInput.value = today.toISOString().slice(0, 10);
            }

            // Load saved WhatsApp settings
            const savedSettings = localStorage.getItem('whatsappSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                document.getElementById('whatsappNumber').value = settings.phoneNumber || '';
                document.getElementById('notificationType').value = settings.notificationType || 'all';
                
                if (settings.enabled) {
                    document.getElementById('whatsappStatus').innerHTML = `
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                            <h4 class="font-semibold text-green-800">‚úÖ WhatsApp Notifications Active</h4>
                            <p class="text-green-700 text-sm">Setup: ${new Date(settings.setupDate).toLocaleDateString()}</p>
                        </div>
                    `;
                }
            }
        });

        // E-Commerce Customer Alert Test Functions
        function testExecutiveAlert() {
            const alertModal = createAlertModal(
                'üö® Customer Notification Test',
                'bg-red-50 border-red-200',
                'text-red-800',
                `
                <div class="space-y-4">
                    <div class="bg-white rounded-lg p-4 border border-red-300">
                        <h4 class="font-semibold text-red-900 mb-2">Order Delay: iPhone 15 Pro Max Case</h4>
                        <div class="text-sm text-red-700 space-y-2">
                            <p><strong>AWB:</strong> BA789456123 | <strong>Value:</strong> $2.4M</p>
                            <p><strong>Route:</strong> SEA ‚Üí FRA ‚Üí DXB</p>
                            <p><strong>Weather Event:</strong> Ice storms at Memphis hub (0.8\" accumulation)</p>
                            <p><strong>Impact:</strong> 3-hour delay, ground operations suspended</p>
                            <p><strong>NEW ETA:</strong> Tuesday 15:30 UTC (was 12:30 UTC)</p>
                        </div>
                    </div>
                    <div class="bg-yellow-50 rounded-lg p-3 border border-yellow-300">
                        <h5 class="font-medium text-yellow-800 mb-2">Executive Decision Required:</h5>
                        <div class="text-sm text-yellow-700 space-y-1">
                            <p>‚Ä¢ <strong>Option 1:</strong> Route via ATL hub (+$3,200 cost, 2h faster)</p>
                            <p>‚Ä¢ <strong>Option 2:</strong> Maintain current routing (weather clearing 14:00 UTC)</p>
                        </div>
                    </div>
                    <div class="bg-blue-50 rounded-lg p-3 border border-blue-300">
                        <h5 class="font-medium text-blue-800 mb-1">Alert Delivery Status:</h5>
                        <div class="text-sm text-blue-700 space-y-1">
                            <p>‚úì Email sent to: boeing.executives@boeing.com</p>
                            <p>‚úì SMS sent to: +1-206-555-BOEING</p>
                            <p>‚úì Teams notification: Boeing Supply Chain Channel</p>
                            <p>‚úì Slack alert: #boeing-urgent-alerts</p>
                        </div>
                    </div>
                </div>
                `
            );
            
            // Simulate delivery timing
            setTimeout(() => {
                showToast('üìß Executive alerts sent to all channels', 'success');
            }, 1500);
        }

        function testColdChainAlert() {
            const alertModal = createAlertModal(
                'üå°Ô∏è Cold Chain Integrity Alert Test',
                'bg-blue-50 border-blue-200',
                'text-blue-800',
                `
                <div class="space-y-4">
                    <div class="bg-white rounded-lg p-4 border border-blue-300">
                        <h4 class="font-semibold text-blue-900 mb-2">Moderna mRNA Vaccine Shipment</h4>
                        <div class="text-sm text-blue-700 space-y-2">
                            <p><strong>AWB:</strong> MD987654321 | <strong>Value:</strong> $1.8M</p>
                            <p><strong>Route:</strong> BOS ‚Üí FRA ‚Üí JFK</p>
                            <p><strong>Temperature Spec:</strong> -70¬∞C ¬± 10¬∞C</p>
                            <p><strong>Current Status:</strong> -68¬∞C (WITHIN SPEC)</p>
                            <p><strong>Weather Cause:</strong> Dense fog at FRA, visibility 200m</p>
                            <p><strong>Hold Duration:</strong> 2 hours (forecast clear by 16:00 CET)</p>
                        </div>
                    </div>
                    <div class="bg-green-50 rounded-lg p-3 border border-green-300">
                        <h5 class="font-medium text-green-800 mb-2">Temperature Integrity Status:</h5>
                        <div class="text-sm text-green-700 space-y-1">
                            <p>‚úì Continuous monitoring: No excursions detected</p>
                            <p>‚úì Backup systems: Dual LN2 supply, 48h capacity</p>
                            <p>‚úì Facility: Lufthansa Climate Center (FDA validated)</p>
                            <p>‚úì Documentation: Package prepared for regulatory compliance</p>
                        </div>
                    </div>
                    <div class="bg-purple-50 rounded-lg p-3 border border-purple-300">
                        <h5 class="font-medium text-purple-800 mb-1">Alert Delivery Status:</h5>
                        <div class="text-sm text-purple-700 space-y-1">
                            <p>‚úì Priority email: moderna.supply@moderna.com</p>
                            <p>‚úì SMS to regulatory team: +1-617-555-TEMP</p>
                            <p>‚úì WhatsApp: Cold chain manager</p>
                            <p>‚úì Insurance documentation: Auto-generated</p>
                        </div>
                    </div>
                </div>
                `
            );
            
            setTimeout(() => {
                showToast('üå°Ô∏è Cold chain alerts sent with temperature documentation', 'info');
            }, 1500);
        }

        function testCascadeAlert() {
            const alertModal = createAlertModal(
                'üîó Cascade Effect Prevention Alert Test',
                'bg-yellow-50 border-yellow-200',
                'text-yellow-800',
                `
                <div class="space-y-4">
                    <div class="bg-white rounded-lg p-4 border border-yellow-300">
                        <h4 class="font-semibold text-yellow-900 mb-2">Tesla JIT Production Components</h4>
                        <div class="text-sm text-yellow-700 space-y-2">
                            <p><strong>AWB:</strong> TS445566778 | <strong>Value:</strong> $850K</p>
                            <p><strong>Route:</strong> SIN ‚Üí LAX (Production Line 3)</p>
                            <p><strong>Weather Risk:</strong> Severe thunderstorms forecast at LAX</p>
                            <p><strong>Cascade Impact:</strong> 2,400 vehicles/day production at risk</p>
                            <p><strong>Downtime Cost:</strong> $150K/hour if line stops</p>
                            <p><strong>Window:</strong> 4-hour delivery window for JIT schedule</p>
                        </div>
                    </div>
                    <div class="bg-red-50 rounded-lg p-3 border border-red-300">
                        <h5 class="font-medium text-red-800 mb-2">Cascade Prevention Actions:</h5>
                        <div class="text-sm text-red-700 space-y-1">
                            <p>‚úì Alternative route via PHX calculated (+1.5h, $4,200)</p>
                            <p>‚úì Production team alerted: 2h advance notice</p>
                            <p>‚úì Backup inventory check: 6h emergency supply available</p>
                            <p>‚úì Executive escalation: Auto-dial to supply chain VP</p>
                        </div>
                    </div>
                    <div class="bg-orange-50 rounded-lg p-3 border border-orange-300">
                        <h5 class="font-medium text-orange-800 mb-1">Alert Delivery Status:</h5>
                        <div class="text-sm text-orange-700 space-y-1">
                            <p>‚úì Production alerts: tesla.production@tesla.com</p>
                            <p>‚úì Executive SMS: +1-512-555-ELON</p>
                            <p>‚úì Teams: Tesla Supply Chain Emergency</p>
                            <p>‚úì Cost analysis: $600K cascade prevention value</p>
                        </div>
                    </div>
                </div>
                `
            );
            
            setTimeout(() => {
                showToast('üîó Cascade prevention alerts sent to production team', 'warning');
            }, 1500);
        }

        function viewAlertLog() {
            const logModal = createAlertModal(
                'üìÑ Executive Alert Delivery Log',
                'bg-gray-50 border-gray-200',
                'text-gray-800',
                `
                <div class="space-y-3">
                    <div class="bg-white rounded-lg p-4 border">
                        <div class="flex justify-between items-center mb-2">
                            <span class="font-semibold text-red-800">15:42:33 UTC</span>
                            <span class="bg-red-100 text-red-800 px-2 py-1 rounded-full text-xs">HIGH-VALUE</span>
                        </div>
                        <p class="text-sm">Boeing $2.4M aerospace components - Memphis ice storm delay</p>
                        <div class="text-xs text-gray-600 mt-1">
                            ‚úì Email (2.1s) ‚úì SMS (2.3s) ‚úì Teams (2.8s) ‚úì Slack (1.9s)
                        </div>
                    </div>
                    <div class="bg-white rounded-lg p-4 border">
                        <div class="flex justify-between items-center mb-2">
                            <span class="font-semibold text-blue-800">14:28:15 UTC</span>
                            <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs">COLD-CHAIN</span>
                        </div>
                        <p class="text-sm">Moderna mRNA vaccines - Frankfurt fog hold, temp maintained</p>
                        <div class="text-xs text-gray-600 mt-1">
                            ‚úì Email (1.8s) ‚úì SMS (2.1s) ‚úì WhatsApp (3.2s) ‚úì Documentation (4.1s)
                        </div>
                    </div>
                    <div class="bg-white rounded-lg p-4 border">
                        <div class="flex justify-between items-center mb-2">
                            <span class="font-semibold text-yellow-800">13:15:47 UTC</span>
                            <span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded-full text-xs">CASCADE-RISK</span>
                        </div>
                        <p class="text-sm">Tesla JIT components - LAX thunderstorm forecast, production alert</p>
                        <div class="text-xs text-gray-600 mt-1">
                            ‚úì Email (1.5s) ‚úì SMS (1.9s) ‚úì Teams (2.4s) ‚úì Phone (12.3s)
                        </div>
                    </div>
                    <div class="bg-white rounded-lg p-4 border">
                        <div class="flex justify-between items-center mb-2">
                            <span class="font-semibold text-green-800">12:03:22 UTC</span>
                            <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs">SUCCESS</span>
                        </div>
                        <p class="text-sm">SpaceX mission components - Early arrival via tailwinds</p>
                        <div class="text-xs text-gray-600 mt-1">
                            ‚úì Email (1.3s) ‚úì Teams (1.7s) ‚úì Client acknowledged (4.2m)
                        </div>
                    </div>
                </div>
                <div class="mt-4 bg-blue-50 rounded-lg p-3">
                    <h5 class="font-medium text-blue-800 mb-2">Today's Performance:</h5>
                    <div class="grid grid-cols-2 gap-4 text-sm text-blue-700">
                        <div>‚Ä¢ 127 alerts sent</div>
                        <div>‚Ä¢ 94% delivery success</div>
                        <div>‚Ä¢ 2.3s avg delivery time</div>
                        <div>‚Ä¢ 89% client acknowledgment</div>
                    </div>
                </div>
                `
            );
        }

        // Helper function to create alert modals
        function createAlertModal(title, bgClass, textClass, content) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="p-6 border-b border-gray-200 ${bgClass}">
                        <div class="flex items-center justify-between">
                            <h2 class="text-2xl font-bold ${textClass}">${title}</h2>
                            <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                        </div>
                    </div>
                    <div class="p-6">
                        ${content}
                    </div>
                    <div class="p-6 border-t border-gray-200 text-center">
                        <button onclick="this.closest('.fixed').remove()" class="bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700">
                            Close Test Alert
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            return modal;
        }

        // Toast notification helper
        function showToast(message, type = 'info') {
            const colors = {
                success: 'bg-green-500',
                info: 'bg-blue-500', 
                warning: 'bg-yellow-500',
                error: 'bg-red-500'
            };
            
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg z-50 transform transition-all duration-300 translate-x-full`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            // Animate in
            setTimeout(() => {
                toast.classList.remove('translate-x-full');
            }, 100);
            
            // Animate out
            setTimeout(() => {
                toast.classList.add('translate-x-full');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // Additional placeholder functions for other buttons
        function searchShipments() {
            const shipmentRef = document.getElementById('shipmentRef').value;
            const clientCompany = document.getElementById('clientCompany').value;
            const resultsDiv = document.getElementById('shipmentResults');
            
            resultsDiv.style.display = 'block';
            showToast(`üîç Searching for shipments: ${shipmentRef || 'All'} | Client: ${clientCompany || 'All'}`, 'info');
        }

        function loadSampleShipments() {
            const resultsDiv = document.getElementById('shipmentResults');
            resultsDiv.style.display = 'block';
            showToast('üì¶ Sample shipment data loaded successfully', 'success');
        }

        function refreshOperations() {
            showToast('üîÑ Refreshing cargo operations data...', 'info');
        }

        function loadCargoSample() {
            showToast('üì¶ Loading cargo sample operations...', 'info');
        }

        // REAL Alert Delivery Functions
        let alertAPI = null;
        
        // Debug function to test if button works
        function testButtonClick() {
            console.log('üîß Test button click function called');
            alert('Button is working! Now testing real alert flow...');
            sendRealAlert();
        }

        // Initialize the Alert API
        async function initializeAlertAPI() {
            if (!alertAPI) {
                // Initialize in demo mode by default (browser-safe)
                const config = {
                    demoMode: true, // Always demo mode in browser
                    fromEmail: 'alerts@nerva-logistics.com',
                    fromName: 'NaviFlow Supply Chain Intelligence',
                    fromPhone: '+1-555-NERVA'
                };
                
                alertAPI = new AlertDeliveryAPI(config);
                const initialized = await alertAPI.initialize();
                
                if (initialized) {
                    showToast('‚úÖ Alert delivery system initialized (Demo mode)', 'success');
                } else {
                    showToast('‚ö†Ô∏è Alert system initialization failed', 'warning');
                }
                
                return initialized;
            }
            return true;
        }

        // Send a REAL alert (not just a test)
        async function sendRealAlert() {
            console.log('üöÄ Send Real Alert button clicked!');
            
            try {
                // Show immediate feedback
                showToast('üöÄ Initializing real alert system...', 'info');
                
                // Initialize API if needed
                const apiReady = await initializeAlertAPI();
                if (!apiReady) {
                    showToast('‚ö†Ô∏è Alert APIs not configured - using demo mode', 'warning');
                    // Continue with demo for now
                }

                // Get recipient information from user
                showToast('üìû Getting recipient details...', 'info');
                console.log('üìû Opening recipient details modal');
                
                // Test mode - skip modal for debugging
                const useTestMode = true;
                let recipients;
                
                if (useTestMode) {
                    console.log('üß™ Using test mode - skipping modal');
                    recipients = {
                        email: 'demo@test.com',
                        sms: '+1-555-DEMO',
                        slack: '#demo-alerts',
                        teams: 'Demo Team Channel'
                    };
                    showToast('üß™ Test mode: Using demo recipients', 'info');
                } else {
                    recipients = await getRecipientDetails();
                }
                
                console.log('üìù Recipients received:', recipients);
                
                if (!recipients) {
                    showToast('‚ùå Alert cancelled by user', 'info');
                    return;
                }

                // Prepare alert data
                const alertData = {
                    shipment: {
                        awb: 'REAL_' + Date.now(),
                        client: 'Demo Client Corporation',
                        description: 'High-Value Electronics',
                        value: '$1.2M',
                        route: 'SIN ‚Üí LAX',
                        priority: 'high',
                        newETA: 'Tomorrow 14:30 UTC',
                        custody: 'Intact - secure facility'
                    },
                    weather: {
                        description: 'Severe thunderstorms with hail',
                        cause: 'Weather system moving through LAX area',
                        impact: '2-hour delay expected'
                    },
                    recipients: recipients,
                    priority: 'high',
                    alternatives: [
                        { route: 'Via SFO hub', cost: '+$2,800', description: '1.5h faster arrival' },
                        { route: 'Current routing', cost: '$0', description: 'Weather clearing by 16:00 UTC' }
                    ]
                };

                // Show loading state
                showToast('üöÄ Sending real alerts to all channels...', 'info');
                
                // Send the actual alert
                if (alertAPI && alertAPI.initialized) {
                    const result = await alertAPI.sendExecutiveAlert(alertData);
                    
                    if (result.overallSuccess) {
                        showRealAlertResults(result);
                        showToast(`‚úÖ Alert sent successfully! Delivery time: ${result.deliveryTime}`, 'success');
                    } else {
                        showRealAlertResults(result);
                        showToast('‚ö†Ô∏è Some alerts failed to deliver - check results', 'warning');
                    }
                } else {
                    showToast('‚ùå Alert API not initialized properly', 'error');
                }
                
            } catch (error) {
                console.error('Real alert sending failed:', error);
                showToast('‚ùå Real alert sending failed: ' + error.message, 'error');
            }
        }

        // Test function for modal
        function testModal() {
            alert('Modal test function called!');
            return { email: 'test@demo.com', sms: '+1-555-TEST' };
        }
        
        // Get recipient details from user
        function getRecipientDetails() {
            console.log('üìã getRecipientDetails function called');
            return new Promise((resolve) => {
                console.log('üìã Creating modal promise');
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
                modal.innerHTML = `
                    <div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full">
                        <div class="p-6 border-b border-gray-200">
                            <h2 class="text-2xl font-bold text-gray-800">üöÄ Configure Real Alert Recipients</h2>
                            <p class="text-gray-600 mt-2">Enter REAL contact information to send actual alerts</p>
                        </div>
                        <div class="p-6">
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Executive Email *</label>
                                    <input type="email" id="realEmail" placeholder="ceo@client-company.com" 
                                           class="w-full border border-gray-300 rounded-lg px-3 py-2" required />
                                    <p class="text-xs text-gray-500 mt-1">This will receive the full executive alert email</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Executive SMS (Optional)</label>
                                    <input type="tel" id="realSMS" placeholder="+1-555-CEO-PHONE" 
                                           class="w-full border border-gray-300 rounded-lg px-3 py-2" />
                                    <p class="text-xs text-gray-500 mt-1">Critical alerts will be sent via SMS</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Slack Channel (Optional)</label>
                                    <input type="text" id="realSlack" placeholder="#supply-chain-alerts" 
                                           class="w-full border border-gray-300 rounded-lg px-3 py-2" />
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Teams Channel (Optional)</label>
                                    <input type="text" id="realTeams" placeholder="Supply Chain Operations" 
                                           class="w-full border border-gray-300 rounded-lg px-3 py-2" />
                                </div>
                            </div>
                            <div class="mt-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                                <p class="text-sm text-yellow-800">
                                    <strong>‚ö†Ô∏è Warning:</strong> This will send REAL alerts to the provided contacts. 
                                    Make sure you have permission to send to these recipients.
                                </p>
                            </div>
                        </div>
                        <div class="p-6 border-t border-gray-200 flex justify-end space-x-4">
                            <button id="cancelRealAlert_${Date.now()}" class="cancel-real-alert bg-gray-300 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-400">
                                Cancel
                            </button>
                            <button id="confirmRealAlert_${Date.now()}" class="confirm-real-alert bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700">
                                üöÄ Send Real Alerts
                            </button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Handle cancel button using class selector
                const cancelBtn = modal.querySelector('.cancel-real-alert');
                cancelBtn.addEventListener('click', function() {
                    console.log('‚ùå Cancel button clicked');
                    modal.remove();
                    resolve(null);
                });
                
                // Handle confirm button using class selector
                const confirmBtn = modal.querySelector('.confirm-real-alert');
                confirmBtn.addEventListener('click', function() {
                    console.log('üöÄ Confirm button clicked');
                    
                    const email = modal.querySelector('#realEmail').value;
                    const sms = modal.querySelector('#realSMS').value;
                    const slack = modal.querySelector('#realSlack').value;
                    const teams = modal.querySelector('#realTeams').value;
                    
                    console.log('Form values:', { email, sms, slack, teams });
                    
                    if (!email || email.trim() === '') {
                        alert('Executive email is required!');
                        return;
                    }
                    
                    const recipients = { email: email.trim() };
                    if (sms && sms.trim()) recipients.sms = sms.trim();
                    if (slack && slack.trim()) recipients.slack = slack.trim();
                    if (teams && teams.trim()) recipients.teams = teams.trim();
                    
                    console.log('Recipients collected:', recipients);
                    
                    modal.remove();
                    resolve(recipients);
                });
                
                // Also handle Enter key in email field
                const emailInput = modal.querySelector('#realEmail');
                emailInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        confirmBtn.click();
                    }
                });
            });
        }

        // Show real alert delivery results
        function showRealAlertResults(result) {
            // Automatically log this alert to history
            logAlertToHistory(result);
            
            // Generate marketplace documentation for this alert
            const marketplaceDoc = generateMarketplaceDocumentation(result, 'amazon');
            
            // Store documentation for later use
            const docHistory = JSON.parse(localStorage.getItem('marketplaceDocuments') || '[]');
            docHistory.unshift({
                alertId: result.alertId,
                timestamp: result.timestamp,
                documentation: marketplaceDoc,
                platform: 'amazon'
            });
            // Keep last 50 documents
            if (docHistory.length > 50) docHistory.splice(50);
            localStorage.setItem('marketplaceDocuments', JSON.stringify(docHistory));
            
            const modal = createAlertModal(
                'üìà Real Alert Delivery Results',
                'bg-green-50 border-green-200',
                'text-green-800',
                `
                <div class="space-y-4">
                    <div class="bg-white rounded-lg p-4 border">
                        <h4 class="font-semibold text-gray-900 mb-3">Alert ID: ${result.alertId}</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                            <div>
                                <span class="text-gray-600">Shipment:</span>
                                <span class="font-semibold ml-2">${result.shipment.awb}</span>
                            </div>
                            <div>
                                <span class="text-gray-600">Total Delivery Time:</span>
                                <span class="font-semibold ml-2">${result.deliveryTime}</span>
                            </div>
                            <div>
                                <span class="text-gray-600">Overall Status:</span>
                                <span class="font-semibold ml-2 ${result.overallSuccess ? 'text-green-600' : 'text-red-600'}">
                                    ${result.overallSuccess ? '‚úì Success' : '‚ùå Partial Failure'}
                                </span>
                            </div>
                            <div>
                                <span class="text-gray-600">Timestamp:</span>
                                <span class="font-semibold ml-2">${new Date(result.timestamp).toLocaleString()}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="space-y-3">
                        <h5 class="font-medium text-gray-800">Channel Delivery Status:</h5>
                        ${Object.entries(result.channels).map(([channel, status]) => `
                            <div class="bg-white rounded-lg p-3 border flex justify-between items-center">
                                <div>
                                    <span class="font-medium capitalize">${channel}</span>
                                    <div class="text-sm text-gray-600">
                                        ${status.recipient || status.channel || 'N/A'}
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="${status.success ? 'text-green-600' : 'text-red-600'} font-semibold">
                                        ${status.success ? '‚úì Delivered' : '‚ùå Failed'}
                                    </div>
                                    <div class="text-sm text-gray-500">
                                        ${status.deliveryTime || 'N/A'}
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="bg-blue-50 rounded-lg p-4">
                        <h5 class="font-medium text-blue-800 mb-2">What Happened:</h5>
                        <div class="text-sm text-blue-700 space-y-1">
                            <p>‚Ä¢ Real API calls were made to delivery services</p>
                            <p>‚Ä¢ Email templates were generated and sent</p>
                            <p>‚Ä¢ SMS messages were delivered to mobile devices</p>
                            <p>‚Ä¢ Team notifications were posted to channels</p>
                            <p>‚Ä¢ Delivery confirmations were tracked</p>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 rounded-lg p-4 border-l-4 border-blue-500">
                        <h5 class="font-medium text-gray-800 mb-2">üìä Alert Tracking:</h5>
                        <div class="text-sm text-gray-700">
                            <p>‚úÖ Alert has been automatically logged to Alert History</p>
                            <p>üìã View detailed tracking in the <strong>Alert History</strong> tab</p>
                        </div>
                    </div>
                    
                    <div class="bg-yellow-50 rounded-lg p-4 border-l-4 border-yellow-500">
                        <h5 class="font-medium text-gray-800 mb-2">üìã Marketplace Protection:</h5>
                        <div class="text-sm text-gray-700">
                            <p>‚úÖ Amazon dispute documentation auto-generated</p>
                            <p>üõ°Ô∏è Ready for seller protection if needed</p>
                            <button onclick="viewMarketplaceDoc('${result.alertId}')" 
                                    class="mt-2 bg-yellow-600 text-white px-3 py-1 rounded text-xs hover:bg-yellow-700">
                                View Documentation
                            </button>
                        </div>
                    </div>
                </div>
                `
            );
        }

        // Initialize alert API when page loads
        window.addEventListener('load', function() {
            console.log('üöÄ Page loaded - setting up alert system');
            
            // Add additional event listener as backup
            const realAlertBtn = document.getElementById('sendRealAlertBtn');
            if (realAlertBtn) {
                console.log('‚úÖ Real Alert button found');
                realAlertBtn.addEventListener('click', function(e) {
                    console.log('üöÄ Real Alert button clicked via event listener');
                    e.preventDefault();
                    sendRealAlert();
                });
            } else {
                console.log('‚ùå Real Alert button not found');
            }
            
            // Auto-initialize in background
            setTimeout(() => {
                initializeAlertAPI();
            }, 2000);
            
            // Initialize customer search functionality
            initializeCustomerSearch();
        });
        
        // Customer Import and Search Functions
        function showCustomerImport() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="p-6 border-b border-gray-200">
                        <h2 class="text-2xl font-bold text-gray-800">üì• Import Customers</h2>
                        <p class="text-gray-600 mt-2">Connect your e-commerce platforms to automatically track orders</p>
                    </div>
                    <div class="p-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Platform Integration -->
                            <div class="space-y-4">
                                <h3 class="font-semibold text-gray-800 mb-3">üè™ Platform Integration</h3>
                                
                                <div class="border rounded-lg p-4 hover:bg-gray-50 cursor-pointer" onclick="connectShopify()">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-3">
                                                üõçÔ∏è
                                            </div>
                                            <div>
                                                <h4 class="font-medium">Shopify Store</h4>
                                                <p class="text-sm text-gray-600">Import orders and customers</p>
                                            </div>
                                        </div>
                                        <button class="bg-green-600 text-white px-4 py-2 rounded-lg text-sm">Connect</button>
                                    </div>
                                </div>
                                
                                <div class="border rounded-lg p-4 hover:bg-gray-50 cursor-pointer" onclick="connectWooCommerce()">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center mr-3">
                                                üõí
                                            </div>
                                            <div>
                                                <h4 class="font-medium">WooCommerce Store</h4>
                                                <p class="text-sm text-gray-600">WordPress e-commerce orders</p>
                                            </div>
                                        </div>
                                        <button class="bg-purple-600 text-white px-4 py-2 rounded-lg text-sm">Connect</button>
                                    </div>
                                </div>
                                
                                <div class="border rounded-lg p-4 hover:bg-gray-50 cursor-pointer" onclick="connectAmazon()">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <div class="w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center mr-3">
                                                üì¶
                                            </div>
                                            <div>
                                                <h4 class="font-medium">Amazon Seller Central</h4>
                                                <p class="text-sm text-gray-600">Sync FBA/FBM orders</p>
                                            </div>
                                        </div>
                                        <button class="bg-orange-600 text-white px-4 py-2 rounded-lg text-sm">Connect</button>
                                    </div>
                                </div>
                                
                                <div class="border rounded-lg p-4 hover:bg-gray-50 cursor-pointer" onclick="connectEbay()">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                                                üè∑Ô∏è
                                            </div>
                                            <div>
                                                <h4 class="font-medium">eBay Store</h4>
                                                <p class="text-sm text-gray-600">Import sold listings</p>
                                            </div>
                                        </div>
                                        <button class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm">Connect</button>
                                    </div>
                                </div>
                                
                                <div class="border rounded-lg p-4 hover:bg-gray-50 cursor-pointer" onclick="uploadCSV()">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center mr-3">
                                                üìÑ
                                            </div>
                                            <div>
                                                <h4 class="font-medium">CSV Upload</h4>
                                                <p class="text-sm text-gray-600">Upload customer list manually</p>
                                            </div>
                                        </div>
                                        <button class="bg-purple-600 text-white px-4 py-2 rounded-lg text-sm">Upload</button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Sample Data -->
                            <div class="space-y-4">
                                <h3 class="font-semibold text-gray-800 mb-3">üìä Sample Customer Data</h3>
                                <div class="bg-gray-50 rounded-lg p-4 text-sm">
                                    <p class="font-medium mb-2">Recent Customers:</p>
                                    <div class="space-y-2">
                                        <div class="flex justify-between">
                                            <span>Sarah Johnson</span>
                                            <span class="text-gray-600">iPhone Cases</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Mike Chen</span>
                                            <span class="text-gray-600">Gaming Headset</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Emily Rodriguez</span>
                                            <span class="text-gray-600">Fitness Tracker</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>David Thompson</span>
                                            <span class="text-gray-600">Wireless Earbuds</span>
                                        </div>
                                        <div class="text-center text-gray-500 text-xs mt-3">
                                            + 1,247 more customers
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-blue-50 rounded-lg p-4">
                                    <h4 class="font-medium text-blue-800 mb-2">üí° Pro Tip</h4>
                                    <p class="text-sm text-blue-700">Connect your store to automatically track all orders and notify customers about weather delays before they contact you!</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-6 flex justify-end space-x-3">
                            <button onclick="this.closest('.fixed').remove()" class="px-4 py-2 text-gray-600 hover:text-gray-800">
                                Close
                            </button>
                            <div class="flex space-x-2">
                                <button onclick="loadSampleCustomers(); this.closest('.fixed').remove();" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 text-sm">
                                    üõçÔ∏è Shopify Sample
                                </button>
                                <button onclick="loadSampleWooCommerceData(); this.closest('.fixed').remove();" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 text-sm">
                                    üõí WooCommerce Sample
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        // Make this function globally accessible for refresh after Shopify import
        window.initializeCustomerSearch = function() {
            const searchInput = document.getElementById('customerSearch');
            const suggestionsDiv = document.getElementById('customerSuggestions');
            
            // Get customers from Shopify integration or fallback to sample data
            function getCustomerDatabase() {
                if (window.ShopifyIntegration && window.ShopifyIntegration.isConnected) {
                    const shopifyCustomers = window.ShopifyIntegration.getStoredCustomers();
                    if (shopifyCustomers.length > 0) {
                        return shopifyCustomers.map(customer => ({
                            name: customer.name,
                            email: customer.email,
                            recentOrder: customer.lastOrderId || 'Recent Order',
                            location: customer.addresses?.[0] ? 
                                     `${customer.addresses[0].city}, ${customer.addresses[0].province}` : 
                                     'Location Unknown',
                            ordersCount: customer.ordersCount,
                            totalSpent: customer.totalSpent,
                            platform: 'shopify'
                        }));
                    }
                }
                
                // Fallback sample data
                return [
                    { name: 'Sarah Johnson', email: 'sarah.m.johnson@gmail.com', recentOrder: 'iPhone 15 Pro Cases', location: 'Chicago, IL' },
                    { name: 'Mike Chen', email: 'mike.chen.tech@gmail.com', recentOrder: 'Gaming Headset', location: 'San Francisco, CA' },
                    { name: 'Emily Rodriguez', email: 'emily.rodriguez@outlook.com', recentOrder: 'Fitness Tracker', location: 'Austin, TX' },
                    { name: 'David Thompson', email: 'david.thompson@yahoo.com', recentOrder: 'Wireless Earbuds', location: 'New York, NY' },
                    { name: 'Lisa Park', email: 'lisa.park.orders@gmail.com', recentOrder: 'Phone Charger Bundle', location: 'Los Angeles, CA' },
                    { name: 'James Wilson', email: 'james.wilson@email.com', recentOrder: 'Bluetooth Speaker', location: 'Seattle, WA' },
                    { name: 'Maria Garcia', email: 'maria.garcia.shop@gmail.com', recentOrder: 'Laptop Stand', location: 'Miami, FL' },
                    { name: 'Robert Kim', email: 'robert.kim@tech.com', recentOrder: 'USB-C Hub', location: 'Denver, CO' }
                ];
            }
            
            if (searchInput) {
                // Remove existing event listener to prevent duplicates
                searchInput.removeEventListener('input', window.customerSearchHandler);
                
                // Create new event handler function
                window.customerSearchHandler = function(e) {
                    const query = e.target.value.toLowerCase();
                    if (query.length < 2) {
                        suggestionsDiv.classList.add('hidden');
                        return;
                    }
                    
                    const customerDatabase = getCustomerDatabase();
                    const matches = customerDatabase.filter(customer => 
                        customer.name.toLowerCase().includes(query) ||
                        customer.email.toLowerCase().includes(query) ||
                        customer.recentOrder.toLowerCase().includes(query)
                    );
                    
                    if (matches.length > 0) {
                        suggestionsDiv.innerHTML = matches.slice(0, 5).map(customer => `
                            <div class="px-4 py-3 hover:bg-gray-50 cursor-pointer border-b last:border-b-0" onclick="selectCustomer('${customer.name}', '${customer.email}')">
                                <div class="font-medium text-gray-900">${customer.name}</div>
                                <div class="text-sm text-gray-600">${customer.email}</div>
                                <div class="text-xs text-gray-500">Recent: ${customer.recentOrder} ‚Ä¢ ${customer.location}</div>
                            </div>
                        `).join('');
                        suggestionsDiv.classList.remove('hidden');
                    } else {
                        suggestionsDiv.classList.add('hidden');
                    }
                };
                
                // Add the new event listener
                searchInput.addEventListener('input', window.customerSearchHandler);
                
                // Hide suggestions when clicking outside (only add once)
                if (!window.customerClickHandlerAdded) {
                    document.addEventListener('click', function(e) {
                        if (!searchInput.contains(e.target) && !suggestionsDiv.contains(e.target)) {
                            suggestionsDiv.classList.add('hidden');
                        }
                    });
                    window.customerClickHandlerAdded = true;
                }
                
                console.log('‚úÖ Customer search initialized with data source:', {
                    hasShopifyIntegration: !!window.ShopifyIntegration,
                    isConnected: window.ShopifyIntegration?.isConnected,
                    customersAvailable: getCustomerDatabase().length
                });
            }
        }
        
        function selectCustomer(name, email) {
            document.getElementById('customerSearch').value = name;
            document.getElementById('customerSuggestions').classList.add('hidden');
            // You could store selected customer data for use in alerts
            console.log('Selected customer:', { name, email });
        }
        
        function loadSampleCustomers() {
            // If Shopify is connected, sync real data
            if (window.ShopifyIntegration && window.ShopifyIntegration.isConnected) {
                syncShopifyData();
            } else {
                // Load demo Shopify data
                if (window.ShopifyIntegration) {
                    // Simulate a Shopify connection for demo
                    window.ShopifyIntegration.shopDomain = 'demo-store';
                    window.ShopifyIntegration.isConnected = true;
                    window.ShopifyIntegration.syncedOrders = window.ShopifyIntegration.generateSampleOrders();
                    window.ShopifyIntegration.syncedCustomers = window.ShopifyIntegration.generateSampleCustomers();
                    
                    // Process and store the data
                    window.ShopifyIntegration.processOrders(window.ShopifyIntegration.syncedOrders);
                    window.ShopifyIntegration.processCustomers(window.ShopifyIntegration.syncedCustomers);
                    
                    showToast('üì• Sample Shopify data loaded - 3 orders, 3 customers imported', 'success');
                } else {
                    showToast('üì• 1,251 customers imported from connected stores', 'success');
                }
            }
        }
        
        function connectShopify() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full">
                    <div class="p-6">
                        <div class="text-center mb-6">
                            <div class="text-6xl mb-4">üõçÔ∏è</div>
                            <h2 class="text-2xl font-bold text-gray-800">Connect Shopify Store</h2>
                            <p class="text-gray-600 mt-2">Import your orders and customers automatically</p>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Store Domain</label>
                                <div class="flex">
                                    <input type="text" id="shopifyDomain" placeholder="mystore" 
                                           class="flex-1 border border-gray-300 rounded-l-lg px-3 py-2" />
                                    <span class="bg-gray-100 border border-l-0 border-gray-300 rounded-r-lg px-3 py-2 text-gray-600">
                                        .myshopify.com
                                    </span>
                                </div>
                                <p class="text-xs text-gray-500 mt-1">Enter your Shopify store domain</p>
                            </div>
                            
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                                <h4 class="font-medium text-blue-800 mb-1">What we'll import:</h4>
                                <div class="text-sm text-blue-700 space-y-1">
                                    <p>‚Ä¢ Recent orders and customer details</p>
                                    <p>‚Ä¢ Shipping addresses and tracking info</p>
                                    <p>‚Ä¢ Product information and order values</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-6 flex space-x-3">
                            <button onclick="this.closest('.fixed').remove()" 
                                    class="flex-1 px-4 py-2 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg">
                                Cancel
                            </button>
                            <button onclick="startShopifyConnection()" 
                                    class="flex-1 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 font-medium">
                                Connect Store
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function startShopifyConnection() {
            const domain = document.getElementById('shopifyDomain').value.trim();
            if (!domain) {
                alert('Please enter your store domain');
                return;
            }
            
            // Close the modal
            document.querySelector('.fixed').remove();
            
            // Connect to Shopify
            connectToShopify(domain);
        }
        
        function connectWooCommerce() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full">
                    <div class="p-6">
                        <div class="text-center mb-6">
                            <div class="text-6xl mb-4">üõí</div>
                            <h2 class="text-2xl font-bold text-gray-800">Connect WooCommerce Store</h2>
                            <p class="text-gray-600 mt-2">Import your WordPress e-commerce orders and customers</p>
                        </div>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Store URL</label>
                                <input type="text" id="wooStoreUrl" placeholder="https://yourdomain.com" 
                                       class="w-full border border-gray-300 rounded-lg px-3 py-2" />
                                <p class="text-xs text-gray-500 mt-1">Enter your WordPress/WooCommerce store URL</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Consumer Key</label>
                                <input type="text" id="wooConsumerKey" placeholder="ck_xxxxxxxxxxxxxxxx" 
                                       class="w-full border border-gray-300 rounded-lg px-3 py-2" />
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Consumer Secret</label>
                                <input type="password" id="wooConsumerSecret" placeholder="cs_xxxxxxxxxxxxxxxx" 
                                       class="w-full border border-gray-300 rounded-lg px-3 py-2" />
                            </div>
                            
                            <div class="bg-purple-50 border border-purple-200 rounded-lg p-3">
                                <h4 class="font-medium text-purple-800 mb-1">API Access Required:</h4>
                                <div class="text-sm text-purple-700 space-y-1">
                                    <p>‚Ä¢ Generate API keys in WooCommerce ‚Üí Settings ‚Üí Advanced ‚Üí REST API</p>
                                    <p>‚Ä¢ Set permissions to "Read/Write"</p>
                                    <p>‚Ä¢ Keep your keys secure and private</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-6 flex space-x-3">
                            <button onclick="this.closest('.fixed').remove()" 
                                    class="flex-1 px-4 py-2 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg">
                                Cancel
                            </button>
                            <button onclick="startWooCommerceConnection()" 
                                    class="flex-1 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 font-medium">
                                Connect Store
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function startWooCommerceConnection() {
            const storeUrl = document.getElementById('wooStoreUrl').value.trim();
            const consumerKey = document.getElementById('wooConsumerKey').value.trim();
            const consumerSecret = document.getElementById('wooConsumerSecret').value.trim();
            
            if (!storeUrl) {
                alert('Please enter your store URL');
                return;
            }
            
            // Close the modal
            document.querySelector('.fixed').remove();
            
            // Connect to WooCommerce
            connectToWooCommerce(storeUrl, consumerKey, consumerSecret);
        }
        
        function connectAmazon() {
            showToast('üì¶ Amazon Seller Central integration coming soon!', 'info');
        }
        
        function connectEbay() {
            showToast('üè∑Ô∏è eBay integration coming soon!', 'info');
        }
        
        function uploadCSV() {
            showToast('üìÑ CSV upload feature coming soon!', 'info');
        }
        
        function importCustomers() {
            showCustomerImport();
        }
        
        // Removed duplicate function - now using the one in shopify-integration.js
        
        function saveAlertSettings() {
            showToast('‚öôÔ∏è Alert settings saved successfully', 'success');
        }

        // ========== ALERT HISTORY MANAGEMENT ==========
        
        // Load and display alert history
        function refreshAlertHistory() {
            showToast('üîÑ Refreshing alert history...', 'info');
            
            if (!alertAPI) {
                loadSampleAlertHistory();
                return;
            }
            
            const deliveryLog = alertAPI.getDeliveryLog();
            updateAlertHistoryDisplay(deliveryLog);
            updateAlertStatistics(deliveryLog);
        }
        
        // Load sample data for demonstration
        function loadSampleAlertHistory() {
            const sampleAlerts = [
                {
                    alertId: 'ALT_1673234567890_ABC12',
                    timestamp: new Date(Date.now() - 3600000).toISOString(), // 1 hour ago
                    shipment: { 
                        awb: 'EC001234567', 
                        client: 'Michael B. (Chicago)', 
                        description: 'iPhone 15 Pro Case Set',
                        value: '$89.99'
                    },
                    overallSuccess: true,
                    deliveryTime: '2340ms',
                    channels: {
                        email: { success: true, deliveryTime: '1800ms', recipient: 'michael.b@gmail.com' },
                        sms: { success: true, deliveryTime: '2200ms', recipient: '+1-312-555-0123' }
                    }
                },
                {
                    alertId: 'ALT_1673234567891_DEF34',
                    timestamp: new Date(Date.now() - 7200000).toISOString(), // 2 hours ago
                    shipment: { 
                        awb: 'EC001234568', 
                        client: 'Sarah M. (Seattle)', 
                        description: 'Wireless Gaming Headset',
                        value: '$149.99'
                    },
                    overallSuccess: true,
                    deliveryTime: '3100ms',
                    channels: {
                        email: { success: true, deliveryTime: '2100ms', recipient: 'sarah.m@outlook.com' },
                        sms: { success: true, deliveryTime: '2800ms', recipient: '+1-206-555-0456' },
                        slack: { success: true, deliveryTime: '3100ms', channel: '#customer-alerts' }
                    }
                },
                {
                    alertId: 'ALT_1673234567892_GHI56',
                    timestamp: new Date(Date.now() - 10800000).toISOString(), // 3 hours ago
                    shipment: { 
                        awb: 'EC001234569', 
                        client: 'David L. (Austin)', 
                        description: 'Fitness Tracker Pro',
                        value: '$199.99'
                    },
                    overallSuccess: false,
                    deliveryTime: '5200ms',
                    channels: {
                        email: { success: true, deliveryTime: '1900ms', recipient: 'david.l@yahoo.com' },
                        sms: { success: false, error: 'Invalid phone number', recipient: '+1-512-555-XXXX' },
                        teams: { success: true, deliveryTime: '3400ms', channel: 'Customer Service Team' }
                    }
                }
            ];
            
            // Store sample data
            localStorage.setItem('alertHistory', JSON.stringify(sampleAlerts));
            updateAlertHistoryDisplay(sampleAlerts);
            updateAlertStatistics(sampleAlerts);
        }
        
        // Update the alert history table
        function updateAlertHistoryDisplay(alertHistory) {
            const tableBody = document.getElementById('alertHistoryTable');
            
            if (!alertHistory || alertHistory.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="px-6 py-8 text-center text-gray-500">
                            No alert history found. Send some alerts to see them tracked here.
                        </td>
                    </tr>
                `;
                return;
            }
            
            tableBody.innerHTML = alertHistory.map(alert => {
                const successChannels = Object.values(alert.channels).filter(ch => ch.success).length;
                const totalChannels = Object.keys(alert.channels).length;
                const successRate = totalChannels > 0 ? Math.round((successChannels / totalChannels) * 100) : 0;
                
                const statusColor = alert.overallSuccess ? 'text-green-600' : 'text-red-600';
                const statusIcon = alert.overallSuccess ? '‚úÖ' : '‚ùå';
                
                const channelBadges = Object.entries(alert.channels).map(([channel, data]) => {
                    const color = data.success ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
                    const icon = data.success ? '‚úì' : '‚úó';
                    return `<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${color} mr-1">
                        ${icon} ${channel}
                    </span>`;
                }).join('');
                
                return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            ${new Date(alert.timestamp).toLocaleString()}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="text-sm font-medium text-gray-900">${alert.shipment.client}</div>
                            <div class="text-sm text-gray-500">${alert.shipment.description}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                Weather Delay
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <div class="flex flex-wrap gap-1">
                                ${channelBadges}
                            </div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium ${statusColor}">
                            ${statusIcon} ${successRate}% (${successChannels}/${totalChannels})
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            ${alert.deliveryTime}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <button onclick="viewAlertDetails('${alert.alertId}')" 
                                    class="text-blue-600 hover:text-blue-900">
                                View Details
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        // Update statistics dashboard
        function updateAlertStatistics(alertHistory) {
            if (!alertHistory || alertHistory.length === 0) {
                document.getElementById('totalAlerts').textContent = '0';
                document.getElementById('successRate').textContent = '0%';
                document.getElementById('avgResponseTime').textContent = '0ms';
                document.getElementById('customerSaves').textContent = '0';
                return;
            }
            
            const totalAlerts = alertHistory.length;
            const successfulAlerts = alertHistory.filter(a => a.overallSuccess).length;
            const successRate = Math.round((successfulAlerts / totalAlerts) * 100);
            
            // Calculate average response time
            const avgTime = alertHistory.reduce((sum, alert) => {
                const timeMs = parseInt(alert.deliveryTime.replace('ms', ''));
                return sum + timeMs;
            }, 0) / alertHistory.length;
            
            document.getElementById('totalAlerts').textContent = totalAlerts.toString();
            document.getElementById('successRate').textContent = successRate + '%';
            document.getElementById('avgResponseTime').textContent = Math.round(avgTime) + 'ms';
            document.getElementById('customerSaves').textContent = totalAlerts.toString(); // Assuming each alert saves a customer inquiry
        }
        
        // View detailed alert information
        function viewAlertDetails(alertId) {
            const alertHistory = JSON.parse(localStorage.getItem('alertHistory') || '[]');
            const alert = alertHistory.find(a => a.alertId === alertId);
            
            if (!alert) {
                showToast('‚ùå Alert details not found', 'error');
                return;
            }
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <h2 class="text-2xl font-bold text-gray-800">üìß Alert Details: ${alert.alertId}</h2>
                            <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                        </div>
                    </div>
                    
                    <div class="p-6">
                        <!-- Alert Overview -->
                        <div class="bg-gray-50 rounded-lg p-4 mb-6">
                            <h3 class="text-lg font-semibold mb-3">üìã Alert Overview</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <span class="text-sm text-gray-600">Timestamp:</span>
                                    <p class="font-medium">${new Date(alert.timestamp).toLocaleString()}</p>
                                </div>
                                <div>
                                    <span class="text-sm text-gray-600">Customer:</span>
                                    <p class="font-medium">${alert.shipment.client}</p>
                                </div>
                                <div>
                                    <span class="text-sm text-gray-600">Order Value:</span>
                                    <p class="font-medium">${alert.shipment.value}</p>
                                </div>
                                <div>
                                    <span class="text-sm text-gray-600">Overall Success:</span>
                                    <p class="font-medium ${alert.overallSuccess ? 'text-green-600' : 'text-red-600'}">
                                        ${alert.overallSuccess ? '‚úÖ Success' : '‚ùå Partial Failure'}
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Channel Details -->
                        <div class="space-y-4">
                            <h3 class="text-lg font-semibold">üöÄ Delivery Channel Results</h3>
                            ${Object.entries(alert.channels).map(([channel, data]) => `
                                <div class="border rounded-lg p-4 ${data.success ? 'border-green-200 bg-green-50' : 'border-red-200 bg-red-50'}">
                                    <div class="flex items-center justify-between mb-2">
                                        <h4 class="font-medium capitalize ${data.success ? 'text-green-800' : 'text-red-800'}">
                                            ${data.success ? '‚úÖ' : '‚ùå'} ${channel.toUpperCase()}
                                        </h4>
                                        <span class="text-sm ${data.success ? 'text-green-600' : 'text-red-600'}">
                                            ${data.deliveryTime || 'Failed'}
                                        </span>
                                    </div>
                                    <div class="text-sm ${data.success ? 'text-green-700' : 'text-red-700'}">
                                        <p><strong>Recipient:</strong> ${data.recipient || data.channel || 'N/A'}</p>
                                        ${data.error ? `<p><strong>Error:</strong> ${data.error}</p>` : ''}
                                        ${data.messageId ? `<p><strong>Message ID:</strong> ${data.messageId}</p>` : ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="p-6 border-t border-gray-200 text-center">
                        <button onclick="this.closest('.fixed').remove()" 
                                class="bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700">
                            Close Details
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        // Export alert history
        function exportAlertHistory() {
            const alertHistory = JSON.parse(localStorage.getItem('alertHistory') || '[]');
            
            if (alertHistory.length === 0) {
                showToast('üìä No alert history to export', 'warning');
                return;
            }
            
            const csvData = alertHistory.map(alert => {
                const successChannels = Object.values(alert.channels).filter(ch => ch.success).length;
                const totalChannels = Object.keys(alert.channels).length;
                return [
                    alert.alertId,
                    new Date(alert.timestamp).toISOString(),
                    alert.shipment.client,
                    alert.shipment.description,
                    alert.shipment.value,
                    alert.overallSuccess ? 'Success' : 'Partial Failure',
                    `${successChannels}/${totalChannels}`,
                    alert.deliveryTime
                ].join(',');
            });
            
            const csv = [
                'Alert ID,Timestamp,Customer,Product,Value,Status,Success Rate,Delivery Time',
                ...csvData
            ].join('\\n');
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `alert-history-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
            
            showToast('üìä Alert history exported successfully', 'success');
        }
        
        // Quick action functions
        function sendTestAlert() {
            sendRealAlert(); // Use existing test alert function
        }
        
        function viewAlertTemplates() {
            showToast('üìù Alert template management coming soon...', 'info');
        }
        
        function alertAnalytics() {
            showToast('üìà Advanced analytics dashboard coming soon...', 'info');
        }
        
        // Automatically load alert history when page loads
        window.addEventListener('load', function() {
            setTimeout(() => {
                if (document.getElementById('alert-history')) {
                    loadSampleAlertHistory();
                }
            }, 1000);
        });
        
        // Store alerts when they are sent
        function logAlertToHistory(alertResult) {
            const alertHistory = JSON.parse(localStorage.getItem('alertHistory') || '[]');
            alertHistory.unshift(alertResult); // Add to beginning
            
            // Keep only last 100 alerts
            if (alertHistory.length > 100) {
                alertHistory.splice(100);
            }
            
            localStorage.setItem('alertHistory', JSON.stringify(alertHistory));
            
            // Update display if we're on the alert history page
            if (document.getElementById('alert-history') && !document.getElementById('alert-history').classList.contains('hidden')) {
                updateAlertHistoryDisplay(alertHistory);
                updateAlertStatistics(alertHistory);
            }
        }
        
        // ========== WOOCOMMERCE INTEGRATION ==========
        
        // Initialize WooCommerce integration
        let wooCommerceIntegration = null;
        
        function initializeWooCommerce() {
            if (!wooCommerceIntegration) {
                wooCommerceIntegration = new WooCommerceIntegration();
            }
            return wooCommerceIntegration;
        }
        
        // Connect to WooCommerce store
        async function connectToWooCommerce(storeUrl, consumerKey, consumerSecret) {
            try {
                showToast('üõí Connecting to WooCommerce store...', 'info');
                
                const wooCommerce = initializeWooCommerce();
                const success = await wooCommerce.authenticate(storeUrl, consumerKey, consumerSecret);
                
                if (success) {
                    showToast('‚úÖ WooCommerce store connected successfully!', 'success');
                    
                    // Load customers into search
                    updateCustomerSearch();
                } else {
                    showToast('‚ùå Failed to connect to WooCommerce store', 'error');
                }
            } catch (error) {
                console.error('WooCommerce connection error:', error);
                showToast('‚ùå Connection failed: ' + error.message, 'error');
            }
        }
        
        // Update customer search with data from both platforms
        function updateCustomerSearch() {
            const customerSearch = document.getElementById('customerSearch');
            if (!customerSearch) return;
            
            // Get customers from both platforms
            let allCustomers = [];
            
            // Add Shopify customers if available
            if (window.shopifyIntegration?.isConnected) {
                const shopifyCustomers = window.shopifyIntegration.getAllCustomers();
                allCustomers = allCustomers.concat(shopifyCustomers);
            }
            
            // Add WooCommerce customers if available
            if (wooCommerceIntegration?.isConnected) {
                const wooCustomers = wooCommerceIntegration.getAllCustomers();
                allCustomers = allCustomers.concat(wooCustomers);
            }
            
            // Setup autocomplete
            setupCustomerAutocomplete(allCustomers);
            
            console.log(`üìã Updated customer search with ${allCustomers.length} customers`);
        }
        
        // Setup customer autocomplete functionality
        function setupCustomerAutocomplete(customers) {
            const searchInput = document.getElementById('customerSearch');
            const suggestionsDiv = document.getElementById('customerSuggestions');
            
            if (!searchInput || !suggestionsDiv || !customers.length) return;
            
            searchInput.addEventListener('input', function(e) {
                const query = e.target.value.toLowerCase().trim();
                
                if (query.length < 2) {
                    suggestionsDiv.classList.add('hidden');
                    return;
                }
                
                // Filter customers
                const matches = customers.filter(customer => 
                    customer.name.toLowerCase().includes(query) ||
                    customer.email.toLowerCase().includes(query) ||
                    customer.city.toLowerCase().includes(query)
                ).slice(0, 5); // Limit to 5 suggestions
                
                if (matches.length > 0) {
                    suggestionsDiv.innerHTML = matches.map(customer => `
                        <div class="px-3 py-2 hover:bg-gray-100 cursor-pointer border-b border-gray-100 last:border-b-0" 
                             onclick="selectCustomer('${customer.id}', '${customer.platform}')">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="font-medium text-gray-900">${customer.name}</div>
                                    <div class="text-sm text-gray-600">${customer.email}</div>
                                </div>
                                <div class="text-right">
                                    <div class="text-sm font-medium text-gray-900">${customer.orders} orders</div>
                                    <div class="text-xs text-gray-500">${customer.platform}</div>
                                </div>
                            </div>
                        </div>
                    `).join('');
                    suggestionsDiv.classList.remove('hidden');
                } else {
                    suggestionsDiv.classList.add('hidden');
                }
            });
            
            // Hide suggestions when clicking outside
            document.addEventListener('click', function(e) {
                if (!searchInput.contains(e.target)) {
                    suggestionsDiv.classList.add('hidden');
                }
            });
        }
        
        // Select a customer from autocomplete
        function selectCustomer(customerId, platform) {
            const searchInput = document.getElementById('customerSearch');
            const suggestionsDiv = document.getElementById('customerSuggestions');
            
            let customer = null;
            
            if (platform === 'Shopify' && window.shopifyIntegration) {
                const customers = window.shopifyIntegration.getAllCustomers();
                customer = customers.find(c => c.id == customerId);
            } else if (platform === 'WooCommerce' && wooCommerceIntegration) {
                const customers = wooCommerceIntegration.getAllCustomers();
                customer = customers.find(c => c.id == customerId);
            }
            
            if (customer) {
                searchInput.value = `${customer.name} (${customer.email})`;
                suggestionsDiv.classList.add('hidden');
                showToast(`‚úÖ Selected ${customer.name} from ${platform}`, 'success');
            }
        }
        
        // Load sample data for WooCommerce (for demo purposes)
        function loadSampleWooCommerceData() {
            const wooCommerce = initializeWooCommerce();
            
            // Simulate connection with demo data
            wooCommerce.isConnected = true;
            wooCommerce.loadData();
            
            if (wooCommerce.syncedCustomers.length === 0) {
                // Load sample data if none exists
                wooCommerce.syncAllData();
            }
            
            updateCustomerSearch();
            showToast('üìã WooCommerce sample data loaded', 'success');
        }
        
        // Initialize integrations when page loads
        window.addEventListener('load', function() {
            console.log('üõí Initializing e-commerce integrations...');
            
            // Initialize WooCommerce
            initializeWooCommerce();
            
            // Update customer search with any existing data
            setTimeout(() => {
                updateCustomerSearch();
            }, 1500);
        });
        
        // ========== ANALYTICS DASHBOARD & ROI ==========
        
        // Load analytics data when analytics page is viewed
        function loadAnalyticsData() {
            const alertHistory = JSON.parse(localStorage.getItem('alertHistory') || '[]');
            const customerData = getAllConnectedCustomers();
            
            // Calculate ROI metrics based on actual data
            const metrics = calculateROIMetrics(alertHistory, customerData);
            updateAnalyticsDashboard(metrics);
        }
        
        // Calculate ROI metrics from real data
        function calculateROIMetrics(alertHistory, customers) {
            const totalAlerts = alertHistory.length;
            const successfulAlerts = alertHistory.filter(a => a.overallSuccess).length;
            
            // Estimate business impact
            const avgOrderValue = 89.99; // Average from sample data
            const preventedCancellationRate = 0.15; // 15% would have cancelled
            const revenueProtected = totalAlerts * avgOrderValue * preventedCancellationRate;
            
            const supportTimePerTicket = 15; // 15 minutes per support ticket
            const supportHourlyRate = 25; // $25/hour
            const supportSavings = (totalAlerts * supportTimePerTicket / 60) * supportHourlyRate;
            
            const ratingSavings = totalAlerts * 12; // $12 value per prevented bad review
            const repeatCustomerValue = successfulAlerts * 25; // $25 additional lifetime value
            
            const monthlyValue = revenueProtected + supportSavings + ratingSavings + repeatCustomerValue;
            const monthlyCost = 199; // Including setup costs
            const netProfit = monthlyValue - monthlyCost;
            const roiPercentage = monthlyCost > 0 ? Math.round((netProfit / monthlyCost) * 100) : 0;
            
            return {
                revenueProtected: Math.round(revenueProtected),
                reviewsProtected: Math.round(totalAlerts * 0.8), // 80% would have been bad reviews
                satisfactionScore: Math.round((successfulAlerts / Math.max(totalAlerts, 1)) * 100),
                ticketsSaved: totalAlerts,
                timeSaved: Math.round(totalAlerts * supportTimePerTicket / 60 * 10) / 10, // Hours
                monthlyValue: Math.round(monthlyValue),
                supportSavings: Math.round(supportSavings),
                ratingSavings: Math.round(ratingSavings),
                repeatRevenue: Math.round(repeatCustomerValue),
                netProfit: Math.round(netProfit),
                roiPercentage: roiPercentage,
                customerThankYou: Math.round(successfulAlerts * 0.3), // 30% send thank you
                revenueGrowth: 23 + Math.round(successfulAlerts * 0.5) // Growth correlation
            };
        }
        
        // Update analytics dashboard with calculated metrics
        function updateAnalyticsDashboard(metrics) {
            // Update KPI cards
            document.getElementById('revenueProtected').textContent = '$' + metrics.revenueProtected.toLocaleString();
            document.getElementById('reviewsProtected').textContent = metrics.reviewsProtected.toString();
            document.getElementById('satisfactionScore').textContent = metrics.satisfactionScore + '%';
            document.getElementById('ticketsSaved').textContent = metrics.ticketsSaved.toString();
            document.getElementById('timeSaved').textContent = metrics.timeSaved + 'h';
            document.getElementById('customerThankYou').textContent = metrics.customerThankYou.toString();
            document.getElementById('revenueGrowth').textContent = '+' + metrics.revenueGrowth + '%';
            
            // Update ROI calculator
            document.getElementById('monthlyRevenue').textContent = '$' + metrics.revenueProtected.toLocaleString();
            document.getElementById('supportSavings').textContent = '$' + metrics.supportSavings.toLocaleString();
            document.getElementById('ratingSavings').textContent = '$' + metrics.ratingSavings.toLocaleString();
            document.getElementById('repeatRevenue').textContent = '$' + metrics.repeatRevenue.toLocaleString();
            document.getElementById('totalMonthlyValue').textContent = '$' + metrics.monthlyValue.toLocaleString();
            document.getElementById('netProfit').textContent = '$' + metrics.netProfit.toLocaleString();
            document.getElementById('roiPercentage').textContent = metrics.roiPercentage.toLocaleString() + '%';
        }
        
        // Get all customers from connected platforms
        function getAllConnectedCustomers() {
            let allCustomers = [];
            
            // Add Shopify customers
            if (window.shopifyIntegration?.isConnected) {
                allCustomers = allCustomers.concat(window.shopifyIntegration.getAllCustomers());
            }
            
            // Add WooCommerce customers
            if (wooCommerceIntegration?.isConnected) {
                allCustomers = allCustomers.concat(wooCommerceIntegration.getAllCustomers());
            }
            
            return allCustomers;
        }
        
        // Load analytics when analytics page is shown
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
                page.style.display = 'none';
            });
            
            // Show selected page
            const selectedPage = document.getElementById(pageId);
            if (selectedPage) {
                selectedPage.style.display = 'block';
                selectedPage.classList.add('active');
                
                // Load analytics data if analytics page is shown
                if (pageId === 'analytics-dashboard') {
                    setTimeout(loadAnalyticsData, 100);
                }
            }
            
            console.log(`üìÑ Switched to page: ${pageId}`);
        }
        
        // ========== MARKETPLACE DOCUMENTATION GENERATOR ==========
        
        // Auto-generate weather delay documentation for disputes
        function generateMarketplaceDocumentation(alertData, platform = 'amazon') {
            const timestamp = new Date().toISOString();
            const weatherEvent = alertData.weather || {
                description: 'Severe weather conditions',
                cause: 'Weather system affecting shipping hub',
                impact: 'Transportation delays expected'
            };
            
            const documentation = {
                amazon: generateAmazonDispute(alertData, weatherEvent, timestamp),
                ebay: generateEbayDispute(alertData, weatherEvent, timestamp),
                general: generateGeneralDispute(alertData, weatherEvent, timestamp)
            };
            
            return documentation[platform] || documentation.general;
        }
        
        // Generate Amazon-specific dispute documentation
        function generateAmazonDispute(alertData, weather, timestamp) {
            return {
                title: `Weather Delay Documentation - Order ${alertData.shipment?.awb || 'N/A'}`,
                content: `
AMAZON SELLER PERFORMANCE APPEAL
Weather-Related Shipping Delay Documentation

ORDER DETAILS:
- Order ID: ${alertData.shipment?.awb || 'N/A'}
- Customer: ${alertData.shipment?.client || 'N/A'}
- Product: ${alertData.shipment?.description || 'N/A'}
- Order Value: ${alertData.shipment?.value || 'N/A'}
- Original Ship Date: ${new Date(Date.now() - 86400000).toLocaleDateString()}
- Expected Delivery: ${new Date().toLocaleDateString()}

WEATHER EVENT DOCUMENTATION:
- Weather Condition: ${weather.description}
- Affected Area: ${weather.cause}
- Impact: ${weather.impact}
- Alert Generated: ${timestamp}
- Customer Notification: Sent proactively before customer inquiry

PROACTIVE CUSTOMER SERVICE:
‚úÖ Customer was notified immediately when delay was detected
‚úÖ Professional communication maintaining brand reputation
‚úÖ Customer expressed appreciation for proactive notification
‚úÖ No customer complaint or inquiry was generated

SUPPORTING EVIDENCE:
- Automated weather monitoring system alert
- Timestamp of proactive customer notification
- Customer acknowledgment and positive response
- Weather data from National Weather Service

APPEAL REQUEST:
This delivery delay was caused by documented severe weather conditions beyond seller control. 
The seller demonstrated exceptional customer service by proactively notifying the customer 
before any complaint was made. Request removal of any performance impact related to this 
weather-delayed shipment.

Generated by NaviFlow E-Commerce Shield
Timestamp: ${timestamp}
                `.trim(),
                attachments: [
                    'Weather_Alert_Documentation.pdf',
                    'Customer_Notification_Screenshot.png',
                    'Weather_Service_Data.pdf'
                ]
            };
        }
        
        // Generate eBay-specific dispute documentation  
        function generateEbayDispute(alertData, weather, timestamp) {
            return {
                title: `eBay Seller Protection - Weather Delay Case ${alertData.shipment?.awb || 'N/A'}`,
                content: `
EBAY SELLER PROTECTION CASE
Weather-Related Shipping Delay Appeal

TRANSACTION DETAILS:
- Item Number: ${alertData.shipment?.awb || 'N/A'}
- Buyer: ${alertData.shipment?.client || 'N/A'}
- Item: ${alertData.shipment?.description || 'N/A'}
- Sale Amount: ${alertData.shipment?.value || 'N/A'}
- Handling Time: Within eBay policy
- Shipping Service: Standard shipping with tracking

DOCUMENTED WEATHER EVENT:
- Weather Emergency: ${weather.description}
- Geographic Impact: ${weather.cause}
- Shipping Disruption: ${weather.impact}
- Official Weather Alert: ${timestamp}

EXCEPTIONAL CUSTOMER SERVICE:
‚úÖ Buyer contacted proactively before any inquiry
‚úÖ Professional communication maintaining 5-star service standards
‚úÖ Buyer responded positively to proactive notification
‚úÖ Zero negative feedback risk due to proactive service

APPEAL JUSTIFICATION:
- Weather delay beyond seller control (eBay Policy 2023)
- Seller exceeded service expectations with proactive communication
- Buyer satisfaction maintained through professional handling
- Request defect removal under weather exception policy

Supporting documentation attached.

Seller Protection Case Reference: ${timestamp.slice(-8)}
Generated: ${timestamp}
                `.trim(),
                attachments: [
                    'eBay_Weather_Documentation.pdf',
                    'Buyer_Communication_Record.pdf',
                    'Weather_Alert_Evidence.pdf'
                ]
            };
        }
        
        // Generate general marketplace dispute documentation
        function generateGeneralDispute(alertData, weather, timestamp) {
            return {
                title: `Weather Delay Protection Documentation`,
                content: `
MARKETPLACE SELLER PROTECTION APPEAL
Weather-Related Shipping Delay Documentation

ORDER INFORMATION:
- Reference: ${alertData.shipment?.awb || 'N/A'}
- Customer: ${alertData.shipment?.client || 'N/A'}
- Product: ${alertData.shipment?.description || 'N/A'}
- Value: ${alertData.shipment?.value || 'N/A'}
- Date: ${new Date().toLocaleDateString()}

WEATHER EVENT:
- Condition: ${weather.description}
- Location: ${weather.cause}
- Impact: ${weather.impact}
- Detection: ${timestamp}

PROACTIVE SERVICE:
The customer was immediately notified when weather delays were detected, 
demonstrating exceptional customer service standards. This proactive 
communication prevented customer dissatisfaction and maintained positive 
seller-buyer relationship.

OUTCOME:
- Customer expressed appreciation for notification
- No negative feedback received
- Customer satisfaction maintained
- Professional handling of uncontrollable circumstances

Generated by automated customer service system
Timestamp: ${timestamp}
                `.trim()
            };
        }
        
        // ========== A/B TESTING FRAMEWORK ==========
        
        // A/B test different notification templates
        function selectNotificationTemplate(customer, alertData) {
            const customerValue = parseFloat(customer.totalSpent?.replace('$', '') || customer.value?.replace('$', '') || '50');
            const testGroup = customer.email ? customer.email.split('').reduce((a, b) => a + b.charCodeAt(0), 0) % 3 : 0;
            
            // Customer segmentation for template selection
            let templateType;
            if (customerValue >= 200) {
                templateType = 'professional'; // High-value customers get professional template
            } else if (customerValue >= 50) {
                templateType = testGroup === 0 ? 'professional' : testGroup === 1 ? 'casual' : 'urgent';
            } else {
                templateType = testGroup === 0 ? 'casual' : testGroup === 1 ? 'urgent' : 'professional';
            }
            
            return generateTemplateByType(templateType, customer, alertData);
        }
        
        // Generate different template types
        function generateTemplateByType(templateType, customer, alertData) {
            const templates = {
                professional: {
                    subject: `Order Update: Weather Delay Notification`,
                    content: `Dear ${customer.name || 'Valued Customer'},

We wanted to inform you immediately about a weather-related delay affecting your recent order.

Order Details:
‚Ä¢ Product: ${alertData.shipment?.description || 'Your item'}
‚Ä¢ Order Value: ${alertData.shipment?.value || 'N/A'}
‚Ä¢ Original Delivery: Today
‚Ä¢ Revised Delivery: Tomorrow

Weather Impact:
${alertData.weather?.description || 'Severe weather conditions'} in the shipping region are causing temporary delays. We are monitoring the situation closely and will provide updates as they become available.

What We're Doing:
‚úì Tracking your shipment in real-time
‚úì Coordinating with shipping partners for fastest resolution
‚úì Ensuring your order remains secure and undamaged

We sincerely apologize for any inconvenience and appreciate your patience during this weather event.

Best regards,
Customer Service Team`,
                    tone: 'professional'
                },
                
                casual: {
                    subject: `Quick heads up about your order!`,
                    content: `Hi ${customer.name || 'there'}!

Just wanted to give you a quick update on your order - looks like Mother Nature has other plans! üåßÔ∏è

Your order (${alertData.shipment?.description || 'your awesome item'}) is running about a day behind due to some pretty intense weather in the shipping area. 

The good news? Your package is safe and sound, just waiting for the storms to pass. Should be on its way to you by tomorrow!

Thanks for being awesome and understanding that sometimes weather happens! 

Cheers! ‚òÄÔ∏è`,
                    tone: 'casual'
                },
                
                urgent: {
                    subject: `IMPORTANT: Weather Alert for Your Order`,
                    content: `${customer.name || 'Customer'},

WEATHER ALERT - Your order is experiencing a delay due to severe weather conditions.

üö® AFFECTED ORDER: ${alertData.shipment?.description || 'Order item'}
‚è∞ NEW DELIVERY DATE: Tomorrow (1 day delay)
üõ°Ô∏è STATUS: Package secure, no damage expected

This delay is due to documented severe weather conditions beyond our control. Your package is safe in the shipping facility.

We will update you immediately when shipping resumes.

For any questions, contact us immediately.

Customer Service Team
PRIORITY NOTIFICATION`,
                    tone: 'urgent'
                }
            };
            
            return templates[templateType] || templates.professional;
        }
        
        // Track A/B test results
        function logABTestResult(customer, templateType, result) {
            const abTestData = JSON.parse(localStorage.getItem('abTestResults') || '[]');
            
            abTestData.push({
                timestamp: new Date().toISOString(),
                customerId: customer.id,
                customerValue: customer.totalSpent || customer.value,
                templateType: templateType,
                success: result.overallSuccess,
                deliveryTime: result.deliveryTime,
                customerSegment: parseFloat(customer.totalSpent?.replace('$', '') || '50') >= 200 ? 'high' : 'regular'
            });
            
            // Keep last 1000 test results
            if (abTestData.length > 1000) {
                abTestData.splice(0, abTestData.length - 1000);
            }
            
            localStorage.setItem('abTestResults', JSON.stringify(abTestData));
        }
        
        // Analytics action functions
        function optimizeNotifications() {
            showToast('üîß Analyzing template performance and optimizing for high-value customers...', 'info');
            setTimeout(() => {
                showToast('‚úÖ Template optimization complete! High-value customers switched to Professional template.', 'success');
            }, 2000);
        }
        
        function expandPlatforms() {
            showToast('üåê Amazon Seller Central integration coming soon! Join the waitlist.', 'info');
        }
        
        function generateReport() {
            const metrics = calculateROIMetrics(
                JSON.parse(localStorage.getItem('alertHistory') || '[]'),
                getAllConnectedCustomers()
            );
            
            const reportData = [
                'NaviFlow E-Commerce Shield - ROI Report',
                `Generated: ${new Date().toLocaleDateString()}`,
                '',
                'KEY METRICS:',
                `Revenue Protected: $${metrics.revenueProtected.toLocaleString()}`,
                `Reviews Protected: ${metrics.reviewsProtected}`,
                `Customer Satisfaction: ${metrics.satisfactionScore}%`,
                `Support Tickets Saved: ${metrics.ticketsSaved}`,
                `ROI: ${metrics.roiPercentage}%`,
                '',
                'MONTHLY VALUE BREAKDOWN:',
                `Prevented Cancellations: $${metrics.revenueProtected.toLocaleString()}`,
                `Support Time Saved: $${metrics.supportSavings.toLocaleString()}`,
                `Rating Protection: $${metrics.ratingSavings.toLocaleString()}`,
                `Repeat Customer Value: $${metrics.repeatRevenue.toLocaleString()}`,
                `Total Monthly Value: $${metrics.monthlyValue.toLocaleString()}`,
                `Net Monthly Profit: $${metrics.netProfit.toLocaleString()}`,
                '',
                'Generated by NaviFlow E-Commerce Shield Analytics'
            ].join('\n');
            
            const blob = new Blob([reportData], { type: 'text/plain' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `nerva-roi-report-${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            window.URL.revokeObjectURL(url);
            
            showToast('üìä ROI report exported successfully!', 'success');
        }
        
        // View marketplace documentation for a specific alert
        function viewMarketplaceDoc(alertId) {
            const docHistory = JSON.parse(localStorage.getItem('marketplaceDocuments') || '[]');
            const doc = docHistory.find(d => d.alertId === alertId);
            
            if (!doc) {
                showToast('‚ùå Documentation not found', 'error');
                return;
            }
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <h2 class="text-2xl font-bold text-gray-800">üìã ${doc.documentation.title}</h2>
                            <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                        </div>
                    </div>
                    
                    <div class="p-6">
                        <div class="bg-gray-50 rounded-lg p-4 mb-4">
                            <h3 class="font-semibold text-gray-800 mb-2">üìÑ Ready-to-Submit Documentation</h3>
                            <p class="text-sm text-gray-600">Copy and paste this into your marketplace dispute/appeal form:</p>
                        </div>
                        
                        <div class="bg-white border border-gray-300 rounded-lg p-4 mb-4">
                            <pre class="text-sm text-gray-800 whitespace-pre-wrap font-mono">${doc.documentation.content}</pre>
                        </div>
                        
                        ${doc.documentation.attachments ? `
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                                <h4 class="font-semibold text-blue-800 mb-2">üìé Supporting Documents</h4>
                                <div class="space-y-1 text-sm text-blue-700">
                                    ${doc.documentation.attachments.map(att => `<p>‚Ä¢ ${att}</p>`).join('')}
                                </div>
                                <p class="text-xs text-blue-600 mt-2">Note: These would be auto-generated in production version</p>
                            </div>
                        ` : ''}
                        
                        <div class="flex space-x-3">
                            <button onclick="copyDocumentation('${doc.alertId}')" 
                                    class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                üìã Copy to Clipboard
                            </button>
                            <button onclick="downloadDocumentation('${doc.alertId}')" 
                                    class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                                üíæ Download Document
                            </button>
                            <button onclick="generateEbayDoc('${doc.alertId}')" 
                                    class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700">
                                üîÑ Generate eBay Version
                            </button>
                            <button onclick="this.closest('.fixed').remove()" 
                                    class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        // Copy documentation to clipboard
        function copyDocumentation(alertId) {
            const docHistory = JSON.parse(localStorage.getItem('marketplaceDocuments') || '[]');
            const doc = docHistory.find(d => d.alertId === alertId);
            
            if (doc) {
                navigator.clipboard.writeText(doc.documentation.content).then(() => {
                    showToast('üìã Documentation copied to clipboard!', 'success');
                });
            }
        }
        
        // Download documentation as text file
        function downloadDocumentation(alertId) {
            const docHistory = JSON.parse(localStorage.getItem('marketplaceDocuments') || '[]');
            const doc = docHistory.find(d => d.alertId === alertId);
            
            if (doc) {
                const blob = new Blob([doc.documentation.content], { type: 'text/plain' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `marketplace-dispute-${alertId}.txt`;
                a.click();
                window.URL.revokeObjectURL(url);
                showToast('üíæ Documentation downloaded!', 'success');
            }
        }
        
        // Generate eBay version of documentation
        function generateEbayDoc(alertId) {
            const docHistory = JSON.parse(localStorage.getItem('marketplaceDocuments') || '[]');
            const doc = docHistory.find(d => d.alertId === alertId);
            
            if (doc) {
                // Find the original alert data
                const alertHistory = JSON.parse(localStorage.getItem('alertHistory') || '[]');
                const alertData = alertHistory.find(a => a.alertId === alertId);
                
                if (alertData) {
                    const ebayDoc = generateMarketplaceDocumentation(alertData, 'ebay');
                    
                    // Store eBay version
                    docHistory.push({
                        alertId: alertId + '_ebay',
                        timestamp: doc.timestamp,
                        documentation: ebayDoc,
                        platform: 'ebay'
                    });
                    localStorage.setItem('marketplaceDocuments', JSON.stringify(docHistory));
                    
                    showToast('üîÑ eBay documentation generated!', 'success');
                    viewMarketplaceDoc(alertId + '_ebay');
                }
            }
        }
        
        // ========== SEA FREIGHT INTELLIGENCE ==========
        
        // Container tracking functions
        function addContainer() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full">
                    <div class="p-6 text-center">
                        <div class="text-6xl mb-4">üö¢</div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">Add Container Tracking</h2>
                        
                        <div class="space-y-4 text-left">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Container Number</label>
                                <input type="text" id="containerNumber" placeholder="TEMU1234567" 
                                       class="w-full border border-gray-300 rounded-lg px-3 py-2" />
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Route</label>
                                <select id="containerRoute" class="w-full border border-gray-300 rounded-lg px-3 py-2">
                                    <option value="shenzhen-longbeach">Shenzhen ‚Üí Long Beach</option>
                                    <option value="hamburg-newyork">Hamburg ‚Üí New York</option>
                                    <option value="ningbo-rotterdam">Ningbo ‚Üí Rotterdam</option>
                                    <option value="singapore-losangeles">Singapore ‚Üí Los Angeles</option>
                                    <option value="shanghai-seattle">Shanghai ‚Üí Seattle</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Inventory Value</label>
                                <input type="text" id="inventoryValue" placeholder="$250,000" 
                                       class="w-full border border-gray-300 rounded-lg px-3 py-2" />
                            </div>
                        </div>
                        
                        <div class="mt-6 flex space-x-3">
                            <button onclick="this.closest('.fixed').remove()" 
                                    class="flex-1 px-4 py-2 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg">
                                Cancel
                            </button>
                            <button onclick="startContainerTracking()" 
                                    class="flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 font-medium">
                                Start Tracking
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function startContainerTracking() {
            const containerNumber = document.getElementById('containerNumber').value.trim();
            const route = document.getElementById('containerRoute').value;
            const inventoryValue = document.getElementById('inventoryValue').value.trim();
            
            if (!containerNumber) {
                alert('Please enter container number');
                return;
            }
            
            // Close modal
            document.querySelector('.fixed').remove();
            
            // Add to container tracking
            showToast(`üö¢ Container ${containerNumber} added to tracking with weather intelligence`, 'success');
            showToast('üìä Sea freight weather monitoring activated', 'info');
        }
        
        function refreshContainers() {
            showToast('üîÑ Refreshing all container positions and weather alerts...', 'info');
            setTimeout(() => {
                showToast('‚úÖ Container tracking updated ‚Ä¢ 3 weather alerts detected', 'success');
            }, 2000);
        }
        
        function viewContainer(containerId) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <h2 class="text-2xl font-bold text-gray-800">üö¢ Container ${containerId}</h2>
                            <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                        </div>
                    </div>
                    
                    <div class="p-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div class="bg-blue-50 rounded-lg p-4">
                                <h3 class="font-semibold text-blue-800 mb-3">üì¶ Container Details</h3>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span>Container ID:</span>
                                        <span class="font-medium">${containerId}</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Size:</span>
                                        <span class="font-medium">40ft Standard</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Route:</span>
                                        <span class="font-medium">Shenzhen ‚Üí Long Beach</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Departure:</span>
                                        <span class="font-medium">Oct 15, 2024</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>ETA:</span>
                                        <span class="font-medium">Nov 18, 2024 (+3 days)</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-yellow-50 rounded-lg p-4">
                                <h3 class="font-semibold text-yellow-800 mb-3">üå™Ô∏è Weather Alert</h3>
                                <div class="text-sm text-yellow-700">
                                    <p class="font-medium mb-2">Typhoon Risk: Medium</p>
                                    <p>Large typhoon system approaching shipping lanes in South China Sea. Expected 2-3 day delay in departure.</p>
                                    <div class="mt-3 space-y-1">
                                        <p>‚Ä¢ Customer notification: Sent automatically</p>
                                        <p>‚Ä¢ Insurance documentation: Generated</p>
                                        <p>‚Ä¢ Alternative routes: Being evaluated</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-4">
                            <h3 class="font-semibold text-green-800 mb-2">‚úÖ Proactive Customer Communication</h3>
                            <p class="text-sm text-green-700">
                                Your customers have been automatically notified about the weather delay. Professional communication template used to maintain customer satisfaction and protect your seller ratings.
                            </p>
                        </div>
                        
                        <div class="flex space-x-3">
                            <button onclick="sendSeaFreightAlert('${containerId}')" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                üìß Send Customer Update
                            </button>
                            <button onclick="generateSeaFreightDoc('${containerId}')" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
                                üìã Generate Dispute Docs
                            </button>
                            <button onclick="this.closest('.fixed').remove()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        // Freight forwarder integration
        function connectFreightForwarder(platform) {
            const integrations = {
                flexport: {
                    name: 'Flexport',
                    description: 'Digital freight forwarder with API access',
                    features: ['Container tracking', 'Real-time updates', 'Documentation']
                },
                freightos: {
                    name: 'Freightos',
                    description: 'Global freight marketplace platform',
                    features: ['Rate comparison', 'Booking management', 'Tracking']
                },
                project44: {
                    name: 'Project44',
                    description: 'Supply chain visibility platform',
                    features: ['Real-time tracking', 'ETA predictions', 'Alerts']
                }
            };
            
            const integration = integrations[platform];
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full">
                    <div class="p-6 text-center">
                        <div class="text-6xl mb-4">üìä</div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">Connect ${integration.name}</h2>
                        <p class="text-gray-600 mb-6">${integration.description}</p>
                        
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                            <h4 class="font-medium text-blue-800 mb-2">Integration Features:</h4>
                            <div class="text-sm text-blue-700 space-y-1">
                                ${integration.features.map(feature => `<p>‚Ä¢ ${feature}</p>`).join('')}
                                <p>‚Ä¢ Weather intelligence overlay</p>
                                <p>‚Ä¢ Automatic customer notifications</p>
                            </div>
                        </div>
                        
                        <div class="space-y-4 text-left">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">API Key</label>
                                <input type="password" placeholder="Enter ${integration.name} API key" 
                                       class="w-full border border-gray-300 rounded-lg px-3 py-2" />
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Account ID</label>
                                <input type="text" placeholder="Your ${integration.name} account ID" 
                                       class="w-full border border-gray-300 rounded-lg px-3 py-2" />
                            </div>
                        </div>
                        
                        <div class="mt-6 flex space-x-3">
                            <button onclick="this.closest('.fixed').remove()" 
                                    class="flex-1 px-4 py-2 text-gray-600 hover:text-gray-800 border border-gray-300 rounded-lg">
                                Cancel
                            </button>
                            <button onclick="completeFreightIntegration('${platform}')" 
                                    class="flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 font-medium">
                                Connect
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function completeFreightIntegration(platform) {
            document.querySelector('.fixed').remove();
            showToast(\`üîó \${platform.charAt(0).toUpperCase() + platform.slice(1)} integration connecting...\`, 'info');
            
            setTimeout(() => {
                showToast(\`‚úÖ \${platform.charAt(0).toUpperCase() + platform.slice(1)} connected successfully! Importing container data...\`, 'success');
                setTimeout(() => {
                    showToast('üì¶ 47 containers imported with weather intelligence activated', 'success');
                }, 1500);
            }, 3000);
        }
        
        // Sea freight specific alerts
        function sendSeaFreightAlert(containerId) {
            const alertData = {
                containerId: containerId,
                route: 'Shenzhen ‚Üí Long Beach',
                weatherEvent: 'Typhoon approaching South China Sea',
                delay: '2-3 days',
                inventoryValue: '$450,000'
            };
            
            showToast('üìß Sending proactive sea freight delay notification to customers...', 'info');
            
            setTimeout(() => {
                showToast('‚úÖ Sea freight alert sent successfully ‚Ä¢ Customer satisfaction protected', 'success');
                
                // Log the sea freight alert
                const seaFreightAlerts = JSON.parse(localStorage.getItem('seaFreightAlerts') || '[]');
                seaFreightAlerts.unshift({
                    alertId: 'SF_' + Date.now(),
                    timestamp: new Date().toISOString(),
                    containerId: containerId,
                    alertData: alertData,
                    delivered: true
                });
                localStorage.setItem('seaFreightAlerts', JSON.stringify(seaFreightAlerts));
            }, 2000);
        }
        
        function generateSeaFreightDoc(containerId) {
            const doc = \`SEA FREIGHT WEATHER DELAY DOCUMENTATION
Container: \${containerId}
Route: Shenzhen to Long Beach, CA

WEATHER EVENT:
- Type: Major typhoon system
- Location: South China Sea shipping lanes  
- Impact: 2-3 day departure delay
- Official Warning: Issued by China Meteorological Administration

PROACTIVE CUSTOMER SERVICE:
‚úÖ Customers notified immediately when delay detected
‚úÖ Professional communication maintaining brand trust
‚úÖ No customer complaints generated due to proactive notification
‚úÖ Inventory planning adjusted automatically

BUSINESS IMPACT MITIGATION:
- Amazon FBA deadlines: Alternative air freight arranged for critical items
- Cash flow: Customers pre-notified to prevent order cancellations
- Seasonal inventory: Q4 stock levels maintained with backup shipping

DOCUMENTATION EVIDENCE:
- Weather service alerts and forecasts
- Customer notification timestamps
- Freight forwarder delay confirmations
- Alternative shipping arrangements

This sea freight delay was caused by documented severe weather beyond seller control.
Request protection under force majeure shipping delay policies.

Generated by NaviFlow Sea Freight Intelligence
Container tracking: \${containerId}
Timestamp: \${new Date().toISOString()}\`;

            // Show the documentation
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = \`
                <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <h2 class="text-2xl font-bold text-gray-800">üìã Sea Freight Documentation</h2>
                            <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
                        </div>
                    </div>
                    
                    <div class="p-6">
                        <div class="bg-gray-50 rounded-lg p-4 mb-4">
                            <h3 class="font-semibold text-gray-800 mb-2">üìÑ Ready for Marketplace Disputes</h3>
                            <p class="text-sm text-gray-600">Auto-generated documentation for Amazon, eBay, or other marketplace protection:</p>
                        </div>
                        
                        <div class="bg-white border border-gray-300 rounded-lg p-4 mb-4">
                            <pre class="text-sm text-gray-800 whitespace-pre-wrap font-mono">\${doc}</pre>
                        </div>
                        
                        <div class="flex space-x-3">
                            <button onclick="navigator.clipboard.writeText('\${doc.replace(/'/g, "\\'")}'); showToast('üìã Documentation copied!', 'success');" 
                                    class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                üìã Copy Documentation
                            </button>
                            <button onclick="this.closest('.fixed').remove()" 
                                    class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            \`;
            
            document.body.appendChild(modal);
            showToast('üìã Sea freight dispute documentation generated!', 'success');
        }
        
        // Inventory planning tools
        function createShippingPlan() {
            showToast('üìÖ Creating AI-powered shipping plan based on weather patterns...', 'info');
            
            setTimeout(() => {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
                modal.innerHTML = \`
                    <div class="bg-white rounded-2xl shadow-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto">
                        <div class="p-6 border-b border-gray-200">
                            <h2 class="text-2xl font-bold text-gray-800">üìÖ Smart Shipping Plan</h2>
                        </div>
                        
                        <div class="p-6">
                            <div class="space-y-4">
                                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                    <h3 class="font-semibold text-blue-800 mb-2">üéÑ Q4 Holiday Inventory</h3>
                                    <p class="text-sm text-blue-700">Ship by <strong>September 10</strong> to avoid typhoon season delays</p>
                                </div>
                                
                                <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                                    <h3 class="font-semibold text-green-800 mb-2">üèÆ Chinese New Year</h3>
                                    <p class="text-sm text-green-700">Ship February inventory by <strong>January 5</strong> to avoid port closures</p>
                                </div>
                                
                                <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                                    <h3 class="font-semibold text-purple-800 mb-2">üåä Summer Season</h3>
                                    <p class="text-sm text-purple-700">Consider rail freight via Trans-Siberian to avoid Pacific typhoons</p>
                                </div>
                            </div>
                            
                            <div class="mt-6 text-center">
                                <button onclick="this.closest('.fixed').remove()" 
                                        class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700">
                                    Save Shipping Plan
                                </button>
                            </div>
                        </div>
                    </div>
                \`;
                
                document.body.appendChild(modal);
                showToast('‚úÖ AI shipping plan generated with weather intelligence', 'success');
            }, 2000);
        }
        
        // User Menu Functions
        function showUserMenu() {
            const menu = document.getElementById('userMenu');
            menu.classList.toggle('hidden');
        }

        function showAppHelp() {
            const modal = document.getElementById('appHelpModal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closeAppHelp() {
            const modal = document.getElementById('appHelpModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        function logout() {
            localStorage.removeItem('userLoggedIn');
            localStorage.removeItem('userEmail');
            localStorage.removeItem('loginTime');
            window.location.href = 'index.html';
        }

        // Tab Navigation Function
        function showPage(pageId) {
            console.log('Switching to page:', pageId);
            
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
                page.style.display = 'none';
            });
            
            // Show selected page
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
                targetPage.style.display = 'block';
                console.log('Showing page:', pageId);
            } else {
                console.error('Page not found:', pageId);
            }
        }

        // Initialize page on load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing...');
            
            // Set user info directly
            document.getElementById('userInfo').textContent = 'Demo User ‚Ä¢ demo@nerva.com';
            document.getElementById('userEmailDisplay').textContent = 'demo@nerva.com';
            document.getElementById('userStatusDisplay').textContent = 'Demo User';
            document.getElementById('userInitial').textContent = 'D';
            
            // Show default page immediately
            showPage('aviation-weather');
            
            console.log('Initialization complete');
        });

        // Make functions globally accessible
        window.showPage = showPage;
        window.showUserMenu = showUserMenu;
        window.showAppHelp = showAppHelp;
        window.closeAppHelp = closeAppHelp;
        window.logout = logout;
        
        // Backup initialization
        window.addEventListener('load', function() {
            console.log('Window loaded');
            // Ensure a page is visible
            if (!document.querySelector('.page.active')) {
                console.log('No active page found, showing default');
                showPage('aviation-weather');
            }
        });
        // Override with working functions
        window.showPage = function(pageId) {
            console.log('Switching to:', pageId);
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
                page.style.display = 'none';
            });
            const target = document.getElementById(pageId);
            if (target) {
                target.classList.add('active');
                target.style.display = 'block';
            }
        };

        window.showUserMenu = function() {
            document.getElementById('userMenu').classList.toggle('hidden');
        };

        window.showAppHelp = function() {
            const modal = document.getElementById('appHelpModal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        };

        window.closeAppHelp = function() {
            const modal = document.getElementById('appHelpModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        };

        window.logout = function() {
            window.location.href = 'index.html';
        };

        // Wait for DOM then initialize
        setTimeout(function() {
            console.log('Initializing after timeout...');
            
            // Set user info
            const userInfo = document.getElementById('userInfo');
            const userEmailDisplay = document.getElementById('userEmailDisplay');
            const userStatusDisplay = document.getElementById('userStatusDisplay');
            const userInitial = document.getElementById('userInitial');
            
            if (userInfo) userInfo.textContent = 'Demo User';
            if (userEmailDisplay) userEmailDisplay.textContent = 'demo@nerva.com';
            if (userStatusDisplay) userStatusDisplay.textContent = 'Demo User';
            if (userInitial) userInitial.textContent = 'D';

            // Show first page
            window.showPage('aviation-weather');
            console.log('Initialization complete');
        }, 100);
    </script>
</body>
</html>